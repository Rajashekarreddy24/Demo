import{a as Cs,b as J_}from"./chunk-UO72GWIH.js";import{m as j_,n as z_,o as K_,p as W_,q as Q_,s as $_,t as H_,v as Y_}from"./chunk-O3MZADX2.js";import"./chunk-DUBUW4ZU.js";import{A as P_,B as x_,C as ka,D as Va,E as Ma,F as Ue,G as Oa,H as Fa,I as La,J as Ua,K as qa,L as Ba,M as Ga,N as ja,O as za,P as Ka,Q as Wa,R as Qa,S as $a,T as Ha,U as G_,c as w_,d as Ca,e as E_,f as I_,k as T_,n as S_,p as A_,v as C_,y as b_,z as R_}from"./chunk-GR2TZYVC.js";import{A as K,B as ct,C as Le,D as Jc,E as B_,F as As,G as ne,H as Lt,I as xa,J as Xc,K as Et,L as Qr,M as Na,N as Da,P as $r,Q as Sn,a as M,b as Wr,c as N_,d as D_,e as k_,f as rt,g as ba,h as Ts,i as $c,j as V_,k as Ft,l as Hc,m as M_,n as O_,p as Ra,q as De,r as F_,s as L_,t as wt,u as Tn,v as Pa,w as Ss,x as Yc,y as U_,z as q_}from"./chunk-LOSEKLOO.js";import{$ as Kr,$a as jc,Aa as wa,Bb as h_,Cb as me,Eb as Qc,G as pa,Gb as Ta,Gc as g_,Hb as Sa,Ib as Aa,Ja as ft,Jb as d_,Ka as Ot,Kb as f_,Kc as __,L as ga,Lc as y_,M as ir,N as r_,Oc as v_,Pa as u_,Q as i_,R as _a,Ra as Ea,S as s_,Xa as Ia,Y as o_,Za as En,aa as ya,b as fa,ba as wn,ca as se,cb as zc,db as Kc,ec as m_,g as ma,ga as a_,ha as va,ib as W,jb as X,kb as We,m as vs,n as ws,ob as Wc,p as Ge,pa as Es,qa as Is,rb as c_,sb as In,vc as p_,x as Bc,xa as l_,y as Gc}from"./chunk-CB3CSPGG.js";import"./chunk-BRV2THHE.js";import{a as zr,b as ys,g as qc,h as N}from"./chunk-WT5K5NLM.js";var X_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Z_={};var An,Zc;(function(){var n;function e(E,_){function w(){}w.prototype=_.prototype,E.D=_.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(I,T,C){for(var v=Array(arguments.length-2),en=2;en<arguments.length;en++)v[en-2]=arguments[en];return _.prototype[T].apply(I,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,w){w||(w=0);var I=Array(16);if(typeof _=="string")for(var T=0;16>T;++T)I[T]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(T=0;16>T;++T)I[T]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=E.g[0],w=E.g[1],T=E.g[2];var C=E.g[3],v=_+(C^w&(T^C))+I[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=C+(T^_&(w^T))+I[1]+3905402710&4294967295,C=_+(v<<12&4294967295|v>>>20),v=T+(w^C&(_^w))+I[2]+606105819&4294967295,T=C+(v<<17&4294967295|v>>>15),v=w+(_^T&(C^_))+I[3]+3250441966&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(C^w&(T^C))+I[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(T^_&(w^T))+I[5]+1200080426&4294967295,C=_+(v<<12&4294967295|v>>>20),v=T+(w^C&(_^w))+I[6]+2821735955&4294967295,T=C+(v<<17&4294967295|v>>>15),v=w+(_^T&(C^_))+I[7]+4249261313&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(C^w&(T^C))+I[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(T^_&(w^T))+I[9]+2336552879&4294967295,C=_+(v<<12&4294967295|v>>>20),v=T+(w^C&(_^w))+I[10]+4294925233&4294967295,T=C+(v<<17&4294967295|v>>>15),v=w+(_^T&(C^_))+I[11]+2304563134&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(C^w&(T^C))+I[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=C+(T^_&(w^T))+I[13]+4254626195&4294967295,C=_+(v<<12&4294967295|v>>>20),v=T+(w^C&(_^w))+I[14]+2792965006&4294967295,T=C+(v<<17&4294967295|v>>>15),v=w+(_^T&(C^_))+I[15]+1236535329&4294967295,w=T+(v<<22&4294967295|v>>>10),v=_+(T^C&(w^T))+I[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^T&(_^w))+I[6]+3225465664&4294967295,C=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(C^_))+I[11]+643717713&4294967295,T=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(T^C))+I[0]+3921069994&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^C&(w^T))+I[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^T&(_^w))+I[10]+38016083&4294967295,C=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(C^_))+I[15]+3634488961&4294967295,T=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(T^C))+I[4]+3889429448&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^C&(w^T))+I[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^T&(_^w))+I[14]+3275163606&4294967295,C=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(C^_))+I[3]+4107603335&4294967295,T=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(T^C))+I[8]+1163531501&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(T^C&(w^T))+I[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=C+(w^T&(_^w))+I[2]+4243563512&4294967295,C=_+(v<<9&4294967295|v>>>23),v=T+(_^w&(C^_))+I[7]+1735328473&4294967295,T=C+(v<<14&4294967295|v>>>18),v=w+(C^_&(T^C))+I[12]+2368359562&4294967295,w=T+(v<<20&4294967295|v>>>12),v=_+(w^T^C)+I[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^T)+I[8]+2272392833&4294967295,C=_+(v<<11&4294967295|v>>>21),v=T+(C^_^w)+I[11]+1839030562&4294967295,T=C+(v<<16&4294967295|v>>>16),v=w+(T^C^_)+I[14]+4259657740&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^C)+I[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^T)+I[4]+1272893353&4294967295,C=_+(v<<11&4294967295|v>>>21),v=T+(C^_^w)+I[7]+4139469664&4294967295,T=C+(v<<16&4294967295|v>>>16),v=w+(T^C^_)+I[10]+3200236656&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^C)+I[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^T)+I[0]+3936430074&4294967295,C=_+(v<<11&4294967295|v>>>21),v=T+(C^_^w)+I[3]+3572445317&4294967295,T=C+(v<<16&4294967295|v>>>16),v=w+(T^C^_)+I[6]+76029189&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(w^T^C)+I[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=C+(_^w^T)+I[12]+3873151461&4294967295,C=_+(v<<11&4294967295|v>>>21),v=T+(C^_^w)+I[15]+530742520&4294967295,T=C+(v<<16&4294967295|v>>>16),v=w+(T^C^_)+I[2]+3299628645&4294967295,w=T+(v<<23&4294967295|v>>>9),v=_+(T^(w|~C))+I[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~T))+I[7]+1126891415&4294967295,C=_+(v<<10&4294967295|v>>>22),v=T+(_^(C|~w))+I[14]+2878612391&4294967295,T=C+(v<<15&4294967295|v>>>17),v=w+(C^(T|~_))+I[5]+4237533241&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~C))+I[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~T))+I[3]+2399980690&4294967295,C=_+(v<<10&4294967295|v>>>22),v=T+(_^(C|~w))+I[10]+4293915773&4294967295,T=C+(v<<15&4294967295|v>>>17),v=w+(C^(T|~_))+I[1]+2240044497&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~C))+I[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~T))+I[15]+4264355552&4294967295,C=_+(v<<10&4294967295|v>>>22),v=T+(_^(C|~w))+I[6]+2734768916&4294967295,T=C+(v<<15&4294967295|v>>>17),v=w+(C^(T|~_))+I[13]+1309151649&4294967295,w=T+(v<<21&4294967295|v>>>11),v=_+(T^(w|~C))+I[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=C+(w^(_|~T))+I[11]+3174756917&4294967295,C=_+(v<<10&4294967295|v>>>22),v=T+(_^(C|~w))+I[2]+718787259&4294967295,T=C+(v<<15&4294967295|v>>>17),v=w+(C^(T|~_))+I[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(T+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+C&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var w=_-this.blockSize,I=this.B,T=this.h,C=0;C<_;){if(T==0)for(;C<=w;)i(this,E,C),C+=this.blockSize;if(typeof E=="string"){for(;C<_;)if(I[T++]=E.charCodeAt(C++),T==this.blockSize){i(this,I),T=0;break}}else for(;C<_;)if(I[T++]=E[C++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var w=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=w&255,w/=256;for(this.u(E),E=Array(16),_=w=0;4>_;++_)for(var I=0;32>I;I+=8)E[w++]=this.g[_]>>>I&255;return E};function s(E,_){var w=l;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=_(E)}function o(E,_){this.h=_;for(var w=[],I=!0,T=E.length-1;0<=T;T--){var C=E[T]|0;I&&C==_||(w[T]=C,I=!1)}this.g=w}var l={};function u(E){return-128<=E&&128>E?s(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function c(E){if(isNaN(E)||!isFinite(E))return m;if(0>E)return D(c(-E));for(var _=[],w=1,I=0;E>=w;I++)_[I]=E/w|0,w*=4294967296;return new o(_,0)}function d(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return D(d(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=c(Math.pow(_,8)),I=m,T=0;T<E.length;T+=8){var C=Math.min(8,E.length-T),v=parseInt(E.substring(T,T+C),_);8>C?(C=c(Math.pow(_,C)),I=I.j(C).add(c(v))):(I=I.j(w),I=I.add(c(v)))}return I}var m=u(0),p=u(1),y=u(16777216);n=o.prototype,n.m=function(){if(x(this))return-D(this).m();for(var E=0,_=1,w=0;w<this.g.length;w++){var I=this.i(w);E+=(0<=I?I:4294967296+I)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(A(this))return"0";if(x(this))return"-"+D(this).toString(E);for(var _=c(Math.pow(E,6)),w=this,I="";;){var T=J(w,_).g;w=B(w,T.j(_));var C=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=T,A(w))return C+I;for(;6>C.length;)C="0"+C;I=C+I}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function A(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function x(E){return E.h==-1}n.l=function(E){return E=B(this,E),x(E)?-1:A(E)?0:1};function D(E){for(var _=E.g.length,w=[],I=0;I<_;I++)w[I]=~E.g[I];return new o(w,~E.h).add(p)}n.abs=function(){return x(this)?D(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0,T=0;T<=_;T++){var C=I+(this.i(T)&65535)+(E.i(T)&65535),v=(C>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);I=v>>>16,C&=65535,v&=65535,w[T]=v<<16|C}return new o(w,w[w.length-1]&-2147483648?-1:0)};function B(E,_){return E.add(D(_))}n.j=function(E){if(A(this)||A(E))return m;if(x(this))return x(E)?D(this).j(D(E)):D(D(this).j(E));if(x(E))return D(this.j(D(E)));if(0>this.l(y)&&0>E.l(y))return c(this.m()*E.m());for(var _=this.g.length+E.g.length,w=[],I=0;I<2*_;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<E.g.length;T++){var C=this.i(I)>>>16,v=this.i(I)&65535,en=E.i(T)>>>16,Zi=E.i(T)&65535;w[2*I+2*T]+=v*Zi,j(w,2*I+2*T),w[2*I+2*T+1]+=C*Zi,j(w,2*I+2*T+1),w[2*I+2*T+1]+=v*en,j(w,2*I+2*T+1),w[2*I+2*T+2]+=C*en,j(w,2*I+2*T+2)}for(I=0;I<_;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=_;I<2*_;I++)w[I]=0;return new o(w,0)};function j(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function q(E,_){this.g=E,this.h=_}function J(E,_){if(A(_))throw Error("division by zero");if(A(E))return new q(m,m);if(x(E))return _=J(D(E),_),new q(D(_.g),D(_.h));if(x(_))return _=J(E,D(_)),new q(D(_.g),_.h);if(30<E.g.length){if(x(E)||x(_))throw Error("slowDivide_ only works with positive integers.");for(var w=p,I=_;0>=I.l(E);)w=ie(w),I=ie(I);var T=$(w,1),C=$(I,1);for(I=$(I,2),w=$(w,2);!A(I);){var v=C.add(I);0>=v.l(E)&&(T=T.add(w),C=v),I=$(I,1),w=$(w,1)}return _=B(E,T.j(_)),new q(T,_)}for(T=m;0<=E.l(_);){for(w=Math.max(1,Math.floor(E.m()/_.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),C=c(w),v=C.j(_);x(v)||0<v.l(E);)w-=I,C=c(w),v=C.j(_);A(C)&&(C=p),T=T.add(C),E=B(E,v)}return new q(T,E)}n.A=function(E){return J(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)&E.i(I);return new o(w,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)|E.i(I);return new o(w,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],I=0;I<_;I++)w[I]=this.i(I)^E.i(I);return new o(w,this.h^E.h)};function ie(E){for(var _=E.g.length+1,w=[],I=0;I<_;I++)w[I]=E.i(I)<<1|E.i(I-1)>>>31;return new o(w,E.h)}function $(E,_){var w=_>>5;_%=32;for(var I=E.g.length-w,T=[],C=0;C<I;C++)T[C]=0<_?E.i(C+w)>>>_|E.i(C+w+1)<<32-_:E.i(C+w);return new o(T,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Zc=Z_.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,An=Z_.Integer=o}).apply(typeof X_<"u"?X_:typeof self<"u"?self:typeof window<"u"?window:{});var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},rn={};var eh,th,Hr,nh,bs,Ja,rh,ih,sh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,h,f){return a==Array.prototype||a==Object.prototype||(a[h]=f.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ya=="object"&&Ya];for(var h=0;h<a.length;++h){var f=a[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function i(a,h){if(h)e:{var f=r;a=a.split(".");for(var g=0;g<a.length-1;g++){var S=a[g];if(!(S in f))break e;f=f[S]}a=a[a.length-1],g=f[a],h=h(g),h!=g&&h!=null&&e(f,a,{configurable:!0,writable:!0,value:h})}}function s(a,h){a instanceof String&&(a+="");var f=0,g=!1,S={next:function(){if(!g&&f<a.length){var P=f++;return{value:h(P,a[P]),done:!1}}return g=!0,{done:!0,value:void 0}}};return S[Symbol.iterator]=function(){return S},S}i("Array.prototype.values",function(a){return a||function(){return s(this,function(h,f){return f})}});var o=o||{},l=this||self;function u(a){var h=typeof a;return h=h!="object"?h:a?Array.isArray(a)?"array":h:"null",h=="array"||h=="object"&&typeof a.length=="number"}function c(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function d(a,h,f){return a.call.apply(a.bind,arguments)}function m(a,h,f){if(!a)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var S=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(S,g),a.apply(h,S)}}return function(){return a.apply(h,arguments)}}function p(a,h,f){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:m,p.apply(null,arguments)}function y(a,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function A(a,h){function f(){}f.prototype=h.prototype,a.aa=h.prototype,a.prototype=new f,a.prototype.constructor=a,a.Qb=function(g,S,P){for(var O=Array(arguments.length-2),fe=2;fe<arguments.length;fe++)O[fe-2]=arguments[fe];return h.prototype[S].apply(g,O)}}function x(a){let h=a.length;if(0<h){let f=Array(h);for(let g=0;g<h;g++)f[g]=a[g];return f}return[]}function D(a,h){for(let f=1;f<arguments.length;f++){let g=arguments[f];if(u(g)){let S=a.length||0,P=g.length||0;a.length=S+P;for(let O=0;O<P;O++)a[S+O]=g[O]}else a.push(g)}}class B{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function j(a){return/^[\s\xa0]*$/.test(a)}function q(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function J(a){return J[" "](a),a}J[" "]=function(){};var ie=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function $(a,h,f){for(let g in a)h.call(f,a[g],g,a)}function E(a,h){for(let f in a)h.call(void 0,a[f],f,a)}function _(a){let h={};for(let f in a)h[f]=a[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(a,h){let f,g;for(let S=1;S<arguments.length;S++){g=arguments[S];for(f in g)a[f]=g[f];for(let P=0;P<w.length;P++)f=w[P],Object.prototype.hasOwnProperty.call(g,f)&&(a[f]=g[f])}}function T(a){var h=1;a=a.split(":");let f=[];for(;0<h&&a.length;)f.push(a.shift()),h--;return a.length&&f.push(a.join(":")),f}function C(a){l.setTimeout(()=>{throw a},0)}function v(){var a=pc;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class en{constructor(){this.h=this.g=null}add(h,f){let g=Zi.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var Zi=new B(()=>new n0,a=>a.reset());class n0{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let es,ts=!1,pc=new en,ng=()=>{let a=l.Promise.resolve(void 0);es=()=>{a.then(r0)}};var r0=()=>{for(var a;a=v();){try{a.h.call(a.g)}catch(f){C(f)}var h=Zi;h.j(a),100>h.h&&(h.h++,a.next=h.g,h.g=a)}ts=!1};function gn(){this.s=this.s,this.C=this.C}gn.prototype.s=!1,gn.prototype.ma=function(){this.s||(this.s=!0,this.N())},gn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $e(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}$e.prototype.h=function(){this.defaultPrevented=!0};var i0=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let f=()=>{};l.addEventListener("test",f,h),l.removeEventListener("test",f,h)}catch{}return a}();function ns(a,h){if($e.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var f=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget){if(ie){e:{try{J(h.nodeName);var S=!0;break e}catch{}S=!1}S||(h=null)}}else f=="mouseover"?h=a.fromElement:f=="mouseout"&&(h=a.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:s0[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&ns.aa.h.call(this)}}A(ns,$e);var s0={2:"touch",3:"pen",4:"mouse"};ns.prototype.h=function(){ns.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var rs="closure_listenable_"+(1e6*Math.random()|0),o0=0;function a0(a,h,f,g,S){this.listener=a,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=S,this.key=++o0,this.da=this.fa=!1}function Yo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Jo(a){this.src=a,this.g={},this.h=0}Jo.prototype.add=function(a,h,f,g,S){var P=a.toString();a=this.g[P],a||(a=this.g[P]=[],this.h++);var O=_c(a,h,g,S);return-1<O?(h=a[O],f||(h.fa=!1)):(h=new a0(h,this.src,P,!!g,S),h.fa=f,a.push(h)),h};function gc(a,h){var f=h.type;if(f in a.g){var g=a.g[f],S=Array.prototype.indexOf.call(g,h,void 0),P;(P=0<=S)&&Array.prototype.splice.call(g,S,1),P&&(Yo(h),a.g[f].length==0&&(delete a.g[f],a.h--))}}function _c(a,h,f,g){for(var S=0;S<a.length;++S){var P=a[S];if(!P.da&&P.listener==h&&P.capture==!!f&&P.ha==g)return S}return-1}var yc="closure_lm_"+(1e6*Math.random()|0),vc={};function rg(a,h,f,g,S){if(g&&g.once)return sg(a,h,f,g,S);if(Array.isArray(h)){for(var P=0;P<h.length;P++)rg(a,h[P],f,g,S);return null}return f=Tc(f),a&&a[rs]?a.K(h,f,c(g)?!!g.capture:!!g,S):ig(a,h,f,!1,g,S)}function ig(a,h,f,g,S,P){if(!h)throw Error("Invalid event type");var O=c(S)?!!S.capture:!!S,fe=Ec(a);if(fe||(a[yc]=fe=new Jo(a)),f=fe.add(h,f,g,O,P),f.proxy)return f;if(g=l0(),f.proxy=g,g.src=a,g.listener=f,a.addEventListener)i0||(S=O),S===void 0&&(S=!1),a.addEventListener(h.toString(),g,S);else if(a.attachEvent)a.attachEvent(ag(h.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function l0(){function a(f){return h.call(a.src,a.listener,f)}let h=u0;return a}function sg(a,h,f,g,S){if(Array.isArray(h)){for(var P=0;P<h.length;P++)sg(a,h[P],f,g,S);return null}return f=Tc(f),a&&a[rs]?a.L(h,f,c(g)?!!g.capture:!!g,S):ig(a,h,f,!0,g,S)}function og(a,h,f,g,S){if(Array.isArray(h))for(var P=0;P<h.length;P++)og(a,h[P],f,g,S);else g=c(g)?!!g.capture:!!g,f=Tc(f),a&&a[rs]?(a=a.i,h=String(h).toString(),h in a.g&&(P=a.g[h],f=_c(P,f,g,S),-1<f&&(Yo(P[f]),Array.prototype.splice.call(P,f,1),P.length==0&&(delete a.g[h],a.h--)))):a&&(a=Ec(a))&&(h=a.g[h.toString()],a=-1,h&&(a=_c(h,f,g,S)),(f=-1<a?h[a]:null)&&wc(f))}function wc(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[rs])gc(h.i,a);else{var f=a.type,g=a.proxy;h.removeEventListener?h.removeEventListener(f,g,a.capture):h.detachEvent?h.detachEvent(ag(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=Ec(h))?(gc(f,a),f.h==0&&(f.src=null,h[yc]=null)):Yo(a)}}}function ag(a){return a in vc?vc[a]:vc[a]="on"+a}function u0(a,h){if(a.da)a=!0;else{h=new ns(h,this);var f=a.listener,g=a.ha||a.src;a.fa&&wc(a),a=f.call(g,h)}return a}function Ec(a){return a=a[yc],a instanceof Jo?a:null}var Ic="__closure_events_fn_"+(1e9*Math.random()>>>0);function Tc(a){return typeof a=="function"?a:(a[Ic]||(a[Ic]=function(h){return a.handleEvent(h)}),a[Ic])}function He(){gn.call(this),this.i=new Jo(this),this.M=this,this.F=null}A(He,gn),He.prototype[rs]=!0,He.prototype.removeEventListener=function(a,h,f,g){og(this,a,h,f,g)};function tt(a,h){var f,g=a.F;if(g)for(f=[];g;g=g.F)f.push(g);if(a=a.M,g=h.type||h,typeof h=="string")h=new $e(h,a);else if(h instanceof $e)h.target=h.target||a;else{var S=h;h=new $e(g,a),I(h,S)}if(S=!0,f)for(var P=f.length-1;0<=P;P--){var O=h.g=f[P];S=Xo(O,g,!0,h)&&S}if(O=h.g=a,S=Xo(O,g,!0,h)&&S,S=Xo(O,g,!1,h)&&S,f)for(P=0;P<f.length;P++)O=h.g=f[P],S=Xo(O,g,!1,h)&&S}He.prototype.N=function(){if(He.aa.N.call(this),this.i){var a=this.i,h;for(h in a.g){for(var f=a.g[h],g=0;g<f.length;g++)Yo(f[g]);delete a.g[h],a.h--}}this.F=null},He.prototype.K=function(a,h,f,g){return this.i.add(String(a),h,!1,f,g)},He.prototype.L=function(a,h,f,g){return this.i.add(String(a),h,!0,f,g)};function Xo(a,h,f,g){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();for(var S=!0,P=0;P<h.length;++P){var O=h[P];if(O&&!O.da&&O.capture==f){var fe=O.listener,Ke=O.ha||O.src;O.fa&&gc(a.i,O),S=fe.call(Ke,g)!==!1&&S}}return S&&!g.defaultPrevented}function lg(a,h,f){if(typeof a=="function")f&&(a=p(a,f));else if(a&&typeof a.handleEvent=="function")a=p(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:l.setTimeout(a,h||0)}function ug(a){a.g=lg(()=>{a.g=null,a.i&&(a.i=!1,ug(a))},a.l);let h=a.h;a.h=null,a.m.apply(null,h)}class c0 extends gn{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:ug(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function is(a){gn.call(this),this.h=a,this.g={}}A(is,gn);var cg=[];function hg(a){$(a.g,function(h,f){this.g.hasOwnProperty(f)&&wc(h)},a),a.g={}}is.prototype.N=function(){is.aa.N.call(this),hg(this)},is.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Sc=l.JSON.stringify,h0=l.JSON.parse,d0=class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}};function Ac(){}Ac.prototype.h=null;function dg(a){return a.h||(a.h=a.i())}function fg(){}var ss={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Cc(){$e.call(this,"d")}A(Cc,$e);function bc(){$e.call(this,"c")}A(bc,$e);var er={},mg=null;function Zo(){return mg=mg||new He}er.La="serverreachability";function pg(a){$e.call(this,er.La,a)}A(pg,$e);function os(a){let h=Zo();tt(h,new pg(h))}er.STAT_EVENT="statevent";function gg(a,h){$e.call(this,er.STAT_EVENT,a),this.stat=h}A(gg,$e);function nt(a){let h=Zo();tt(h,new gg(h,a))}er.Ma="timingevent";function _g(a,h){$e.call(this,er.Ma,a),this.size=h}A(_g,$e);function as(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){a()},h)}function ls(){this.g=!0}ls.prototype.xa=function(){this.g=!1};function f0(a,h,f,g,S,P){a.info(function(){if(a.g)if(P)for(var O="",fe=P.split("&"),Ke=0;Ke<fe.length;Ke++){var ue=fe[Ke].split("=");if(1<ue.length){var Ye=ue[0];ue=ue[1];var Je=Ye.split("_");O=2<=Je.length&&Je[1]=="type"?O+(Ye+"="+ue+"&"):O+(Ye+"=redacted&")}}else O=null;else O=P;return"XMLHTTP REQ ("+g+") [attempt "+S+"]: "+h+`
`+f+`
`+O})}function m0(a,h,f,g,S,P,O){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+S+"]: "+h+`
`+f+`
`+P+" "+O})}function qr(a,h,f,g){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+g0(a,f)+(g?" "+g:"")})}function p0(a,h){a.info(function(){return"TIMEOUT: "+h})}ls.prototype.info=function(){};function g0(a,h){if(!a.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(a=0;a<f.length;a++)if(Array.isArray(f[a])){var g=f[a];if(!(2>g.length)){var S=g[1];if(Array.isArray(S)&&!(1>S.length)){var P=S[0];if(P!="noop"&&P!="stop"&&P!="close")for(var O=1;O<S.length;O++)S[O]=""}}}}return Sc(f)}catch{return h}}var ea={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},yg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Rc;function ta(){}A(ta,Ac),ta.prototype.g=function(){return new XMLHttpRequest},ta.prototype.i=function(){return{}},Rc=new ta;function _n(a,h,f,g){this.j=a,this.i=h,this.l=f,this.R=g||1,this.U=new is(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new vg}function vg(){this.i=null,this.g="",this.h=!1}var wg={},Pc={};function xc(a,h,f){a.L=1,a.v=sa(tn(h)),a.m=f,a.P=!0,Eg(a,null)}function Eg(a,h){a.F=Date.now(),na(a),a.A=tn(a.v);var f=a.A,g=a.R;Array.isArray(g)||(g=[String(g)]),Mg(f.i,"t",g),a.C=0,f=a.j.J,a.h=new vg,a.g=Zg(a.j,f?h:null,!a.m),0<a.O&&(a.M=new c0(p(a.Y,a,a.g),a.O)),h=a.U,f=a.g,g=a.ca;var S="readystatechange";Array.isArray(S)||(S&&(cg[0]=S.toString()),S=cg);for(var P=0;P<S.length;P++){var O=rg(f,S[P],g||h.handleEvent,!1,h.h||h);if(!O)break;h.g[O.key]=O}h=a.H?_(a.H):{},a.m?(a.u||(a.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,h)):(a.u="GET",a.g.ea(a.A,a.u,null,h)),os(),f0(a.i,a.u,a.A,a.l,a.R,a.m)}_n.prototype.ca=function(a){a=a.target;let h=this.M;h&&nn(a)==3?h.j():this.Y(a)},_n.prototype.Y=function(a){try{if(a==this.g)e:{let Je=nn(this.g);var h=this.g.Ba();let jr=this.g.Z();if(!(3>Je)&&(Je!=3||this.g&&(this.h.h||this.g.oa()||Gg(this.g)))){this.J||Je!=4||h==7||(h==8||0>=jr?os(3):os(2)),Nc(this);var f=this.g.Z();this.X=f;t:if(Ig(this)){var g=Gg(this.g);a="";var S=g.length,P=nn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){tr(this),us(this);var O="";break t}this.h.i=new l.TextDecoder}for(h=0;h<S;h++)this.h.h=!0,a+=this.h.i.decode(g[h],{stream:!(P&&h==S-1)});g.length=0,this.h.g+=a,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=f==200,m0(this.i,this.u,this.A,this.l,this.R,Je,f),this.o){if(this.T&&!this.K){t:{if(this.g){var fe,Ke=this.g;if((fe=Ke.g?Ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(fe)){var ue=fe;break t}}ue=null}if(f=ue)qr(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Dc(this,f);else{this.o=!1,this.s=3,nt(12),tr(this),us(this);break e}}if(this.P){f=!0;let Pt;for(;!this.J&&this.C<O.length;)if(Pt=_0(this,O),Pt==Pc){Je==4&&(this.s=4,nt(14),f=!1),qr(this.i,this.l,null,"[Incomplete Response]");break}else if(Pt==wg){this.s=4,nt(15),qr(this.i,this.l,O,"[Invalid Chunk]"),f=!1;break}else qr(this.i,this.l,Pt,null),Dc(this,Pt);if(Ig(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Je!=4||O.length!=0||this.h.h||(this.s=1,nt(16),f=!1),this.o=this.o&&f,!f)qr(this.i,this.l,O,"[Invalid Chunked Response]"),tr(this),us(this);else if(0<O.length&&!this.W){this.W=!0;var Ye=this.j;Ye.g==this&&Ye.ba&&!Ye.M&&(Ye.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),Lc(Ye),Ye.M=!0,nt(11))}}else qr(this.i,this.l,O,null),Dc(this,O);Je==4&&tr(this),this.o&&!this.J&&(Je==4?Hg(this.j,this):(this.o=!1,na(this)))}else V0(this.g),f==400&&0<O.indexOf("Unknown SID")?(this.s=3,nt(12)):(this.s=0,nt(13)),tr(this),us(this)}}}catch{}finally{}};function Ig(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function _0(a,h){var f=a.C,g=h.indexOf(`
`,f);return g==-1?Pc:(f=Number(h.substring(f,g)),isNaN(f)?wg:(g+=1,g+f>h.length?Pc:(h=h.slice(g,g+f),a.C=g+f,h)))}_n.prototype.cancel=function(){this.J=!0,tr(this)};function na(a){a.S=Date.now()+a.I,Tg(a,a.I)}function Tg(a,h){if(a.B!=null)throw Error("WatchDog timer not null");a.B=as(p(a.ba,a),h)}function Nc(a){a.B&&(l.clearTimeout(a.B),a.B=null)}_n.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(p0(this.i,this.A),this.L!=2&&(os(),nt(17)),tr(this),this.s=2,us(this)):Tg(this,this.S-a)};function us(a){a.j.G==0||a.J||Hg(a.j,a)}function tr(a){Nc(a);var h=a.M;h&&typeof h.ma=="function"&&h.ma(),a.M=null,hg(a.U),a.g&&(h=a.g,a.g=null,h.abort(),h.ma())}function Dc(a,h){try{var f=a.j;if(f.G!=0&&(f.g==a||kc(f.h,a))){if(!a.K&&kc(f.h,a)&&f.G==3){try{var g=f.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var S=g;if(S[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<a.F)ca(f),la(f);else break e;Fc(f),nt(18)}}else f.za=S[1],0<f.za-f.T&&37500>S[2]&&f.F&&f.v==0&&!f.C&&(f.C=as(p(f.Za,f),6e3));if(1>=Cg(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else rr(f,11)}else if((a.K||f.g==a)&&ca(f),!j(h))for(S=f.Da.g.parse(h),h=0;h<S.length;h++){let ue=S[h];if(f.T=ue[0],ue=ue[1],f.G==2)if(ue[0]=="c"){f.K=ue[1],f.ia=ue[2];let Ye=ue[3];Ye!=null&&(f.la=Ye,f.j.info("VER="+f.la));let Je=ue[4];Je!=null&&(f.Aa=Je,f.j.info("SVER="+f.Aa));let jr=ue[5];jr!=null&&typeof jr=="number"&&0<jr&&(g=1.5*jr,f.L=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;let Pt=a.g;if(Pt){let da=Pt.g?Pt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(da){var P=g.h;P.g||da.indexOf("spdy")==-1&&da.indexOf("quic")==-1&&da.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Vc(P,P.h),P.h=null))}if(g.D){let Uc=Pt.g?Pt.g.getResponseHeader("X-HTTP-Session-Id"):null;Uc&&(g.ya=Uc,ve(g.I,g.D,Uc))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-a.F,f.j.info("Handshake RTT: "+f.R+"ms")),g=f;var O=a;if(g.qa=Xg(g,g.J?g.ia:null,g.W),O.K){bg(g.h,O);var fe=O,Ke=g.L;Ke&&(fe.I=Ke),fe.B&&(Nc(fe),na(fe)),g.g=O}else Qg(g);0<f.i.length&&ua(f)}else ue[0]!="stop"&&ue[0]!="close"||rr(f,7);else f.G==3&&(ue[0]=="stop"||ue[0]=="close"?ue[0]=="stop"?rr(f,7):Oc(f):ue[0]!="noop"&&f.l&&f.l.ta(ue),f.v=0)}}os(4)}catch{}}var y0=class{constructor(a,h){this.g=a,this.map=h}};function Sg(a){this.l=a||10,l.PerformanceNavigationTiming?(a=l.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ag(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Cg(a){return a.h?1:a.g?a.g.size:0}function kc(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function Vc(a,h){a.g?a.g.add(h):a.h=h}function bg(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Sg.prototype.cancel=function(){if(this.i=Rg(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Rg(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let h=a.i;for(let f of a.g.values())h=h.concat(f.D);return h}return x(a.i)}function v0(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var h=[],f=a.length,g=0;g<f;g++)h.push(a[g]);return h}h=[],f=0;for(g in a)h[f++]=a[g];return h}function w0(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var h=[];a=a.length;for(var f=0;f<a;f++)h.push(f);return h}h=[],f=0;for(let g in a)h[f++]=g;return h}}}function Pg(a,h){if(a.forEach&&typeof a.forEach=="function")a.forEach(h,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,h,void 0);else for(var f=w0(a),g=v0(a),S=g.length,P=0;P<S;P++)h.call(void 0,g[P],f&&f[P],a)}var xg=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function E0(a,h){if(a){a=a.split("&");for(var f=0;f<a.length;f++){var g=a[f].indexOf("="),S=null;if(0<=g){var P=a[f].substring(0,g);S=a[f].substring(g+1)}else P=a[f];h(P,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function nr(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof nr){this.h=a.h,ra(this,a.j),this.o=a.o,this.g=a.g,ia(this,a.s),this.l=a.l;var h=a.i,f=new ds;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),Ng(this,f),this.m=a.m}else a&&(h=String(a).match(xg))?(this.h=!1,ra(this,h[1]||"",!0),this.o=cs(h[2]||""),this.g=cs(h[3]||"",!0),ia(this,h[4]),this.l=cs(h[5]||"",!0),Ng(this,h[6]||"",!0),this.m=cs(h[7]||"")):(this.h=!1,this.i=new ds(null,this.h))}nr.prototype.toString=function(){var a=[],h=this.j;h&&a.push(hs(h,Dg,!0),":");var f=this.g;return(f||h=="file")&&(a.push("//"),(h=this.o)&&a.push(hs(h,Dg,!0),"@"),a.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&a.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&a.push("/"),a.push(hs(f,f.charAt(0)=="/"?S0:T0,!0))),(f=this.i.toString())&&a.push("?",f),(f=this.m)&&a.push("#",hs(f,C0)),a.join("")};function tn(a){return new nr(a)}function ra(a,h,f){a.j=f?cs(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function ia(a,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);a.s=h}else a.s=null}function Ng(a,h,f){h instanceof ds?(a.i=h,b0(a.i,a.h)):(f||(h=hs(h,A0)),a.i=new ds(h,a.h))}function ve(a,h,f){a.i.set(h,f)}function sa(a){return ve(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function cs(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function hs(a,h,f){return typeof a=="string"?(a=encodeURI(a).replace(h,I0),f&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function I0(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Dg=/[#\/\?@]/g,T0=/[#\?:]/g,S0=/[#\?]/g,A0=/[#\?@]/g,C0=/#/g;function ds(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function yn(a){a.g||(a.g=new Map,a.h=0,a.i&&E0(a.i,function(h,f){a.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=ds.prototype,n.add=function(a,h){yn(this),this.i=null,a=Br(this,a);var f=this.g.get(a);return f||this.g.set(a,f=[]),f.push(h),this.h+=1,this};function kg(a,h){yn(a),h=Br(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function Vg(a,h){return yn(a),h=Br(a,h),a.g.has(h)}n.forEach=function(a,h){yn(this),this.g.forEach(function(f,g){f.forEach(function(S){a.call(h,S,g,this)},this)},this)},n.na=function(){yn(this);let a=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let g=0;g<h.length;g++){let S=a[g];for(let P=0;P<S.length;P++)f.push(h[g])}return f},n.V=function(a){yn(this);let h=[];if(typeof a=="string")Vg(this,a)&&(h=h.concat(this.g.get(Br(this,a))));else{a=Array.from(this.g.values());for(let f=0;f<a.length;f++)h=h.concat(a[f])}return h},n.set=function(a,h){return yn(this),this.i=null,a=Br(this,a),Vg(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},n.get=function(a,h){return a?(a=this.V(a),0<a.length?String(a[0]):h):h};function Mg(a,h,f){kg(a,h),0<f.length&&(a.i=null,a.g.set(Br(a,h),x(f)),a.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var g=h[f];let P=encodeURIComponent(String(g)),O=this.V(g);for(g=0;g<O.length;g++){var S=P;O[g]!==""&&(S+="="+encodeURIComponent(String(O[g]))),a.push(S)}}return this.i=a.join("&")};function Br(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function b0(a,h){h&&!a.j&&(yn(a),a.i=null,a.g.forEach(function(f,g){var S=g.toLowerCase();g!=S&&(kg(this,g),Mg(this,S,f))},a)),a.j=h}function R0(a,h){let f=new ls;if(l.Image){let g=new Image;g.onload=y(vn,f,"TestLoadImage: loaded",!0,h,g),g.onerror=y(vn,f,"TestLoadImage: error",!1,h,g),g.onabort=y(vn,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=y(vn,f,"TestLoadImage: timeout",!1,h,g),l.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else h(!1)}function P0(a,h){let f=new ls,g=new AbortController,S=setTimeout(()=>{g.abort(),vn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:g.signal}).then(P=>{clearTimeout(S),P.ok?vn(f,"TestPingServer: ok",!0,h):vn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(S),vn(f,"TestPingServer: error",!1,h)})}function vn(a,h,f,g,S){try{S&&(S.onload=null,S.onerror=null,S.onabort=null,S.ontimeout=null),g(f)}catch{}}function x0(){this.g=new d0}function N0(a,h,f){let g=f||"";try{Pg(a,function(S,P){let O=S;c(S)&&(O=Sc(S)),h.push(g+P+"="+encodeURIComponent(O))})}catch(S){throw h.push(g+"type="+encodeURIComponent("_badmap")),S}}function fs(a){this.l=a.Ub||null,this.j=a.eb||!1}A(fs,Ac),fs.prototype.g=function(){return new oa(this.l,this.j)},fs.prototype.i=function(a){return function(){return a}}({});function oa(a,h){He.call(this),this.D=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}A(oa,He),n=oa.prototype,n.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=h,this.readyState=1,ps(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(h.body=a),(this.D||l).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ms(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ps(this)),this.g&&(this.readyState=3,ps(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Og(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Og(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?ms(this):ps(this),this.readyState==3&&Og(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,ms(this))},n.Qa=function(a){this.g&&(this.response=a,ms(this))},n.ga=function(){this.g&&ms(this)};function ms(a){a.readyState=4,a.l=null,a.j=null,a.v=null,ps(a)}n.setRequestHeader=function(a,h){this.u.append(a,h)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,a.push(f[0]+": "+f[1]),f=h.next();return a.join(`\r
`)};function ps(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(oa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Fg(a){let h="";return $(a,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function Mc(a,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=Fg(f),typeof a=="string"?f!=null&&encodeURIComponent(String(f)):ve(a,h,f))}function Ce(a){He.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}A(Ce,He);var D0=/^https?$/i,k0=["POST","PUT"];n=Ce.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Rc.g(),this.v=this.o?dg(this.o):dg(Rc),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(P){Lg(this,P);return}if(a=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var S in g)f.set(S,g[S]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let P of g.keys())f.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(P=>P.toLowerCase()=="content-type"),S=l.FormData&&a instanceof l.FormData,!(0<=Array.prototype.indexOf.call(k0,h,void 0))||g||S||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,O]of f)this.g.setRequestHeader(P,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Bg(this),this.u=!0,this.g.send(a),this.u=!1}catch(P){Lg(this,P)}};function Lg(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.m=5,Ug(a),aa(a)}function Ug(a){a.A||(a.A=!0,tt(a,"complete"),tt(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,tt(this,"complete"),tt(this,"abort"),aa(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),aa(this,!0)),Ce.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?qg(this):this.bb())},n.bb=function(){qg(this)};function qg(a){if(a.h&&typeof o<"u"&&(!a.v[1]||nn(a)!=4||a.Z()!=2)){if(a.u&&nn(a)==4)lg(a.Ea,0,a);else if(tt(a,"readystatechange"),nn(a)==4){a.h=!1;try{let O=a.Z();e:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=O===0){var S=String(a.D).match(xg)[1]||null;!S&&l.self&&l.self.location&&(S=l.self.location.protocol.slice(0,-1)),g=!D0.test(S?S.toLowerCase():"")}f=g}if(f)tt(a,"complete"),tt(a,"success");else{a.m=6;try{var P=2<nn(a)?a.g.statusText:""}catch{P=""}a.l=P+" ["+a.Z()+"]",Ug(a)}}finally{aa(a)}}}}function aa(a,h){if(a.g){Bg(a);let f=a.g,g=a.v[0]?()=>{}:null;a.g=null,a.v=null,h||tt(a,"ready");try{f.onreadystatechange=g}catch{}}}function Bg(a){a.I&&(l.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function nn(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<nn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),h0(h)}};function Gg(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function V0(a){let h={};a=(a.g&&2<=nn(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(j(a[g]))continue;var f=T(a[g]);let S=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let P=h[S]||[];h[S]=P,P.push(f)}E(h,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function gs(a,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[a]||h}function jg(a){this.Aa=0,this.i=[],this.j=new ls,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=gs("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=gs("baseRetryDelayMs",5e3,a),this.cb=gs("retryDelaySeedMs",1e4,a),this.Wa=gs("forwardChannelMaxRetries",2,a),this.wa=gs("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Sg(a&&a.concurrentRequestLimit),this.Da=new x0,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=jg.prototype,n.la=8,n.G=1,n.connect=function(a,h,f,g){nt(0),this.W=a,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.I=Xg(this,null,this.W),ua(this)};function Oc(a){if(zg(a),a.G==3){var h=a.U++,f=tn(a.I);if(ve(f,"SID",a.K),ve(f,"RID",h),ve(f,"TYPE","terminate"),_s(a,f),h=new _n(a,a.j,h),h.L=2,h.v=sa(tn(f)),f=!1,l.navigator&&l.navigator.sendBeacon)try{f=l.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&l.Image&&(new Image().src=h.v,f=!0),f||(h.g=Zg(h.j,null),h.g.ea(h.v)),h.F=Date.now(),na(h)}Jg(a)}function la(a){a.g&&(Lc(a),a.g.cancel(),a.g=null)}function zg(a){la(a),a.u&&(l.clearTimeout(a.u),a.u=null),ca(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&l.clearTimeout(a.s),a.s=null)}function ua(a){if(!Ag(a.h)&&!a.s){a.s=!0;var h=a.Ga;es||ng(),ts||(es(),ts=!0),pc.add(h,a),a.B=0}}function M0(a,h){return Cg(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=h.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=as(p(a.Ga,a,h),Yg(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let S=new _n(this,this.j,a),P=this.o;if(this.S&&(P?(P=_(P),I(P,this.S)):P=this.S),this.m!==null||this.O||(S.H=P,P=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=Wg(this,S,h),f=tn(this.I),ve(f,"RID",a),ve(f,"CVER",22),this.D&&ve(f,"X-HTTP-Session-Id",this.D),_s(this,f),P&&(this.O?h="headers="+encodeURIComponent(String(Fg(P)))+"&"+h:this.m&&Mc(f,this.m,P)),Vc(this.h,S),this.Ua&&ve(f,"TYPE","init"),this.P?(ve(f,"$req",h),ve(f,"SID","null"),S.T=!0,xc(S,f,null)):xc(S,f,h),this.G=2}}else this.G==3&&(a?Kg(this,a):this.i.length==0||Ag(this.h)||Kg(this))};function Kg(a,h){var f;h?f=h.l:f=a.U++;let g=tn(a.I);ve(g,"SID",a.K),ve(g,"RID",f),ve(g,"AID",a.T),_s(a,g),a.m&&a.o&&Mc(g,a.m,a.o),f=new _n(a,a.j,f,a.B+1),a.m===null&&(f.H=a.o),h&&(a.i=h.D.concat(a.i)),h=Wg(a,f,1e3),f.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Vc(a.h,f),xc(f,g,h)}function _s(a,h){a.H&&$(a.H,function(f,g){ve(h,g,f)}),a.l&&Pg({},function(f,g){ve(h,g,f)})}function Wg(a,h,f){f=Math.min(a.i.length,f);var g=a.l?p(a.l.Na,a.l,a):null;e:{var S=a.i;let P=-1;for(;;){let O=["count="+f];P==-1?0<f?(P=S[0].g,O.push("ofs="+P)):P=0:O.push("ofs="+P);let fe=!0;for(let Ke=0;Ke<f;Ke++){let ue=S[Ke].g,Ye=S[Ke].map;if(ue-=P,0>ue)P=Math.max(0,S[Ke].g-100),fe=!1;else try{N0(Ye,O,"req"+ue+"_")}catch{g&&g(Ye)}}if(fe){g=O.join("&");break e}}}return a=a.i.splice(0,f),h.D=a,g}function Qg(a){if(!a.g&&!a.u){a.Y=1;var h=a.Fa;es||ng(),ts||(es(),ts=!0),pc.add(h,a),a.v=0}}function Fc(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=as(p(a.Fa,a),Yg(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,$g(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=as(p(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,nt(10),la(this),$g(this))};function Lc(a){a.A!=null&&(l.clearTimeout(a.A),a.A=null)}function $g(a){a.g=new _n(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var h=tn(a.qa);ve(h,"RID","rpc"),ve(h,"SID",a.K),ve(h,"AID",a.T),ve(h,"CI",a.F?"0":"1"),!a.F&&a.ja&&ve(h,"TO",a.ja),ve(h,"TYPE","xmlhttp"),_s(a,h),a.m&&a.o&&Mc(h,a.m,a.o),a.L&&(a.g.I=a.L);var f=a.g;a=a.ia,f.L=1,f.v=sa(tn(h)),f.m=null,f.P=!0,Eg(f,a)}n.Za=function(){this.C!=null&&(this.C=null,la(this),Fc(this),nt(19))};function ca(a){a.C!=null&&(l.clearTimeout(a.C),a.C=null)}function Hg(a,h){var f=null;if(a.g==h){ca(a),Lc(a),a.g=null;var g=2}else if(kc(a.h,h))f=h.D,bg(a.h,h),g=1;else return;if(a.G!=0){if(h.o)if(g==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var S=a.B;g=Zo(),tt(g,new _g(g,f)),ua(a)}else Qg(a);else if(S=h.s,S==3||S==0&&0<h.X||!(g==1&&M0(a,h)||g==2&&Fc(a)))switch(f&&0<f.length&&(h=a.h,h.i=h.i.concat(f)),S){case 1:rr(a,5);break;case 4:rr(a,10);break;case 3:rr(a,6);break;default:rr(a,2)}}}function Yg(a,h){let f=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(f*=2),f*h}function rr(a,h){if(a.j.info("Error code "+h),h==2){var f=p(a.fb,a),g=a.Xa;let S=!g;g=new nr(g||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||ra(g,"https"),sa(g),S?R0(g.toString(),f):P0(g.toString(),f)}else nt(2);a.G=0,a.l&&a.l.sa(h),Jg(a),zg(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),nt(2)):(this.j.info("Failed to ping google.com"),nt(1))};function Jg(a){if(a.G=0,a.ka=[],a.l){let h=Rg(a.h);(h.length!=0||a.i.length!=0)&&(D(a.ka,h),D(a.ka,a.i),a.h.i.length=0,x(a.i),a.i.length=0),a.l.ra()}}function Xg(a,h,f){var g=f instanceof nr?tn(f):new nr(f);if(g.g!="")h&&(g.g=h+"."+g.g),ia(g,g.s);else{var S=l.location;g=S.protocol,h=h?h+"."+S.hostname:S.hostname,S=+S.port;var P=new nr(null);g&&ra(P,g),h&&(P.g=h),S&&ia(P,S),f&&(P.l=f),g=P}return f=a.D,h=a.ya,f&&h&&ve(g,f,h),ve(g,"VER",a.la),_s(a,g),g}function Zg(a,h,f){if(h&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Ca&&!a.pa?new Ce(new fs({eb:f})):new Ce(a.pa),h.Ha(a.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function e_(){}n=e_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ha(){}ha.prototype.g=function(a,h){return new dt(a,h)};function dt(a,h){He.call(this),this.g=new jg(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(a?a["X-WebChannel-Client-Profile"]=h.va:a={"X-WebChannel-Client-Profile":h.va}),this.g.S=a,(a=h&&h.Sb)&&!j(a)&&(this.g.m=a),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!j(h)&&(this.g.D=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new Gr(this)}A(dt,He),dt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},dt.prototype.close=function(){Oc(this.g)},dt.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var f={};f.__data__=a,a=f}else this.u&&(f={},f.__data__=Sc(a),a=f);h.i.push(new y0(h.Ya++,a)),h.G==3&&ua(h)},dt.prototype.N=function(){this.g.l=null,delete this.j,Oc(this.g),delete this.g,dt.aa.N.call(this)};function t_(a){Cc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(let f in h){a=f;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}A(t_,Cc);function n_(){bc.call(this),this.status=1}A(n_,bc);function Gr(a){this.g=a}A(Gr,e_),Gr.prototype.ua=function(){tt(this.g,"a")},Gr.prototype.ta=function(a){tt(this.g,new t_(a))},Gr.prototype.sa=function(a){tt(this.g,new n_)},Gr.prototype.ra=function(){tt(this.g,"b")},ha.prototype.createWebChannel=ha.prototype.g,dt.prototype.send=dt.prototype.o,dt.prototype.open=dt.prototype.m,dt.prototype.close=dt.prototype.close,sh=rn.createWebChannelTransport=function(){return new ha},ih=rn.getStatEventTarget=function(){return Zo()},rh=rn.Event=er,Ja=rn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ea.NO_ERROR=0,ea.TIMEOUT=8,ea.HTTP_ERROR=6,bs=rn.ErrorCode=ea,yg.COMPLETE="complete",nh=rn.EventType=yg,fg.EventType=ss,ss.OPEN="a",ss.CLOSE="b",ss.ERROR="c",ss.MESSAGE="d",He.prototype.listen=He.prototype.K,Hr=rn.WebChannel=fg,th=rn.FetchXmlHttpFactory=fs,Ce.prototype.listenOnce=Ce.prototype.L,Ce.prototype.getLastError=Ce.prototype.Ka,Ce.prototype.getLastErrorCode=Ce.prototype.Ba,Ce.prototype.getStatus=Ce.prototype.Z,Ce.prototype.getResponseJson=Ce.prototype.Oa,Ce.prototype.getResponseText=Ce.prototype.oa,Ce.prototype.send=Ce.prototype.ea,Ce.prototype.setWithCredentials=Ce.prototype.Ha,eh=rn.XhrIo=Ce}).apply(typeof Ya<"u"?Ya:typeof self<"u"?self:typeof window<"u"?window:{});var ey="@firebase/firestore";var Me=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Me.UNAUTHENTICATED=new Me(null),Me.GOOGLE_CREDENTIALS=new Me("google-credentials-uid"),Me.FIRST_PARTY=new Me("first-party-uid"),Me.MOCK_USER=new Me("mock-user");var Ci="10.13.0";var Dn=new Qr("@firebase/firestore");function ei(){return Dn.logLevel}function nv(n){Dn.setLogLevel(n)}function V(n,...e){if(Dn.logLevel<=Et.DEBUG){let t=e.map(hf);Dn.debug(`Firestore (${Ci}): ${n}`,...t)}}function Re(n,...e){if(Dn.logLevel<=Et.ERROR){let t=e.map(hf);Dn.error(`Firestore (${Ci}): ${n}`,...t)}}function Tt(n,...e){if(Dn.logLevel<=Et.WARN){let t=e.map(hf);Dn.warn(`Firestore (${Ci}): ${n}`,...t)}}function hf(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function U(n="Unexpected state"){let e=`FIRESTORE (${Ci}) INTERNAL ASSERTION FAILED: `+n;throw Re(e),new Error(e)}function G(n,e){n||U()}function rv(n,e){n||U()}function F(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends O_{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Oe=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var ll=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},ch=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Me.UNAUTHENTICATED))}shutdown(){}},hh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},dh=class{constructor(e){this.t=e,this.currentUser=Me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Oe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Oe,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>N(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},l=u=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>l(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?l(u):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Oe)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(G(typeof r.accessToken=="string"),new ll(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Me(e)}},fh=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Me.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},mh=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new fh(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Me.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ph=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},gh=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,V("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new ph(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function U0(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var ul=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=U0(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function Q(n,e){return n<e?-1:n>e?1:0}function ui(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function iv(n){return n+"\0"}var Se=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new k(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var z=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new Se(0,0))}static max(){return new n(new Se(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var cl=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&U(),r===void 0?r=e.length-t:r>e.length-t&&U(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ae=class n extends cl{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new k(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},q0=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Pe=class n extends cl{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return q0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new k(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let l=e[i];if(l==="\\"){if(i+1===e.length)throw new k(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new k(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else l==="`"?(o=!o,i++):l!=="."||o?(r+=l,i++):(s(),i++)}if(s(),o)throw new k(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(ae.fromString(e))}static fromName(e){return new n(ae.fromString(e).popFirst(5))}static empty(){return new n(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ae(e.slice()))}};var ci=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function _h(n){return n.fields.find(e=>e.kind===2)}function or(n){return n.fields.filter(e=>e.kind!==2)}ci.UNKNOWN_ID=-1;var oi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Us=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,St.min())}};function sv(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(r===1e9?new Se(t+1,0):new Se(t,r));return new St(i,L.empty(),e)}function ov(n){return new St(n.readTime,n.key,-1)}var St=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(z.min(),L.empty(),-1)}static max(){return new n(z.max(),L.empty(),-1)}};function df(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:Q(n.largestBatchId,e.largestBatchId))}var av="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",hl=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Gn(n){return N(this,null,function*(){if(n.code!==R.FAILED_PRECONDITION||n.message!==av)throw n;V("LocalStore","Unexpectedly lost primary lease")})}var b=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(l=>{++i,l.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),l=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(d=>{o[c]=d,++l,l===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var dl=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Oe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new dr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=ff(r.target.error);this.V.reject(new dr(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new dr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(V("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new vh(t)}},kn=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(Ts())===12.2&&Re("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return V("SimpleDb","Removing database:",e),ar(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!M_())return!1;if(n.v())return!0;let e=Ts(),t=n.S(e),r=0<t&&t<10,i=lv(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return N(this,null,function*(){return this.db||(V("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new dr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new k(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new k(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new dr(e,o))},i.onupgradeneeded=s=>{V("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{V("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return N(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let l=dl.open(this.db,e,s?"readonly":"readwrite",r),u=i(l).next(c=>(l.g(),c)).catch(c=>(l.abort(c),b.reject(c))).toPromise();return u.catch(()=>{}),yield l.m,u}catch(l){let u=l,c=u.name!=="FirebaseError"&&o<3;if(V("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function lv(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var yh=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ar(this.B.delete())}},dr=class extends k{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function jn(n){return n.name==="IndexedDbTransactionError"}var vh=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(V("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(V("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ar(r)}add(e){return V("SimpleDb","ADD",this.store.name,e,e),ar(this.store.add(e))}get(e){return ar(this.store.get(e)).next(t=>(t===void 0&&(t=null),V("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return V("SimpleDb","DELETE",this.store.name,e),ar(this.store.delete(e))}count(){return V("SimpleDb","COUNT",this.store.name),ar(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new b((o,l)=>{s.onerror=u=>{l(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(l,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new b((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){V("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,l)=>l.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new b((r,i)=>{t.onerror=s=>{let o=ff(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(l=>{l?o.continue():r()}):r()}})}W(e,t){let r=[];return new b((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let l=o.target.result;if(!l)return void i();let u=new yh(l),c=t(l.primaryKey,l.value,u);if(c instanceof b){let d=c.catch(m=>(u.done(),b.reject(m)));r.push(d)}u.isDone?i():u.K===null?l.continue():l.continue(u.K)}}).next(()=>b.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function ar(n){return new b((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=ff(r.target.error);t(i)}})}var ty=!1;function ff(n){let e=kn.S(Ts());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ty||(ty=!0,setTimeout(()=>{throw r},0)),r}}return n}var wh=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){V("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>N(this,null,function*(){this.task=null;try{V("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){jn(t)?V("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Gn(t)}yield this.X(6e4)}))}},Eh=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return N(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return V("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(l=>{i-=l,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(l=>(V("IndexBackfiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=ov(s);df(o,r)>0&&(r=o)}),new St(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var mt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function lo(n){return n==null}function qs(n){return n===0&&1/n==-1/0}function uv(n){return typeof n=="number"&&Number.isInteger(n)&&!qs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function it(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ny(e)),e=B0(n.get(t),e);return ny(e)}function B0(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function ny(n){return n+""}function Ut(n){let e=n.length;if(G(e>=2),e===2)return G(n.charAt(0)===""&&n.charAt(1)===""),ae.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&U(),n.charAt(o+1)){case"":let l=n.substring(s,o),u;i.length===0?u=l:(i+=l,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:U()}s=o+2}return new ae(r)}var ry=["userId","batchId"];function nl(n,e){return[n,it(e)]}function cv(n,e,t){return[n,it(e),t]}var G0={},j0=["prefixPath","collectionGroup","readTime","documentId"],z0=["prefixPath","collectionGroup","documentId"],K0=["collectionGroup","readTime","prefixPath","documentId"],W0=["canonicalId","targetId"],Q0=["targetId","path"],$0=["path","targetId"],H0=["collectionId","parent"],Y0=["indexId","uid"],J0=["uid","sequenceNumber"],X0=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Z0=["indexId","uid","orderedDocumentKey"],eS=["userId","collectionPath","documentId"],tS=["userId","collectionPath","largestBatchId"],nS=["userId","collectionGroup","largestBatchId"],hv=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],rS=[...hv,"documentOverlays"],dv=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],fv=dv,mf=[...fv,"indexConfiguration","indexState","indexEntries"],iS=mf,sS=[...mf,"globals"];var Bs=class extends hl{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function qe(n,e){let t=F(n);return kn.F(t._e,e)}function iy(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Sr(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function mv(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var we=class n{constructor(e,t){this.comparator=e,this.root=t||Bt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Bt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Bt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new si(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new si(this.root,e,this.comparator,!1)}getReverseIterator(){return new si(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new si(this.root,e,this.comparator,!0)}},si=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Bt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};Bt.EMPTY=null,Bt.RED=!0,Bt.BLACK=!1;Bt.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Bt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var pe=class n{constructor(e){this.comparator=e,this.data=new we(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new fl(this.data.getIterator())}getIteratorFrom(e){return new fl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},fl=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Yr(n){return n.hasNext()?n.getNext():void 0}var pt=class n{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new n([])}unionWith(e){let t=new pe(Pe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ui(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var ml=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function pv(){return typeof atob<"u"}var Ne=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ml("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ne.EMPTY_BYTE_STRING=new Ne("");var oS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function an(n){if(G(!!n),typeof n=="string"){let e=0,t=oS.exec(n);if(G(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ee(n.seconds),nanos:Ee(n.nanos)}}function Ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Vn(n){return typeof n=="string"?Ne.fromBase64String(n):Ne.fromUint8Array(n)}function iu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function pf(n){let e=n.mapValue.fields.__previous_value__;return iu(e)?pf(e):e}function Gs(n){let e=an(n.mapValue.fields.__local_write_time__.timestampValue);return new Se(e.seconds,e.nanos)}var Ih=class{constructor(e,t,r,i,s,o,l,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=c}},Mn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var xn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},rl={nullValue:"NULL_VALUE"};function fr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?iu(n)?4:gv(n)?9007199254740991:su(n)?10:11:U()}function zt(n,e){if(n===e)return!0;let t=fr(n);if(t!==fr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Gs(n).isEqual(Gs(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=an(i.timestampValue),l=an(s.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Vn(i.bytesValue).isEqual(Vn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Ee(i.geoPointValue.latitude)===Ee(s.geoPointValue.latitude)&&Ee(i.geoPointValue.longitude)===Ee(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ee(i.integerValue)===Ee(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=Ee(i.doubleValue),l=Ee(s.doubleValue);return o===l?qs(o)===qs(l):isNaN(o)&&isNaN(l)}return!1}(n,e);case 9:return ui(n.arrayValue.values||[],e.arrayValue.values||[],zt);case 10:case 11:return function(i,s){let o=i.mapValue.fields||{},l=s.mapValue.fields||{};if(iy(o)!==iy(l))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(l[u]===void 0||!zt(o[u],l[u])))return!1;return!0}(n,e);default:return U()}}function js(n,e){return(n.values||[]).find(t=>zt(t,e))!==void 0}function On(n,e){if(n===e)return 0;let t=fr(n),r=fr(e);if(t!==r)return Q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,e.booleanValue);case 2:return function(s,o){let l=Ee(s.integerValue||s.doubleValue),u=Ee(o.integerValue||o.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1}(n,e);case 3:return sy(n.timestampValue,e.timestampValue);case 4:return sy(Gs(n),Gs(e));case 5:return Q(n.stringValue,e.stringValue);case 6:return function(s,o){let l=Vn(s),u=Vn(o);return l.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let l=s.split("/"),u=o.split("/");for(let c=0;c<l.length&&c<u.length;c++){let d=Q(l[c],u[c]);if(d!==0)return d}return Q(l.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let l=Q(Ee(s.latitude),Ee(o.latitude));return l!==0?l:Q(Ee(s.longitude),Ee(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return oy(n.arrayValue,e.arrayValue);case 10:return function(s,o){var l,u,c,d;let m=s.fields||{},p=o.fields||{},y=(l=m.value)===null||l===void 0?void 0:l.arrayValue,A=(u=p.value)===null||u===void 0?void 0:u.arrayValue,x=Q(((c=y?.values)===null||c===void 0?void 0:c.length)||0,((d=A?.values)===null||d===void 0?void 0:d.length)||0);return x!==0?x:oy(y,A)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===xn.mapValue&&o===xn.mapValue)return 0;if(s===xn.mapValue)return 1;if(o===xn.mapValue)return-1;let l=s.fields||{},u=Object.keys(l),c=o.fields||{},d=Object.keys(c);u.sort(),d.sort();for(let m=0;m<u.length&&m<d.length;++m){let p=Q(u[m],d[m]);if(p!==0)return p;let y=On(l[u[m]],c[d[m]]);if(y!==0)return y}return Q(u.length,d.length)}(n.mapValue,e.mapValue);default:throw U()}}function sy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Q(n,e);let t=an(n),r=an(e),i=Q(t.seconds,r.seconds);return i!==0?i:Q(t.nanos,r.nanos)}function oy(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=On(t[i],r[i]);if(s)return s}return Q(t.length,r.length)}function hi(n){return Th(n)}function Th(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=an(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Vn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return L.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Th(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Th(t.fields[o])}`;return i+"}"}(n.mapValue):U()}function mr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Sh(n){return!!n&&"integerValue"in n}function zs(n){return!!n&&"arrayValue"in n}function ay(n){return!!n&&"nullValue"in n}function ly(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function il(n){return!!n&&"mapValue"in n}function su(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Vs(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Sr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Vs(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Vs(n.arrayValue.values[t]);return e}return Object.assign({},n)}function gv(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var _v={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function aS(n){return"nullValue"in n?rl:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?mr(Mn.empty(),L.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?su(n)?_v:{mapValue:{}}:U()}function lS(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?mr(Mn.empty(),L.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?_v:"mapValue"in n?su(n)?{mapValue:{}}:xn:U()}function uy(n,e){let t=On(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function cy(n,e){let t=On(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Ze=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!il(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Vs(t)}setAll(e){let t=Pe.emptyPath(),r={},i=[];e.forEach((o,l)=>{if(!t.isImmediateParentOf(l)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=l.popLast()}o?r[l.lastSegment()]=Vs(o):i.push(l.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());il(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return zt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];il(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Sr(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Vs(this.value))}};function yv(n){let e=[];return Sr(n.fields,(t,r)=>{let i=new Pe([t]);if(il(r)){let s=yv(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new pt(e)}var Fe=class n{constructor(e,t,r,i,s,o,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=l}static newInvalidDocument(e){return new n(e,0,z.min(),z.min(),z.min(),Ze.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,z.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,z.min(),z.min(),Ze.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,z.min(),z.min(),Ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Kt=class{constructor(e,t){this.position=e,this.inclusive=t}};function hy(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=L.comparator(L.fromName(o.referenceValue),t.key):r=On(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function dy(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!zt(n.position[t],e.position[t]))return!1;return!0}var pr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function uS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var pl=class{},re=class n extends pl{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new bh(e,t,r):t==="array-contains"?new xh(e,r):t==="in"?new gl(e,r):t==="not-in"?new Nh(e,r):t==="array-contains-any"?new Dh(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Rh(e,r):new Ph(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(On(t,this.value)):t!==null&&fr(this.value)===fr(t)&&this.matchesComparison(On(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},de=class n extends pl{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return di(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function di(n){return n.op==="and"}function Ah(n){return n.op==="or"}function gf(n){return vv(n)&&di(n)}function vv(n){for(let e of n.filters)if(e instanceof de)return!1;return!0}function Ch(n){if(n instanceof re)return n.field.canonicalString()+n.op.toString()+hi(n.value);if(gf(n))return n.filters.map(e=>Ch(e)).join(",");{let e=n.filters.map(t=>Ch(t)).join(",");return`${n.op}(${e})`}}function wv(n,e){return n instanceof re?function(r,i){return i instanceof re&&r.op===i.op&&r.field.isEqual(i.field)&&zt(r.value,i.value)}(n,e):n instanceof de?function(r,i){return i instanceof de&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,l)=>s&&wv(o,i.filters[l]),!0):!1}(n,e):void U()}function Ev(n,e){let t=n.filters.concat(e);return de.create(t,n.op)}function Iv(n){return n instanceof re?function(t){return`${t.field.canonicalString()} ${t.op} ${hi(t.value)}`}(n):n instanceof de?function(t){return t.op.toString()+" {"+t.getFilters().map(Iv).join(" ,")+"}"}(n):"Filter"}var bh=class extends re{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},Rh=class extends re{constructor(e,t){super(e,"in",t),this.keys=Tv("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Ph=class extends re{constructor(e,t){super(e,"not-in",t),this.keys=Tv("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Tv(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}var xh=class extends re{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return zs(t)&&js(t.arrayValue,this.value)}},gl=class extends re{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&js(this.value.arrayValue,t)}},Nh=class extends re{constructor(e,t){super(e,"not-in",t)}matches(e){if(js(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!js(this.value.arrayValue,t)}},Dh=class extends re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!zs(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>js(this.value.arrayValue,r))}};var kh=class{constructor(e,t=null,r=[],i=[],s=null,o=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=l,this.ue=null}};function Vh(n,e=null,t=[],r=[],i=null,s=null,o=null){return new kh(n,e,t,r,i,s,o)}function gr(n){let e=F(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ch(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),lo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>hi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>hi(r)).join(",")),e.ue=t}return e.ue}function uo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!uS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!wv(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!dy(n.startAt,e.startAt)&&dy(n.endAt,e.endAt)}function _l(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function yl(n,e){return n.filters.filter(t=>t instanceof re&&t.field.isEqual(e))}function fy(n,e,t){let r=rl,i=!0;for(let s of yl(n,e)){let o=rl,l=!0;switch(s.op){case"<":case"<=":o=aS(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,l=!1;break;case"!=":case"not-in":o=rl}uy({value:r,inclusive:i},{value:o,inclusive:l})<0&&(r=o,i=l)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];uy({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function my(n,e,t){let r=xn,i=!0;for(let s of yl(n,e)){let o=xn,l=!0;switch(s.op){case">=":case">":o=lS(s.value),l=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,l=!1;break;case"!=":case"not-in":o=xn}cy({value:r,inclusive:i},{value:o,inclusive:l})>0&&(r=o,i=l)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];cy({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var xt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=l,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Sv(n,e,t,r,i,s,o,l){return new xt(n,e,t,r,i,s,o,l)}function bi(n){return new xt(n)}function py(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function _f(n){return n.collectionGroup!==null}function ai(n){let e=F(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new pe(Pe.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(l=l.add(c.field))})}),l})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new pr(s,r))}),t.has(Pe.keyField().canonicalString())||e.ce.push(new pr(Pe.keyField(),r))}return e.ce}function st(n){let e=F(n);return e.le||(e.le=cS(e,ai(n))),e.le}function cS(n,e){if(n.limitType==="F")return Vh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new pr(i.field,s)});let t=n.endAt?new Kt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Kt(n.startAt.position,n.startAt.inclusive):null;return Vh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Mh(n,e){let t=n.filters.concat([e]);return new xt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function vl(n,e,t){return new xt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function co(n,e){return uo(st(n),st(e))&&n.limitType===e.limitType}function Av(n){return`${gr(st(n))}|lt:${n.limitType}`}function ti(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Iv(i)).join(", ")}]`),lo(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>hi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>hi(i)).join(",")),`Target(${r})`}(st(n))}; limitType=${n.limitType})`}function ho(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):L.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of ai(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,l,u){let c=hy(o,l,u);return o.inclusive?c<=0:c<0}(r.startAt,ai(r),i)||r.endAt&&!function(o,l,u){let c=hy(o,l,u);return o.inclusive?c>=0:c>0}(r.endAt,ai(r),i))}(n,e)}function Cv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function bv(n){return(e,t)=>{let r=!1;for(let i of ai(n)){let s=hS(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function hS(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):function(s,o,l){let u=o.data.field(s),c=l.data.field(s);return u!==null&&c!==null?On(u,c):U()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U()}}var Wt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Sr(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return mv(this.inner)}size(){return this.innerSize}};var dS=new we(L.comparator);function ht(){return dS}var Rv=new we(L.comparator);function Ds(...n){let e=Rv;for(let t of n)e=e.insert(t.key,t);return e}function Pv(n){let e=Rv;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function qt(){return Ms()}function xv(){return Ms()}function Ms(){return new Wt(n=>n.toString(),(n,e)=>n.isEqual(e))}var fS=new we(L.comparator),mS=new pe(L.comparator);function Y(...n){let e=mS;for(let t of n)e=e.add(t);return e}var pS=new pe(Q);function yf(){return pS}function vf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qs(e)?"-0":e}}function Nv(n){return{integerValue:""+n}}function Dv(n,e){return uv(e)?Nv(e):vf(n,e)}var fi=class{constructor(){this._=void 0}};function gS(n,e,t){return n instanceof Fn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&iu(s)&&(s=pf(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof ln?Vv(n,e):n instanceof un?Mv(n,e):function(i,s){let o=kv(i,s),l=gy(o)+gy(i.Pe);return Sh(o)&&Sh(i.Pe)?Nv(l):vf(i.serializer,l)}(n,e)}function _S(n,e,t){return n instanceof ln?Vv(n,e):n instanceof un?Mv(n,e):t}function kv(n,e){return n instanceof Ln?function(r){return Sh(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var Fn=class extends fi{},ln=class extends fi{constructor(e){super(),this.elements=e}};function Vv(n,e){let t=Ov(e);for(let r of n.elements)t.some(i=>zt(i,r))||t.push(r);return{arrayValue:{values:t}}}var un=class extends fi{constructor(e){super(),this.elements=e}};function Mv(n,e){let t=Ov(e);for(let r of n.elements)t=t.filter(i=>!zt(i,r));return{arrayValue:{values:t}}}var Ln=class extends fi{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function gy(n){return Ee(n.integerValue||n.doubleValue)}function Ov(n){return zs(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var _r=class{constructor(e,t){this.field=e,this.transform=t}};function yS(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof ln&&i instanceof ln||r instanceof un&&i instanceof un?ui(r.elements,i.elements,zt):r instanceof Ln&&i instanceof Ln?zt(r.Pe,i.Pe):r instanceof Fn&&i instanceof Fn}(n.transform,e.transform)}var Oh=class{constructor(e,t){this.version=e,this.transformResults=t}},be=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function sl(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var mi=class{};function Fv(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new qn(n.key,be.none()):new Un(n.key,n.data,be.none());{let t=n.data,r=Ze.empty(),i=new pe(Pe.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Nt(n.key,r,new pt(i.toArray()),be.none())}}function vS(n,e,t){n instanceof Un?function(i,s,o){let l=i.value.clone(),u=yy(i.fieldTransforms,s,o.transformResults);l.setAll(u),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):n instanceof Nt?function(i,s,o){if(!sl(i.precondition,s))return void s.convertToUnknownDocument(o.version);let l=yy(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Lv(i)),u.setAll(l),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Os(n,e,t,r){return n instanceof Un?function(s,o,l,u){if(!sl(s.precondition,o))return l;let c=s.value.clone(),d=vy(s.fieldTransforms,u,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Nt?function(s,o,l,u){if(!sl(s.precondition,o))return l;let c=vy(s.fieldTransforms,u,o),d=o.data;return d.setAll(Lv(s)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(s,o,l){return sl(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(n,e,t)}function wS(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=kv(r.transform,i||null);s!=null&&(t===null&&(t=Ze.empty()),t.set(r.field,s))}return t||null}function _y(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ui(r,i,(s,o)=>yS(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Un=class extends mi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Nt=class extends mi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Lv(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function yy(n,e,t){let r=new Map;G(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,l=e.data.field(s.field);r.set(s.field,_S(o,l,t[i]))}return r}function vy(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,gS(s,o,e))}return r}var qn=class extends mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ks=class extends mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ws=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&vS(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Os(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Os(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=xv();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,l=this.applyToLocalView(o,s.mutatedFields);l=t.has(i.key)?null:l;let u=Fv(o,l);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(z.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Y())}isEqual(e){return this.batchId===e.batchId&&ui(this.mutations,e.mutations,(t,r)=>_y(t,r))&&ui(this.baseMutations,e.baseMutations,(t,r)=>_y(t,r))}},Fh=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){G(e.mutations.length===r.length);let i=function(){return fS}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Qs=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Lh=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ke,oe;function Uv(n){switch(n){default:return U();case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0}}function qv(n){if(n===void 0)return Re("GRPC error has no .code"),R.UNKNOWN;switch(n){case ke.OK:return R.OK;case ke.CANCELLED:return R.CANCELLED;case ke.UNKNOWN:return R.UNKNOWN;case ke.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case ke.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case ke.INTERNAL:return R.INTERNAL;case ke.UNAVAILABLE:return R.UNAVAILABLE;case ke.UNAUTHENTICATED:return R.UNAUTHENTICATED;case ke.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case ke.NOT_FOUND:return R.NOT_FOUND;case ke.ALREADY_EXISTS:return R.ALREADY_EXISTS;case ke.PERMISSION_DENIED:return R.PERMISSION_DENIED;case ke.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case ke.ABORTED:return R.ABORTED;case ke.OUT_OF_RANGE:return R.OUT_OF_RANGE;case ke.UNIMPLEMENTED:return R.UNIMPLEMENTED;case ke.DATA_LOSS:return R.DATA_LOSS;default:return U()}}(oe=ke||(ke={}))[oe.OK=0]="OK",oe[oe.CANCELLED=1]="CANCELLED",oe[oe.UNKNOWN=2]="UNKNOWN",oe[oe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",oe[oe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",oe[oe.NOT_FOUND=5]="NOT_FOUND",oe[oe.ALREADY_EXISTS=6]="ALREADY_EXISTS",oe[oe.PERMISSION_DENIED=7]="PERMISSION_DENIED",oe[oe.UNAUTHENTICATED=16]="UNAUTHENTICATED",oe[oe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",oe[oe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",oe[oe.ABORTED=10]="ABORTED",oe[oe.OUT_OF_RANGE=11]="OUT_OF_RANGE",oe[oe.UNIMPLEMENTED=12]="UNIMPLEMENTED",oe[oe.INTERNAL=13]="INTERNAL",oe[oe.UNAVAILABLE=14]="UNAVAILABLE",oe[oe.DATA_LOSS=15]="DATA_LOSS";var wy=null;function Bv(){return new TextEncoder}var ES=new An([4294967295,4294967295],0);function Ey(n){let e=Bv().encode(n),t=new Zc;return t.update(e),new Uint8Array(t.digest())}function Iy(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new An([t,r],0),new An([i,s],0)]}var Uh=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new hr(`Invalid padding: ${t}`);if(r<0)throw new hr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new hr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new hr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=An.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(An.fromNumber(r)));return i.compare(ES)===1&&(i=new An([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=Ey(e),[r,i]=Iy(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.Ie===0)return;let t=Ey(e),[r,i]=Iy(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},hr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var $s=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Hs.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(z.min(),i,new we(Q),ht(),Y())}},Hs=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Y(),Y(),Y())}};var li=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},wl=class{constructor(e,t){this.targetId=e,this.me=t}},El=class{constructor(e,t,r=Ne.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Il=class{constructor(){this.fe=0,this.ge=Sy(),this.pe=Ne.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Y(),t=Y(),r=Y();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:U()}}),new Hs(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Sy()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},qh=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=ht(),this.qe=Ty(),this.Qe=new we(Q)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(_l(s))if(r===0){let o=new L(s.path);this.Ue(t,o,Fe.newNoDocument(o,z.min()))}else G(r===1);else{let o=this.Ye(t);if(o!==r){let l=this.Ze(e),u=l?this.Xe(l,e,o):1;if(u!==0){this.je(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}wy?.et(function(d,m,p,y,A){var x,D,B,j,q,J;let ie={localCacheCount:d,existenceFilterCount:m.count,databaseId:p.database,projectId:p.projectId},$=m.unchangedNames;return $&&(ie.bloomFilter={applied:A===0,hashCount:(x=$?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(j=(B=(D=$?.bits)===null||D===void 0?void 0:D.bitmap)===null||B===void 0?void 0:B.length)!==null&&j!==void 0?j:0,padding:(J=(q=$?.bits)===null||q===void 0?void 0:q.padding)!==null&&J!==void 0?J:0,mightContain:E=>{var _;return(_=y?.mightContain(E))!==null&&_!==void 0&&_}}),ie}(o,e.me,this.Le.tt(),l,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,l;try{o=Vn(r).toUint8Array()}catch(u){if(u instanceof ml)return Tt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new Uh(o,i,s)}catch(u){return Tt(u instanceof hr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.Ie===0?null:l}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let l=this.Je(o);if(l){if(s.current&&_l(l.target)){let u=new L(l.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Fe.newNoDocument(u,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=Y();this.qe.forEach((s,o)=>{let l=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new $s(e,t,this.Qe,this.ke,r);return this.ke=ht(),this.qe=Ty(),this.Qe=new we(Q),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Il,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new pe(Q),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||V("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Il),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Ty(){return new we(L.comparator)}function Sy(){return new we(L.comparator)}var IS={asc:"ASCENDING",desc:"DESCENDING"},TS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},SS={and:"AND",or:"OR"},Bh=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Gh(n,e){return n.useProto3Json||lo(e)?e:{value:e}}function pi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Gv(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function AS(n,e){return pi(n,e.toTimestamp())}function xe(n){return G(!!n),z.fromTimestamp(function(t){let r=an(t);return new Se(r.seconds,r.nanos)}(n))}function wf(n,e){return jh(n,e).canonicalString()}function jh(n,e){let t=function(i){return new ae(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function jv(n){let e=ae.fromString(n);return G(Zv(e)),e}function Ys(n,e){return wf(n.databaseId,e.path)}function Gt(n,e){let t=jv(e);if(t.get(1)!==n.databaseId.projectId)throw new k(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new k(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(Wv(t))}function zv(n,e){return wf(n.databaseId,e)}function Kv(n){let e=jv(n);return e.length===4?ae.emptyPath():Wv(e)}function zh(n){return new ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Wv(n){return G(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Ay(n,e,t){return{name:Ys(n,e),fields:t.value.mapValue.fields}}function Qv(n,e,t){let r=Gt(n,e.name),i=xe(e.updateTime),s=e.createTime?xe(e.createTime):z.min(),o=new Ze({mapValue:{fields:e.fields}}),l=Fe.newFoundDocument(r,i,s,o);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function CS(n,e){return"found"in e?function(r,i){G(!!i.found),i.found.name,i.found.updateTime;let s=Gt(r,i.found.name),o=xe(i.found.updateTime),l=i.found.createTime?xe(i.found.createTime):z.min(),u=new Ze({mapValue:{fields:i.found.fields}});return Fe.newFoundDocument(s,o,l,u)}(n,e):"missing"in e?function(r,i){G(!!i.missing),G(!!i.readTime);let s=Gt(r,i.missing),o=xe(i.readTime);return Fe.newNoDocument(s,o)}(n,e):U()}function bS(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:U()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,d){return c.useProto3Json?(G(d===void 0||typeof d=="string"),Ne.fromBase64String(d||"")):(G(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ne.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(c){let d=c.code===void 0?R.UNKNOWN:qv(c.code);return new k(d,c.message||"")}(o);t=new El(r,i,s,l||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Gt(n,r.document.name),s=xe(r.document.updateTime),o=r.document.createTime?xe(r.document.createTime):z.min(),l=new Ze({mapValue:{fields:r.document.fields}}),u=Fe.newFoundDocument(i,s,o,l),c=r.targetIds||[],d=r.removedTargetIds||[];t=new li(c,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Gt(n,r.document),s=r.readTime?xe(r.readTime):z.min(),o=Fe.newNoDocument(i,s),l=r.removedTargetIds||[];t=new li([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Gt(n,r.document),s=r.removedTargetIds||[];t=new li([],s,i,null)}else{if(!("filter"in e))return U();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Lh(i,s),l=r.targetId;t=new wl(l,o)}}return t}function Js(n,e){let t;if(e instanceof Un)t={update:Ay(n,e.key,e.value)};else if(e instanceof qn)t={delete:Ys(n,e.key)};else if(e instanceof Nt)t={update:Ay(n,e.key,e.data),updateMask:kS(e.fieldMask)};else{if(!(e instanceof Ks))return U();t={verify:Ys(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let l=o.transform;if(l instanceof Fn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof ln)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof un)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ln)return{fieldPath:o.field.canonicalString(),increment:l.Pe};throw U()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:AS(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()}(n,e.precondition)),t}function Kh(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?be.updateTime(xe(s.updateTime)):s.exists!==void 0?be.exists(s.exists):be.none()}(e.currentDocument):be.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,l){let u=null;if("setToServerValue"in l)G(l.setToServerValue==="REQUEST_TIME"),u=new Fn;else if("appendMissingElements"in l){let d=l.appendMissingElements.values||[];u=new ln(d)}else if("removeAllFromArray"in l){let d=l.removeAllFromArray.values||[];u=new un(d)}else"increment"in l?u=new Ln(o,l.increment):U();let c=Pe.fromServerFormat(l.fieldPath);return new _r(c,u)}(n,i)):[];if(e.update){e.update.name;let i=Gt(n,e.update.name),s=new Ze({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new pt(c.map(d=>Pe.fromServerFormat(d)))}(e.updateMask);return new Nt(i,s,o,t,r)}return new Un(i,s,t,r)}if(e.delete){let i=Gt(n,e.delete);return new qn(i,t)}if(e.verify){let i=Gt(n,e.verify);return new Ks(i,t)}return U()}function RS(n,e){return n&&n.length>0?(G(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?xe(i.updateTime):xe(s);return o.isEqual(z.min())&&(o=xe(s)),new Oh(o,i.transformResults||[])}(t,e))):[]}function $v(n,e){return{documents:[zv(n,e.path)]}}function Hv(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=zv(n,i);let s=function(c){if(c.length!==0)return Xv(de.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(d=>function(p){return{field:ni(p.field),direction:xS(p.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let l=Gh(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i}}function Yv(n){let e=Kv(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){G(r===1);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=function(m){let p=Jv(m);return p instanceof de&&gf(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(m){return m.map(p=>function(A){return new pr(ri(A.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(p))}(t.orderBy));let l=null;t.limit&&(l=function(m){let p;return p=typeof m=="object"?m.value:m,lo(p)?null:p}(t.limit));let u=null;t.startAt&&(u=function(m){let p=!!m.before,y=m.values||[];return new Kt(y,p)}(t.startAt));let c=null;return t.endAt&&(c=function(m){let p=!m.before,y=m.values||[];return new Kt(y,p)}(t.endAt)),Sv(e,i,o,s,l,"F",u,c)}function PS(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Jv(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=ri(t.unaryFilter.field);return re.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ri(t.unaryFilter.field);return re.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ri(t.unaryFilter.field);return re.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ri(t.unaryFilter.field);return re.create(o,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):n.fieldFilter!==void 0?function(t){return re.create(ri(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return de.create(t.compositeFilter.filters.map(r=>Jv(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}}(t.compositeFilter.op))}(n):U()}function xS(n){return IS[n]}function NS(n){return TS[n]}function DS(n){return SS[n]}function ni(n){return{fieldPath:n.canonicalString()}}function ri(n){return Pe.fromServerFormat(n.fieldPath)}function Xv(n){return n instanceof re?function(t){if(t.op==="=="){if(ly(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NAN"}};if(ay(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(ly(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NAN"}};if(ay(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ni(t.field),op:NS(t.op),value:t.value}}}(n):n instanceof de?function(t){let r=t.getFilters().map(i=>Xv(i));return r.length===1?r[0]:{compositeFilter:{op:DS(t.op),filters:r}}}(n):U()}function kS(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Zv(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var gi=class n{constructor(e,t,r,i,s=z.min(),o=z.min(),l=Ne.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Tl=class{constructor(e){this.ct=e}};function VS(n,e){let t;if(e.document)t=Qv(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=L.fromSegments(e.noDocument.path),i=vr(e.noDocument.readTime);t=Fe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{let r=L.fromSegments(e.unknownDocument.path),i=vr(e.unknownDocument.version);t=Fe.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new Se(i[0],i[1]);return z.fromTimestamp(s)}(e.readTime)),t}function Cy(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Sl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Ys(s,o.key),fields:o.data.value.mapValue.fields,updateTime:pi(s,o.version.toTimestamp()),createTime:pi(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:yr(e.version)};else{if(!e.isUnknownDocument())return U();r.unknownDocument={path:t.path.toArray(),version:yr(e.version)}}return r}function Sl(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function yr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function vr(n){let e=new Se(n.seconds,n.nanoseconds);return z.fromTimestamp(e)}function lr(n,e){let t=(e.baseMutations||[]).map(s=>Kh(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Kh(n.ct,s)),i=Se.fromMillis(e.localWriteTimeMs);return new Ws(e.batchId,i,t,r)}function ks(n){let e=vr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?vr(n.lastLimboFreeSnapshotVersion):z.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return G(s.documents.length===1),st(bi(Kv(s.documents[0])))}(n.query):function(s){return st(Yv(s))}(n.query),new gi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ne.fromBase64String(n.resumeToken))}function ew(n,e){let t=yr(e.snapshotVersion),r=yr(e.lastLimboFreeSnapshotVersion),i;i=_l(e.target)?$v(n.ct,e.target):Hv(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:gr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ef(n){let e=Yv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?vl(e,e.limit,"L"):e}function oh(n,e){return new Qs(e.largestBatchId,Kh(n.ct,e.overlayMutation))}function by(n,e){let t=e.path.lastSegment();return[n,it(e.path.popLast()),t]}function Ry(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:yr(r.readTime),documentKey:it(r.documentKey.path),largestBatchId:r.largestBatchId}}var Wh=class{getBundleMetadata(e,t){return Py(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:vr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return Py(e).put(function(i){return{bundleId:i.id,createTime:yr(xe(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return xy(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Ef(s.bundledQuery),readTime:vr(s.readTime)}}(r)})}saveNamedQuery(e,t){return xy(e).put(function(i){return{name:i.name,readTime:yr(xe(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Py(n){return qe(n,"bundles")}function xy(n){return qe(n,"namedQueries")}var Al=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Rs(e).get(by(this.userId,t)).next(r=>r?oh(this.serializer,r):null)}getOverlays(e,t){let r=qt();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let l=new Qs(t,o);i.push(this.ht(e,l))}),b.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(it(o.getCollectionPath())));let s=[];return i.forEach(o=>{let l=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Rs(e).j("collectionPathOverlayIndex",l))}),b.waitFor(s)}getOverlaysForCollection(e,t,r){let i=qt(),s=it(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Rs(e).U("collectionPathOverlayIndex",o).next(l=>{for(let u of l){let c=oh(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=qt(),o,l=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Rs(e).J({index:"collectionGroupOverlayIndex",range:l},(u,c,d)=>{let m=oh(this.serializer,c);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):d.done()}).next(()=>s)}ht(e,t){return Rs(e).put(function(i,s,o){let[l,u,c]=by(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Js(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Rs(n){return qe(n,"documentOverlays")}var Qh=class{Pt(e){return qe(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let r=t?.value;return r?Ne.fromUint8Array(r):Ne.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var sn=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ee(e.integerValue));else if("doubleValue"in e){let r=Ee(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),qs(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=an(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Vn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?gv(e)?this.dt(t,Number.MAX_SAFE_INTEGER):su(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):U()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",l=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(Ee(l)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),L.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};sn.vt=new sn;function MS(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Ny(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=MS(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var $h=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),r=Ny(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),r=Ny(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Hh=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Yh=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},ur=class{constructor(){this.jt=new $h,this.Ht=new Hh(this.jt),this.Jt=new Yh(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var cr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Cn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Dy(n.arrayValue,e.arrayValue),t!==0?t:(t=Dy(n.directionalValue,e.directionalValue),t!==0?t:L.comparator(n.documentKey,e.documentKey)))}function Dy(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Cl=class{constructor(e){this.Xt=new pe((t,r)=>Pe.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=_h(e);if(t!==void 0&&!this.sn(t))return!1;let r=or(e),i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){let l=this.Xt.getIterator().getNext();if(!i.has(l.field.canonicalString())){let u=r[s];if(!this.on(l,u)||!this._n(this.en[o++],u))return!1}++s}for(;s<r.length;++s){let l=r[s];if(o>=this.en.length||!this._n(this.en[o++],l))return!1}return!0}an(){if(this.nn)return null;let e=new pe(Pe.comparator),t=[];for(let r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new oi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new oi(r.field,0))}for(let r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new oi(r.field,r.dir==="asc"?0:1)));return new ci(ci.UNKNOWN_ID,this.collectionId,t,Us.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function tw(n){var e,t;if(G(n instanceof re||n instanceof de),n instanceof re){if(n instanceof gl){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>re.create(n.field,"==",s)))||[];return de.create(i,"or")}return n}let r=n.filters.map(i=>tw(i));return de.create(r,n.op)}function OS(n){if(n.getFilters().length===0)return[];let e=Zh(tw(n));return G(nw(e)),Jh(e)||Xh(e)?[e]:e.getFilters()}function Jh(n){return n instanceof re}function Xh(n){return n instanceof de&&gf(n)}function nw(n){return Jh(n)||Xh(n)||function(t){if(t instanceof de&&Ah(t)){for(let r of t.getFilters())if(!Jh(r)&&!Xh(r))return!1;return!0}return!1}(n)}function Zh(n){if(G(n instanceof re||n instanceof de),n instanceof re)return n;if(n.filters.length===1)return Zh(n.filters[0]);let e=n.filters.map(r=>Zh(r)),t=de.create(e,n.op);return t=bl(t),nw(t)?t:(G(t instanceof de),G(di(t)),G(t.filters.length>1),t.filters.reduce((r,i)=>If(r,i)))}function If(n,e){let t;return G(n instanceof re||n instanceof de),G(e instanceof re||e instanceof de),t=n instanceof re?e instanceof re?function(i,s){return de.create([i,s],"and")}(n,e):ky(n,e):e instanceof re?ky(e,n):function(i,s){if(G(i.filters.length>0&&s.filters.length>0),di(i)&&di(s))return Ev(i,s.getFilters());let o=Ah(i)?i:s,l=Ah(i)?s:i,u=o.filters.map(c=>If(c,l));return de.create(u,"or")}(n,e),bl(t)}function ky(n,e){if(di(e))return Ev(e,n.getFilters());{let t=e.filters.map(r=>If(n,r));return de.create(t,"or")}}function bl(n){if(G(n instanceof re||n instanceof de),n instanceof re)return n;let e=n.getFilters();if(e.length===1)return bl(e[0]);if(vv(n))return n;let t=e.map(i=>bl(i)),r=[];return t.forEach(i=>{i instanceof re?r.push(i):i instanceof de&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:de.create(r,n.op)}var ed=class{constructor(){this.un=new Xs}addToCollectionParentIndex(e,t){return this.un.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(St.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(St.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},Xs=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new pe(ae.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new pe(ae.comparator)).toArray()}};var Xa=new Uint8Array(0),td=class{constructor(e,t){this.databaseId=t,this.cn=new Xs,this.ln=new Wt(r=>gr(r),(r,i)=>uo(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:r,parent:it(i)};return Vy(e).put(s)}return b.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[iv(t),""],!1,!0);return Vy(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Ut(o.parent))}return r})}addFieldIndex(e,t){let r=Ps(e),i=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Xr(e);return s.next(l=>{o.put(Ry(l,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Ps(e),i=Xr(e),s=Jr(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ps(e),r=Jr(e),i=Xr(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return b.forEach(this.hn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Cl(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Jr(e),i=!0,s=new Map;return b.forEach(this.hn(t),o=>this.Pn(e,o).next(l=>{i&&(i=!!l),s.set(o,l)})).next(()=>{if(i){let o=Y(),l=[];return b.forEach(s,(u,c)=>{V("IndexedDbIndexManager",`Using index ${function(q){return`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map(J=>`${J.fieldPath}:${J.kind}`).join(",")}`}(u)} to execute ${gr(t)}`);let d=function(q,J){let ie=_h(J);if(ie===void 0)return null;for(let $ of yl(q,ie.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(c,u),m=function(q,J){let ie=new Map;for(let $ of or(J))for(let E of yl(q,$.fieldPath))switch(E.op){case"==":case"in":ie.set($.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return ie.set($.fieldPath.canonicalString(),E.value),Array.from(ie.values())}return null}(c,u),p=function(q,J){let ie=[],$=!0;for(let E of or(J)){let _=E.kind===0?fy(q,E.fieldPath,q.startAt):my(q,E.fieldPath,q.startAt);ie.push(_.value),$&&($=_.inclusive)}return new Kt(ie,$)}(c,u),y=function(q,J){let ie=[],$=!0;for(let E of or(J)){let _=E.kind===0?my(q,E.fieldPath,q.endAt):fy(q,E.fieldPath,q.endAt);ie.push(_.value),$&&($=_.inclusive)}return new Kt(ie,$)}(c,u),A=this.In(u,c,p),x=this.In(u,c,y),D=this.Tn(u,c,m),B=this.En(u.indexId,d,A,p.inclusive,x,y.inclusive,D);return b.forEach(B,j=>r.G(j,t.limit).next(q=>{q.forEach(J=>{let ie=L.fromSegments(J.documentKey);o.has(ie)||(o=o.add(ie),l.push(ie))})}))}).next(()=>l)}return b.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=OS(de.create(e.filters,"and")).map(r=>Vh(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,i,s,o,l){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),d=[];for(let m=0;m<u;++m){let p=t?this.dn(t[m/c]):Xa,y=this.An(e,p,r[m%c],i),A=this.Rn(e,p,s[m%c],o),x=l.map(D=>this.An(e,p,D,!0));d.push(...this.createRange(y,A,x))}return d}An(e,t,r,i){let s=new cr(e,L.empty(),t,r);return i?s:s.Zt()}Rn(e,t,r,i){let s=new cr(e,L.empty(),t,r);return i?s.Zt():s}Pn(e,t){let r=new Cl(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let l of s)r.rn(l)&&(!o||l.fields.length>o.fields.length)&&(o=l);return o})}getIndexType(e,t){let r=2,i=this.hn(t);return b.forEach(i,s=>this.Pn(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new pe(Pe.comparator),d=!1;for(let m of u.filters)for(let p of m.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?d=!0:c=c.add(p.field));for(let m of u.orderBy)m.field.isKeyField()||(c=c.add(m.field));return c.size+(d?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}Vn(e,t){let r=new ur;for(let i of or(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Yt(i.kind);sn.vt.It(s,o)}return r.zt()}dn(e){let t=new ur;return sn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let r=new ur;return sn.vt.It(mr(this.databaseId,t),r.Yt(function(s){let o=or(s);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let i=[];i.push(new ur);let s=0;for(let o of or(e)){let l=r[s++];for(let u of i)if(this.fn(t,o.fieldPath)&&zs(l))i=this.gn(i,o,l);else{let c=u.Yt(o.kind);sn.vt.It(l,c)}}return this.pn(i)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let l of i){let u=new ur;u.seed(l.zt()),sn.vt.It(o,u.Yt(t.kind)),s.push(u)}return s}fn(e,t){return!!e.filters.find(r=>r instanceof re&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Ps(e),i=Xr(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return b.forEach(s,l=>i.get([l.indexId,this.uid]).next(u=>{o.push(function(d,m){let p=m?new Us(m.sequenceNumber,new St(vr(m.readTime),new L(Ut(m.documentKey)),m.largestBatchId)):Us.empty(),y=d.fields.map(([A,x])=>new oi(Pe.fromServerFormat(A),x));return new ci(d.indexId,d.collectionGroup,y,p)}(l,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:Q(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Ps(e),s=Xr(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>b.forEach(l,u=>s.put(Ry(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return b.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),b.forEach(l,u=>this.wn(e,i,u).next(c=>{let d=this.Sn(s,u);return c.isEqual(d)?b.resolve():this.bn(e,s,u,c,d)}))))})}Dn(e,t,r,i){return Jr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,i){return Jr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){let i=Jr(e),s=new pe(Cn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,l)=>{s=s.add(new cr(r.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>s)}Sn(e,t){let r=new pe(Cn),i=this.Vn(t,e);if(i==null)return r;let s=_h(t);if(s!=null){let o=e.data.field(s.fieldPath);if(zs(o))for(let l of o.arrayValue.values||[])r=r.add(new cr(t.indexId,e.key,this.dn(l),i))}else r=r.add(new cr(t.indexId,e.key,Xa,i));return r}bn(e,t,r,i,s){V("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,d,m,p){let y=u.getIterator(),A=c.getIterator(),x=Yr(y),D=Yr(A);for(;x||D;){let B=!1,j=!1;if(x&&D){let q=d(x,D);q<0?j=!0:q>0&&(B=!0)}else x!=null?j=!0:B=!0;B?(m(D),D=Yr(A)):j?(p(x),x=Yr(y)):(x=Yr(y),D=Yr(A))}}(i,s,Cn,l=>{o.push(this.Dn(e,t,r,l))},l=>{o.push(this.vn(e,t,r,l))}),b.waitFor(o)}yn(e){let t=1;return Xr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,l)=>Cn(o,l)).filter((o,l,u)=>!l||Cn(o,u[l-1])!==0);let i=[];i.push(e);for(let o of r){let l=Cn(o,e),u=Cn(o,t);if(l===0)i[0]=e.Zt();else if(l>0&&u<0)i.push(o),i.push(o.Zt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let l=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Xa,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Xa,[]];s.push(IDBKeyRange.bound(l,u))}return s}Cn(e,t){return Cn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(My)}getMinOffset(e,t){return b.mapArray(this.hn(t),r=>this.Pn(e,r).next(i=>i||U())).next(My)}};function Vy(n){return qe(n,"collectionParents")}function Jr(n){return qe(n,"indexEntries")}function Ps(n){return qe(n,"indexConfiguration")}function Xr(n){return qe(n,"indexState")}function My(n){G(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;df(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new St(e.readTime,e.documentKey,t)}var Oy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},It=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function rw(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),l=0,u=r.J({range:o},(d,m,p)=>(l++,p.delete()));s.push(u.next(()=>{G(l===1)}));let c=[];for(let d of t.mutations){let m=cv(e,d.key.path,t.batchId);s.push(i.delete(m)),c.push(d.key)}return b.waitFor(s).next(()=>c)}function Rl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw U();e=n.noDocument}return JSON.stringify(e).length}It.DEFAULT_COLLECTION_PERCENTILE=10,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,It.DEFAULT=new It(41943040,It.DEFAULT_COLLECTION_PERCENTILE,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),It.DISABLED=new It(-1,0,0);var Pl=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,t,r,i){G(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bn(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=ii(e),o=bn(e);return o.add({}).next(l=>{G(typeof l=="number");let u=new Ws(l,t,r,i),c=function(y,A,x){let D=x.baseMutations.map(j=>Js(y.ct,j)),B=x.mutations.map(j=>Js(y.ct,j));return{userId:A,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:D,mutations:B}}(this.serializer,this.userId,u),d=[],m=new pe((p,y)=>Q(p.canonicalString(),y.canonicalString()));for(let p of i){let y=cv(this.userId,p.key.path,l);m=m.add(p.key.path.popLast()),d.push(o.put(c)),d.push(s.put(y,G0))}return m.forEach(p=>{d.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Fn[l]=u.keys()}),b.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return bn(e).get(t).next(r=>r?(G(r.userId===this.userId),lr(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?b.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return bn(e).J({index:"userMutationsIndex",range:i},(o,l,u)=>{l.userId===this.userId&&(G(l.batchId>=r),s=lr(this.serializer,l)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return bn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bn(e).U("userMutationsIndex",t).next(r=>r.map(i=>lr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=nl(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ii(e).J({range:i},(o,l,u)=>{let[c,d,m]=o,p=Ut(d);if(c===this.userId&&t.path.isEqual(p))return bn(e).get(m).next(y=>{if(!y)throw U();G(y.userId===this.userId),s.push(lr(this.serializer,y))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new pe(Q),i=[];return t.forEach(s=>{let o=nl(this.userId,s.path),l=IDBKeyRange.lowerBound(o),u=ii(e).J({range:l},(c,d,m)=>{let[p,y,A]=c,x=Ut(y);p===this.userId&&s.path.isEqual(x)?r=r.add(A):m.done()});i.push(u)}),b.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=nl(this.userId,r),o=IDBKeyRange.lowerBound(s),l=new pe(Q);return ii(e).J({range:o},(u,c,d)=>{let[m,p,y]=u,A=Ut(p);m===this.userId&&r.isPrefixOf(A)?A.length===i&&(l=l.add(y)):d.done()}).next(()=>this.xn(e,l))}xn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(bn(e).get(s).next(o=>{if(o===null)throw U();G(o.userId===this.userId),r.push(lr(this.serializer,o))}))}),b.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return rw(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),b.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return ii(e).J({range:r},(s,o,l)=>{if(s[0]===this.userId){let u=Ut(s[1]);i.push(u)}else l.done()}).next(()=>{G(i.length===0)})})}containsKey(e,t){return iw(e,this.userId,t)}Nn(e){return sw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function iw(n,e,t){let r=nl(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return ii(n).J({range:s,H:!0},(l,u,c)=>{let[d,m,p]=l;d===e&&m===i&&(o=!0),c.done()}).next(()=>o)}function bn(n){return qe(n,"mutations")}function ii(n){return qe(n,"documentMutations")}function sw(n){return qe(n,"mutationQueues")}var _i=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var nd=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let r=new _i(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>z.fromTimestamp(new Se(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Zr(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(G(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Zr(e).J((o,l)=>{let u=ks(l);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Zr(e).J((r,i)=>{let s=ks(i);t(s)})}qn(e){return Fy(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return Fy(e).put("targetGlobalKey",t)}Kn(e,t){return Zr(e).put(ew(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=gr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Zr(e).J({range:i,index:"queryTargetsIndex"},(o,l,u)=>{let c=ks(l);uo(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Rn(e);return t.forEach(o=>{let l=it(o.path);i.push(s.put({targetId:r,path:l})),i.push(this.referenceDelegate.addReference(e,r,o))}),b.waitFor(i)}removeMatchingKeys(e,t,r){let i=Rn(e);return b.forEach(t,s=>{let o=it(s.path);return b.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Rn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Rn(e),s=Y();return i.J({range:r,H:!0},(o,l,u)=>{let c=Ut(o[1]),d=new L(c);s=s.add(d)}).next(()=>s)}containsKey(e,t){let r=it(t.path),i=IDBKeyRange.bound([r],[iv(r)],!1,!0),s=0;return Rn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,l],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return Zr(e).get(t).next(r=>r?ks(r):null)}};function Zr(n){return qe(n,"targets")}function Fy(n){return qe(n,"targetGlobal")}function Rn(n){return qe(n,"targetDocuments")}function Ly([n,e],[t,r]){let i=Q(n,t);return i===0?Q(e,r):i}var rd=class{constructor(e){this.Un=e,this.buffer=new pe(Ly),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Ly(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},id=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){V("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>N(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){jn(t)?V("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Gn(t)}yield this.Hn(3e5)}))}},sd=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return b.resolve(mt.oe);let r=new rd(t);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Oy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Oy):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,i,s,o,l,u,c,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,l=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(c=Date.now(),ei()<=Et.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(l-o)+`ms
	Removed ${s} targets in `+(u-l)+`ms
	Removed ${m} documents in `+(c-u)+`ms
Total Duration: ${c-d}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function FS(n,e){return new sd(n,e)}var od=class{constructor(e,t){this.db=e,this.garbageCollector=FS(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,i)=>t(i))}addReference(e,t,r){return Za(e,r)}removeReference(e,t,r){return Za(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Za(e,t)}nr(e,t){return function(i,s){let o=!1;return sw(i).Y(l=>iw(i,l,s).next(u=>(u&&(o=!0),b.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,l)=>{if(l<=t){let u=this.nr(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,z.min()),Rn(e).delete(function(m){return[0,it(m.path)]}(o))))});i.push(u)}}).next(()=>b.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Za(e,t)}tr(e,t){let r=Rn(e),i,s=mt.oe;return r.J({index:"documentTargetsIndex"},([o,l],{path:u,sequenceNumber:c})=>{o===0?(s!==mt.oe&&t(new L(Ut(i)),s),s=c,i=u):s=mt.oe}).next(()=>{s!==mt.oe&&t(new L(Ut(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Za(n,e){return Rn(n).put(function(r,i){return{targetId:0,path:it(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var xl=class{constructor(){this.changes=new Wt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Fe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var ad=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return sr(e).put(r)}removeEntry(e,t,r){return sr(e).delete(function(s,o){let l=s.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Sl(o),l[l.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Fe.newInvalidDocument(t);return sr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xs(t))},(i,s)=>{r=this.ir(t,s)}).next(()=>r)}sr(e,t){let r={size:0,document:Fe.newInvalidDocument(t)};return sr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xs(t))},(i,s)=>{r={document:this.ir(t,s),size:Rl(s)}}).next(()=>r)}getEntries(e,t){let r=ht();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(e,t){let r=ht(),i=new we(L.comparator);return this._r(e,t,(s,o)=>{let l=this.ir(s,o);r=r.insert(s,l),i=i.insert(s,Rl(o))}).next(()=>({documents:r,ur:i}))}_r(e,t,r){if(t.isEmpty())return b.resolve();let i=new pe(By);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(xs(i.first()),xs(i.last())),o=i.getIterator(),l=o.getNext();return sr(e).J({index:"documentKeyIndex",range:s},(u,c,d)=>{let m=L.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;l&&By(l,m)<0;)r(l,null),l=o.getNext();l&&l.isEqual(m)&&(r(l,c),l=o.hasNext()?o.getNext():null),l?d.$(xs(l)):d.done()}).next(()=>{for(;l;)r(l,null),l=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,l=[o.popLast().toArray(),o.lastSegment(),Sl(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return sr(e).U(IDBKeyRange.bound(l,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let d=ht();for(let m of c){let p=this.ir(L.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);p.isFoundDocument()&&(ho(t,p)||i.has(p.key))&&(d=d.insert(p.key,p))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=ht(),o=qy(t,r),l=qy(t,St.max());return sr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,l,!0)},(u,c,d)=>{let m=this.ir(L.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(m.key,m),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new ld(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Uy(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return Uy(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let r=VS(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(z.min())))return r}return Fe.newInvalidDocument(e)}};function ow(n){return new ad(n)}var ld=class extends xl{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Wt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new pe((s,o)=>Q(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let l=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,l.readTime)),o.isValidDocument()){let u=Cy(this.cr.serializer,o);i=i.add(s.path.popLast());let c=Rl(u);r+=c-l.size,t.push(this.cr.addEntry(e,s,u))}else if(r-=l.size,this.trackRemovals){let u=Cy(this.cr.serializer,o.convertToNoDocument(z.min()));t.push(this.cr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,r)),b.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Uy(n){return qe(n,"remoteDocumentGlobal")}function sr(n){return qe(n,"remoteDocumentsV14")}function xs(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function qy(n,e){let t=e.documentKey.path.toArray();return[n,Sl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function By(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=Q(t[s],r[s]),i)return i;return i=Q(t.length,r.length),i||(i=Q(t[t.length-2],r[r.length-2]),i||Q(t[t.length-1],r[r.length-1]))}var ud=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Nl=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Os(r.mutation,i,pt.empty(),Se.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Y()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Y()){let i=qt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ds();return s.forEach((l,u)=>{o=o.insert(l,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=qt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Y()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,l)=>{t.set(o,l)})})}computeViews(e,t,r,i){let s=ht(),o=Ms(),l=function(){return Ms()}();return t.forEach((u,c)=>{let d=r.get(c.key);i.has(c.key)&&(d===void 0||d.mutation instanceof Nt)?s=s.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Os(d.mutation,c,d.mutation.getFieldMask(),Se.now())):o.set(c.key,pt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var m;return l.set(c,new ud(d,(m=o.get(c))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,t){let r=Ms(),i=new we((o,l)=>o-l),s=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let l of o)l.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let d=r.get(u)||pt.empty();d=l.applyToLocalView(c,d),r.set(u,d);let m=(i.get(l.batchId)||Y()).add(u);i=i.insert(l.batchId,m)})}).next(()=>{let o=[],l=i.getReverseIterator();for(;l.hasNext();){let u=l.getNext(),c=u.key,d=u.value,m=xv();d.forEach(p=>{if(!s.has(p)){let y=Fv(t.get(p),r.get(p));y!==null&&m.set(p,y),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,m))}return b.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return L.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):_f(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):b.resolve(qt()),l=-1,u=s;return o.next(c=>b.forEach(c,(d,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),s.get(d)?b.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{u=u.insert(d,p)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,Y())).next(d=>({batchId:l,changes:Pv(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=Ds();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Ds();return this.indexManager.getCollectionParents(e,s).next(l=>b.forEach(l,u=>{let c=function(m,p){return new xt(p,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(d=>{d.forEach((m,p)=>{o=o.insert(m,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let d=c.getKey();o.get(d)===null&&(o=o.insert(d,Fe.newInvalidDocument(d)))});let l=Ds();return o.forEach((u,c)=>{let d=s.get(u);d!==void 0&&Os(d.mutation,c,pt.empty(),Se.now()),ho(t,c)&&(l=l.insert(u,c))}),l})}};var cd=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return b.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:xe(i.createTime)}}(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:Ef(i.bundledQuery),readTime:xe(i.readTime)}}(t)),b.resolve()}};var hd=class{constructor(){this.overlays=new we(L.comparator),this.Ir=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let r=qt();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){let i=qt(),s=t.length+1,o=new L(t.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){let u=l.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new we((c,d)=>c-d),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=s.get(c.largestBatchId);d===null&&(d=qt(),s=s.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}let l=qt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,d)=>l.set(c,d)),!(l.size()>=i)););return b.resolve(l)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Qs(t,r));let s=this.Ir.get(t);s===void 0&&(s=Y(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var dd=class{constructor(){this.sessionToken=Ne.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}};var Zs=class{constructor(){this.Tr=new pe(Ve.Er),this.dr=new pe(Ve.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new Ve(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Ve(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new L(new ae([])),r=new Ve(t,e),i=new Ve(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new L(new ae([])),r=new Ve(t,e),i=new Ve(t,e+1),s=Y();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Ve(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ve=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return L.comparator(e.key,t.key)||Q(e.wr,t.wr)}static Ar(e,t){return Q(e.wr,t.wr)||L.comparator(e.key,t.key)}};var fd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new pe(Ve.Er)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Ws(s,t,r,i);this.mutationQueue.push(o);for(let l of i)this.br=this.br.add(new Ve(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ve(t,0),i=new Ve(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let l=this.Dr(o.wr);s.push(l)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new pe(Q);return t.forEach(i=>{let s=new Ve(i,0),o=new Ve(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],l=>{r=r.add(l.wr)})}),b.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;L.isDocumentKey(s)||(s=s.child(""));let o=new Ve(new L(s),0),l=new pe(Q);return this.br.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(l=l.add(u.wr)),!0)},o),b.resolve(this.Cr(l))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return b.forEach(t.mutations,i=>{let s=new Ve(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new Ve(t,0),i=this.br.firstAfterOrEqual(r);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var md=class{constructor(e){this.Mr=e,this.docs=function(){return new we(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():Fe.newInvalidDocument(t))}getEntries(e,t){let r=ht();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Fe.newInvalidDocument(i))}),b.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=ht(),o=t.path,l=new L(o.child("")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){let{key:c,value:{document:d}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||df(ov(d),r)<=0||(i.has(d.key)||ho(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,r,i){U()}Or(e,t){return b.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new pd(this)}getSize(e){return b.resolve(this.size)}},pd=class extends xl{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),b.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var gd=class{constructor(e){this.persistence=e,this.Nr=new Wt(t=>gr(t),uo),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Zs,this.targetCount=0,this.kr=_i.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),b.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new _i(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Kn(t),b.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),b.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),b.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this.Br.containsKey(t))}};var Dl=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new mt(0),this.Kr=!1,this.Kr=!0,this.$r=new dd,this.referenceDelegate=e(this),this.Ur=new gd(this),this.indexManager=new ed,this.remoteDocumentCache=function(i){return new md(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Tl(t),this.Gr=new cd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new hd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new fd(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("MemoryPersistence","Starting transaction:",e);let i=new _d(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return b.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},_d=class extends hl{constructor(e){super(),this.currentSequenceNumber=e}},kl=class n{constructor(e){this.persistence=e,this.Jr=new Zs,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw U()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),b.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Xr,r=>{let i=L.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,z.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return b.or([()=>b.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var yd=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new dl("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ry,{unique:!0}),u.createObjectStore("documentMutations")}(e),Gy(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=b.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Gy(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(d=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ry,{unique:!0});let m=c.store("mutations"),p=d.map(y=>m.put(y));return b.waitFor(p)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:eS});c.createIndex("collectionPathOverlayIndex",tS,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",nS,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:j0});c.createIndex("documentKeyIndex",z0),c.createIndex("collectionGroupIndex",K0)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:Y0}).createIndex("sequenceNumberIndex",J0,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:X0}).createIndex("documentKeyIndex",Z0,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=Rl(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>b.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(l=>b.forEach(l,u=>{G(u.userId===s.userId);let c=lr(this.serializer,u);return rw(e,s.userId,c).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,l)=>{let u=new ae(o),c=function(m){return[0,it(m)]}(u);s.push(t.get(c).next(d=>d?b.resolve():(m=>t.put({targetId:0,path:it(m),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>b.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:H0});let r=t.store("collectionParents"),i=new Xs,s=o=>{if(i.add(o)){let l=o.lastSegment(),u=o.popLast();return r.put({collectionId:l,parent:it(u)})}};return t.store("remoteDocuments").J({H:!0},(o,l)=>{let u=new ae(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,l,u],c)=>{let d=Ut(l);return s(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((r,i)=>{let s=ks(i),o=ew(this.serializer,s);return t.put(o)})}_i(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let l=t.store("remoteDocumentsV14"),u=function(m){return m.document?new L(ae.fromString(m.document.name).popFirst(5)):m.noDocument?L.fromSegments(m.noDocument.path):m.unknownDocument?L.fromSegments(m.unknownDocument.path):U()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(l.put(c))}).next(()=>b.waitFor(i))}ai(e,t){let r=t.store("mutations"),i=ow(this.serializer),s=new Dl(kl.Zr,this.serializer.ct);return r.U().next(o=>{let l=new Map;return o.forEach(u=>{var c;let d=(c=l.get(u.userId))!==null&&c!==void 0?c:Y();lr(this.serializer,u).keys().forEach(m=>d=d.add(m)),l.set(u.userId,d)}),b.forEach(l,(u,c)=>{let d=new Me(c),m=Al.lt(this.serializer,d),p=s.getIndexManager(d),y=Pl.lt(d,this.serializer,p,s.referenceDelegate);return new Nl(i,y,m,p).recalculateAndSaveOverlaysForDocumentKeys(new Bs(t,mt.oe),u).next()})})}};function Gy(n){n.createObjectStore("targetDocuments",{keyPath:Q0}).createIndex("documentTargetsIndex",$0,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",W0,{unique:!0}),n.createObjectStore("targetGlobal")}var ah="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",vd=class n{constructor(e,t,r,i,s,o,l,u,c,d,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=s,this.window=o,this.document=l,this.ci=c,this.li=d,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=p=>Promise.resolve(),!n.D())throw new k(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new od(this,i),this.Ai=t+"main",this.serializer=new Tl(u),this.Ri=new kn(this.Ai,this.hi,new yd(this.serializer)),this.$r=new Qh,this.Ur=new nd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ow(this.serializer),this.Gr=new Wh,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Re("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(R.FAILED_PRECONDITION,ah);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new mt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>N(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>N(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>N(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>el(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(jn(e))return V("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return V("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ns(e).get("owner").next(t=>b.resolve(this.vi(t)))}Ci(e){return el(e).delete(this.clientId)}Fi(){return N(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=qe(t,"clientMetadata");return r.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(l=>s.indexOf(l)===-1);return b.forEach(o,l=>r.delete(l.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?b.resolve(!0):Ns(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new k(R.FAILED_PRECONDITION,ah);return!1}}return!(!this.networkEnabled||!this.inForeground)||el(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,l=this.networkEnabled===i.networkEnabled;if(s||o&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&V("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return N(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Bs(e,mt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>el(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Pl.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new td(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Al.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){V("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===17?sS:u===16?iS:u===15?mf:u===14?fv:u===13?dv:u===12?rS:u===11?hv:void U()}(this.hi),o;return this.Ri.runTransaction(e,i,s,l=>(o=new Bs(l,this.Qr?this.Qr.next():mt.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw Re(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new k(R.FAILED_PRECONDITION,av);return r(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>r(o)))).then(l=>(o.raiseOnCommittedEvent(),l))}Ki(e){return Ns(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new k(R.FAILED_PRECONDITION,ah)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ns(e).put("owner",t)}static D(){return kn.D()}bi(e){let t=Ns(e);return t.get("owner").next(r=>this.vi(r)?(V("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}Mi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Re(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;Hc()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return V("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Re("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Re("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ns(n){return qe(n,"owner")}function el(n){return qe(n,"clientMetadata")}function Tf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var wd=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=Y(),i=Y();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Ed=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Vl=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Hc()?8:lv(Ts())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Ed;return this.Xi(e,t,o).next(l=>{if(s.result=l,this.zi)return this.es(e,t,o,l.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(ei()<=Et.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",ti(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),b.resolve()):(ei()<=Et.DEBUG&&V("QueryEngine","Query:",ti(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(ei()<=Et.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",ti(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,st(t))):b.resolve())}Yi(e,t){if(py(t))return b.resolve(null);let r=st(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=vl(t,null,"F"),r=st(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Y(...s);return this.Ji.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.ts(t,l);return this.ns(t,c,o,u.readTime)?this.Yi(e,vl(t,null,"F")):this.rs(e,c,t,u)}))})))}Zi(e,t,r,i){return py(t)||i.isEqual(z.min())?b.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?b.resolve(null):(ei()<=Et.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ti(t)),this.rs(e,o,t,sv(i,-1)).next(l=>l))})}ts(e,t){let r=new pe(bv(e));return t.forEach((i,s)=>{ho(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return ei()<=Et.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",ti(t)),this.Ji.getDocumentsMatchingQuery(e,t,St.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Id=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new we(Q),this._s=new Wt(s=>gr(s),uo),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Nl(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function aw(n,e,t,r){return new Id(n,e,t,r)}function lw(n,e){return N(this,null,function*(){let t=F(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],l=[],u=Y();for(let c of i){o.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}for(let c of s){l.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(r,u).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:l}))})})})}function LS(n,e){let t=F(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(l,u,c,d){let m=c.batch,p=m.keys(),y=b.resolve();return p.forEach(A=>{y=y.next(()=>d.getEntry(u,A)).next(x=>{let D=c.docVersions.get(A);G(D!==null),x.version.compareTo(D)<0&&(m.applyToRemoteDocument(x,c),x.isValidDocument()&&(x.setReadTime(c.commitVersion),d.addEntry(x)))})}),y.next(()=>l.mutationQueue.removeMutationBatch(u,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let u=Y();for(let c=0;c<l.mutationResults.length;++c)l.mutationResults[c].transformResults.length>0&&(u=u.add(l.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function uw(n){let e=F(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function US(n,e){let t=F(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let l=[];e.targetChanges.forEach((d,m)=>{let p=i.get(m);if(!p)return;l.push(t.Ur.removeMatchingKeys(s,d.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(s,d.addedDocuments,m)));let y=p.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?y=y.withResumeToken(Ne.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),i=i.insert(m,y),function(x,D,B){return x.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0}(p,y,d)&&l.push(t.Ur.updateTargetData(s,y))});let u=ht(),c=Y();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),l.push(cw(s,o,e.documentUpdates).next(d=>{u=d.Ps,c=d.Is})),!r.isEqual(z.min())){let d=t.Ur.getLastRemoteSnapshotVersion(s).next(m=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));l.push(d)}return b.waitFor(l).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.os=i,s))}function cw(n,e,t){let r=Y(),i=Y();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=ht();return t.forEach((l,u)=>{let c=s.get(l);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(l)),u.isNoDocument()&&u.version.isEqual(z.min())?(e.removeEntry(l,u.readTime),o=o.insert(l,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(l,u)):V("LocalStore","Ignoring outdated watch update for ",l,". Current version:",c.version," Watch version:",u.version)}),{Ps:o,Is:i}})}function qS(n,e){let t=F(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function yi(n,e){let t=F(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,b.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new gi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function vi(n,e,t){return N(this,null,function*(){let r=F(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!jn(o))throw o;V("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function Ml(n,e,t){let r=F(n),i=z.min(),s=Y();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,d){let m=F(u),p=m._s.get(d);return p!==void 0?b.resolve(m.os.get(p)):m.Ur.getTargetData(c,d)}(r,o,st(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,l.targetId).next(u=>{s=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:z.min(),t?s:Y())).next(l=>(fw(r,Cv(e),l),{documents:l,Ts:s})))}function hw(n,e){let t=F(n),r=F(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function dw(n,e){let t=F(n),r=t.us.get(e)||z.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,sv(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(fw(t,e,i),i))}function fw(n,e,t){let r=n.us.get(e)||z.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}function BS(n,e,t,r){return N(this,null,function*(){let i=F(n),s=Y(),o=ht();for(let c of t){let d=e.Es(c.metadata.name);c.document&&(s=s.add(d));let m=e.ds(c);m.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,m)}let l=i.cs.newChangeBuffer({trackRemovals:!0}),u=yield yi(i,function(d){return st(bi(ae.fromString(`__bundle__/docs/${d}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>cw(c,l,o).next(d=>(l.apply(c),d)).next(d=>i.Ur.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Ur.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))})}function GS(r,i){return N(this,arguments,function*(n,e,t=Y()){let s=yield yi(n,st(Ef(e.bundledQuery))),o=F(n);return o.persistence.runTransaction("Save named query","readwrite",l=>{let u=xe(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Gr.saveNamedQuery(l,e);let c=s.withResumeToken(Ne.EMPTY_BYTE_STRING,u);return o.os=o.os.insert(c.targetId,c),o.Ur.updateTargetData(l,c).next(()=>o.Ur.removeMatchingKeysForTargetId(l,s.targetId)).next(()=>o.Ur.addMatchingKeys(l,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(l,e))})})}function jy(n,e){return`firestore_clients_${n}_${e}`}function zy(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function lh(n,e){return`firestore_targets_${n}_${e}`}var Ol=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Rs(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new k(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(Re("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Fs=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new k(r.error.code,r.error.message))),s?new n(e,r.state,i):(Re("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Fl=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=yf();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=uv(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Re("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Td=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Re("SharedClientState",`Failed to parse online state: ${e}`),null)}},eo=class{constructor(){this.activeTargetIds=yf()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ls=class{constructor(e,t,r,i,s){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new we(Q),this.started=!1,this.bs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=jy(this.persistenceKey,this.ps),this.vs=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new eo),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Os=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return N(this,null,function*(){let e=yield this.syncEngine.Qi();for(let r of e){if(r===this.ps)continue;let i=this.getItem(jy(this.persistenceKey,r));if(i){let s=Fl.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let r=this.Ls(t);r&&this.Bs(r)}for(let r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(lh(this.persistenceKey,e));if(r){let i=Fs.Rs(e,r);i&&(t=i.state)}}return this.Ks.fs(e),this.Ns(),t}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(lh(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return V("SharedClientState","READ",e,t),t}setItem(e,t){V("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){V("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(V("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Re("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>N(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let r=this.Gs(t.key);return this.zs(r,null)}{let r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){let r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){let r=function(s){let o=mt.oe;if(s!=null)try{let l=JSON.parse(s);G(typeof l=="number"),o=l}catch(l){Re("SharedClientState","Failed to read sequence number from WebStorage",l)}return o}(t.newValue);r!==mt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){let r=this.Xs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){let i=new Ol(this.currentUser,e,t,r),s=zy(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=zy(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){let i=lh(this.persistenceKey,e),s=new Fs(e,t,r);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let r=this.Gs(e);return Fl.Rs(r,t)}Hs(e,t){let r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Ol.Rs(new Me(s),i,t)}Ys(e,t){let r=this.Ms.exec(e),i=Number(r[1]);return Fs.Rs(i,t)}Ls(e){return Td.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return N(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);V("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),o=[],l=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||l.push(u)}),this.syncEngine.io(o,l).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=yf();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Ll=class{constructor(){this.so=new eo,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new eo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Sd=class{_o(e){}shutdown(){}};var Ul=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){V("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){V("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var tl=null;function uh(){return tl===null?tl=function(){return 268435456+Math.round(2147483648*Math.random())}():tl++,"0x"+tl.toString(16)}var jS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Ad=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Xe="WebChannelConnection",Cd=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let l=uh(),u=this.xo(t,r.toUriEncodedString());V("RestConnection",`Sending RPC '${t}' ${l}:`,u,i);let c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,s,o),this.No(t,u,c,i).then(d=>(V("RestConnection",`Received RPC '${t}' ${l}: `,d),d),d=>{throw Tt("RestConnection",`RPC '${t}' ${l} failed with error: `,d,"url: ",u,"request:",i),d})}Lo(t,r,i,s,o,l){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ci}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=jS[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=uh();return new Promise((o,l)=>{let u=new eh;u.setWithCredentials(!0),u.listenOnce(nh.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case bs.NO_ERROR:let d=u.getResponseJson();V(Xe,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case bs.TIMEOUT:V(Xe,`RPC '${e}' ${s} timed out`),l(new k(R.DEADLINE_EXCEEDED,"Request time out"));break;case bs.HTTP_ERROR:let m=u.getStatus();if(V(Xe,`RPC '${e}' ${s} failed with status:`,m,"response text:",u.getResponseText()),m>0){let p=u.getResponseJson();Array.isArray(p)&&(p=p[0]);let y=p?.error;if(y&&y.status&&y.message){let A=function(D){let B=D.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(B)>=0?B:R.UNKNOWN}(y.status);l(new k(A,y.message))}else l(new k(R.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new k(R.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{V(Xe,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);V(Xe,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Bo(e,t,r){let i=uh(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=sh(),l=ih(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new th({})),this.Oo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let d=s.join("");V(Xe,`Creating RPC '${e}' stream ${i}: ${d}`,u);let m=o.createWebChannel(d,u),p=!1,y=!1,A=new Ad({Io:D=>{y?V(Xe,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(p||(V(Xe,`Opening RPC '${e}' stream ${i} transport.`),m.open(),p=!0),V(Xe,`RPC '${e}' stream ${i} sending:`,D),m.send(D))},To:()=>m.close()}),x=(D,B,j)=>{D.listen(B,q=>{try{j(q)}catch(J){setTimeout(()=>{throw J},0)}})};return x(m,Hr.EventType.OPEN,()=>{y||(V(Xe,`RPC '${e}' stream ${i} transport opened.`),A.yo())}),x(m,Hr.EventType.CLOSE,()=>{y||(y=!0,V(Xe,`RPC '${e}' stream ${i} transport closed`),A.So())}),x(m,Hr.EventType.ERROR,D=>{y||(y=!0,Tt(Xe,`RPC '${e}' stream ${i} transport errored:`,D),A.So(new k(R.UNAVAILABLE,"The operation could not be completed")))}),x(m,Hr.EventType.MESSAGE,D=>{var B;if(!y){let j=D.data[0];G(!!j);let q=j,J=q.error||((B=q[0])===null||B===void 0?void 0:B.error);if(J){V(Xe,`RPC '${e}' stream ${i} received error:`,J);let ie=J.status,$=function(w){let I=ke[w];if(I!==void 0)return qv(I)}(ie),E=J.message;$===void 0&&($=R.INTERNAL,E="Unknown error status: "+ie+" with message "+J.message),y=!0,A.So(new k($,E)),m.close()}else V(Xe,`RPC '${e}' stream ${i} received:`,j),A.bo(j)}}),x(l,rh.STAT_EVENT,D=>{D.stat===Ja.PROXY?V(Xe,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===Ja.NOPROXY&&V(Xe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{A.wo()},0),A}};function mw(){return typeof window<"u"?window:null}function ol(){return typeof document<"u"?document:null}function fo(n){return new Bh(n,!0)}var to=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&V("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var ql=class{constructor(e,t,r,i,s,o,l,u){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new to(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return N(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return N(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return N(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(Re(t.toString()),Re("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new k(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>N(this,null,function*(){this.state=0,this.start()}))}I_(e){return V("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(V("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},bd=class extends ql{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=bS(this.serializer,e),r=function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?xe(o.readTime):z.min()}(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=zh(this.serializer),t.addTarget=function(s,o){let l,u=o.target;if(l=_l(u)?{documents:$v(s,u)}:{query:Hv(s,u)._t},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=Gv(s,o.resumeToken);let c=Gh(s,o.expectedCount);c!==null&&(l.expectedCount=c)}else if(o.snapshotVersion.compareTo(z.min())>0){l.readTime=pi(s,o.snapshotVersion.toTimestamp());let c=Gh(s,o.expectedCount);c!==null&&(l.expectedCount=c)}return l}(this.serializer,e);let r=PS(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=zh(this.serializer),t.removeTarget=e,this.a_(t)}},Rd=class extends ql{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=RS(e.writeResults,e.commitTime),r=xe(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=zh(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Js(this.serializer,r))};this.a_(t)}};var Pd=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new k(R.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,jh(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new k(R.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Lo(e,jh(t,r),i,o,l,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(R.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},xd=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Re(t),this.D_=!1):V("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Nd=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>N(this,null,function*(){zn(this)&&(V("RemoteStore","Restarting streams for network reachability change."),yield function(u){return N(this,null,function*(){let c=F(u);c.L_.add(4),yield Ri(c),c.q_.set("Unknown"),c.L_.delete(4),yield mo(c)})}(this))}))}),this.q_=new xd(r,i)}};function mo(n){return N(this,null,function*(){if(zn(n))for(let e of n.B_)yield e(!0)})}function Ri(n){return N(this,null,function*(){for(let e of n.B_)yield e(!1)})}function ou(n,e){let t=F(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Cf(t)?Af(t):xi(t).r_()&&Sf(t,e))}function wi(n,e){let t=F(n),r=xi(t);t.N_.delete(e),r.r_()&&pw(t,e),t.N_.size===0&&(r.r_()?r.o_():zn(t)&&t.q_.set("Unknown"))}function Sf(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xi(n).A_(e)}function pw(n,e){n.Q_.xe(e),xi(n).R_(e)}function Af(n){n.Q_=new qh({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),xi(n).start(),n.q_.v_()}function Cf(n){return zn(n)&&!xi(n).n_()&&n.N_.size>0}function zn(n){return F(n).L_.size===0}function gw(n){n.Q_=void 0}function zS(n){return N(this,null,function*(){n.q_.set("Online")})}function KS(n){return N(this,null,function*(){n.N_.forEach((e,t)=>{Sf(n,e)})})}function WS(n,e){return N(this,null,function*(){gw(n),Cf(n)?(n.q_.M_(e),Af(n)):n.q_.set("Unknown")})}function QS(n,e,t){return N(this,null,function*(){if(n.q_.set("Online"),e instanceof El&&e.state===2&&e.cause)try{yield function(i,s){return N(this,null,function*(){let o=s.cause;for(let l of s.targetIds)i.N_.has(l)&&(yield i.remoteSyncer.rejectListen(l,o),i.N_.delete(l),i.Q_.removeTarget(l))})}(n,e)}catch(r){V("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Bl(n,r)}else if(e instanceof li?n.Q_.Ke(e):e instanceof wl?n.Q_.He(e):n.Q_.We(e),!t.isEqual(z.min()))try{let r=yield uw(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let l=s.Q_.rt(o);return l.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let d=s.N_.get(c);d&&s.N_.set(c,d.withResumeToken(u.resumeToken,o))}}),l.targetMismatches.forEach((u,c)=>{let d=s.N_.get(u);if(!d)return;s.N_.set(u,d.withResumeToken(Ne.EMPTY_BYTE_STRING,d.snapshotVersion)),pw(s,u);let m=new gi(d.target,u,c,d.sequenceNumber);Sf(s,m)}),s.remoteSyncer.applyRemoteEvent(l)}(n,t))}catch(r){V("RemoteStore","Failed to raise snapshot:",r),yield Bl(n,r)}})}function Bl(n,e,t){return N(this,null,function*(){if(!jn(e))throw e;n.L_.add(1),yield Ri(n),n.q_.set("Offline"),t||(t=()=>uw(n.localStore)),n.asyncQueue.enqueueRetryable(()=>N(this,null,function*(){V("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield mo(n)}))})}function _w(n,e){return e().catch(t=>Bl(n,t,e))}function Pi(n){return N(this,null,function*(){let e=F(n),t=Bn(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;$S(e);)try{let i=yield qS(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,HS(e,i)}catch(i){yield Bl(e,i)}yw(e)&&vw(e)})}function $S(n){return zn(n)&&n.O_.length<10}function HS(n,e){n.O_.push(e);let t=Bn(n);t.r_()&&t.V_&&t.m_(e.mutations)}function yw(n){return zn(n)&&!Bn(n).n_()&&n.O_.length>0}function vw(n){Bn(n).start()}function YS(n){return N(this,null,function*(){Bn(n).p_()})}function JS(n){return N(this,null,function*(){let e=Bn(n);for(let t of n.O_)e.m_(t.mutations)})}function XS(n,e,t){return N(this,null,function*(){let r=n.O_.shift(),i=Fh.from(r,e,t);yield _w(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Pi(n)})}function ZS(n,e){return N(this,null,function*(){e&&Bn(n).V_&&(yield function(r,i){return N(this,null,function*(){if(function(o){return Uv(o)&&o!==R.ABORTED}(i.code)){let s=r.O_.shift();Bn(r).s_(),yield _w(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Pi(r)}})}(n,e)),yw(n)&&vw(n)})}function Ky(n,e){return N(this,null,function*(){let t=F(n);t.asyncQueue.verifyOperationInProgress(),V("RemoteStore","RemoteStore received new credentials");let r=zn(t);t.L_.add(3),yield Ri(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield mo(t)})}function Dd(n,e){return N(this,null,function*(){let t=F(n);e?(t.L_.delete(2),yield mo(t)):e||(t.L_.add(2),yield Ri(t),t.q_.set("Unknown"))})}function xi(n){return n.K_||(n.K_=function(t,r,i){let s=F(t);return s.w_(),new bd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:zS.bind(null,n),Ro:KS.bind(null,n),mo:WS.bind(null,n),d_:QS.bind(null,n)}),n.B_.push(e=>N(this,null,function*(){e?(n.K_.s_(),Cf(n)?Af(n):n.q_.set("Unknown")):(yield n.K_.stop(),gw(n))}))),n.K_}function Bn(n){return n.U_||(n.U_=function(t,r,i){let s=F(t);return s.w_(),new Rd(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:YS.bind(null,n),mo:ZS.bind(null,n),f_:JS.bind(null,n),g_:XS.bind(null,n)}),n.B_.push(e=>N(this,null,function*(){e?(n.U_.s_(),yield Pi(n)):(yield n.U_.stop(),n.O_.length>0&&(V("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var kd=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Oe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,l=new n(e,t,o,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ni(n,e){if(Re("AsyncQueue",`${e}: ${n}`),jn(n))return new k(R.UNAVAILABLE,`${e}: ${n}`);throw n}var Gl=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=Ds(),this.sortedSet=new we(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var jl=class{constructor(){this.W_=new we(L.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):U():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},Ei=class n{constructor(e,t,r,i,s,o,l,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(l=>{o.push({type:0,doc:l})}),new n(e,t,Gl.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&co(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Vd=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Md=class{constructor(){this.queries=Wy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=F(t),s=i.queries;i.queries=Wy(),s.forEach((o,l)=>{for(let u of l.j_)u.onError(r)})})(this,new k(R.ABORTED,"Firestore shutting down"))}};function Wy(){return new Wt(n=>Av(n),co)}function bf(n,e){return N(this,null,function*(){let t=F(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new Vd,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let l=Ni(o,`Initialization of query '${ti(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Pf(t)})}function Rf(n,e){return N(this,null,function*(){let t=F(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function eA(n,e){let t=F(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let l of o.j_)l.X_(i)&&(r=!0);o.z_=i}}r&&Pf(t)}function tA(n,e,t){let r=F(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function Pf(n){n.Y_.forEach(e=>{e.next()})}var Od,Qy;(Qy=Od||(Od={})).ea="default",Qy.Cache="cache";var no=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ei(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Ei.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Od.Cache}};var Fd=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var zl=class{constructor(e){this.serializer=e}Es(e){return Gt(this.serializer,e)}ds(e){return e.metadata.exists?Qv(this.serializer,e.document,!1):Fe.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return xe(e)}},Ld=class{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=ww(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let r=ae.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,r=new zl(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Es(i.metadata.name);for(let o of i.metadata.queries){let l=(t.get(o)||Y()).add(s);t.set(o,l)}}return t}complete(){return N(this,null,function*(){let e=yield BS(this.localStore,new zl(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let r of this.queries)yield GS(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function ww(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Kl=class{constructor(e){this.key=e}},Wl=class{constructor(e){this.key=e}},Ql=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Y(),this.mutatedKeys=Y(),this.Aa=bv(e),this.Ra=new Gl(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new jl,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,l=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,m)=>{let p=i.get(d),y=ho(this.query,m)?m:null,A=!!p&&this.mutatedKeys.has(p.key),x=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),D=!1;p&&y?p.data.isEqual(y.data)?A!==x&&(r.track({type:3,doc:y}),D=!0):this.ga(p,y)||(r.track({type:2,doc:y}),D=!0,(u&&this.Aa(y,u)>0||c&&this.Aa(y,c)<0)&&(l=!0)):!p&&y?(r.track({type:0,doc:y}),D=!0):p&&!y&&(r.track({type:1,doc:p}),D=!0,(u||c)&&(l=!0)),D&&(y?(o=o.add(y),s=x?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:l,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,m)=>function(y,A){let x=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return x(y)-x(A)}(d.type,m.type)||this.Aa(d.doc,m.doc)),this.pa(r),i=i!=null&&i;let l=t&&!i?this.ya():[],u=this.da.size===0&&this.current&&!i?1:0,c=u!==this.Ea;return this.Ea=u,o.length!==0||c?{snapshot:new Ei(this.query,e.Ra,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new jl,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=Y(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Wl(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Kl(r))}),t}ba(e){this.Ta=e.Ts,this.da=Y();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ei.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Ud=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},qd=class{constructor(e){this.key=e,this.va=!1}},Bd=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Wt(l=>Av(l),co),this.Ma=new Map,this.xa=new Set,this.Oa=new we(L.comparator),this.Na=new Map,this.La=new Zs,this.Ba={},this.ka=new Map,this.qa=_i.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function nA(n,e,t=!0){return N(this,null,function*(){let r=au(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Ew(r,e,t,!0),i})}function rA(n,e){return N(this,null,function*(){let t=au(n);yield Ew(t,e,!0,!1)})}function Ew(n,e,t,r){return N(this,null,function*(){let i=yield yi(n.localStore,st(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",l;return r&&(l=yield xf(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&ou(n.remoteStore,i),l})}function xf(n,e,t,r,i){return N(this,null,function*(){n.Ka=(m,p,y)=>function(x,D,B,j){return N(this,null,function*(){let q=D.view.ma(B);q.ns&&(q=yield Ml(x.localStore,D.query,!1).then(({documents:E})=>D.view.ma(E,q)));let J=j&&j.targetChanges.get(D.targetId),ie=j&&j.targetMismatches.get(D.targetId)!=null,$=D.view.applyChanges(q,x.isPrimaryClient,J,ie);return Gd(x,D.targetId,$.wa),$.snapshot})}(n,m,p,y);let s=yield Ml(n.localStore,e,!0),o=new Ql(e,s.Ts),l=o.ma(s.documents),u=Hs.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(l,n.isPrimaryClient,u);Gd(n,t,c.wa);let d=new Ud(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot})}function iA(n,e,t){return N(this,null,function*(){let r=F(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!co(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield vi(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&wi(r.remoteStore,i.targetId),Ii(r,i.targetId)}).catch(Gn))):(Ii(r,i.targetId),yield vi(r.localStore,i.targetId,!0))})}function sA(n,e){return N(this,null,function*(){let t=F(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),wi(t.remoteStore,r.targetId))})}function oA(n,e,t){return N(this,null,function*(){let r=Vf(n);try{let i=yield function(o,l){let u=F(o),c=Se.now(),d=l.reduce((y,A)=>y.add(A.key),Y()),m,p;return u.persistence.runTransaction("Locally write mutations","readwrite",y=>{let A=ht(),x=Y();return u.cs.getEntries(y,d).next(D=>{A=D,A.forEach((B,j)=>{j.isValidDocument()||(x=x.add(B))})}).next(()=>u.localDocuments.getOverlayedDocuments(y,A)).next(D=>{m=D;let B=[];for(let j of l){let q=wS(j,m.get(j.key).overlayedDocument);q!=null&&B.push(new Nt(j.key,q,yv(q.value.mapValue),be.exists(!0)))}return u.mutationQueue.addMutationBatch(y,c,B,l)}).next(D=>{p=D;let B=D.applyToLocalDocumentSet(m,x);return u.documentOverlayCache.saveOverlays(y,D.batchId,B)})}).then(()=>({batchId:p.batchId,changes:Pv(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,l,u){let c=o.Ba[o.currentUser.toKey()];c||(c=new we(Q)),c=c.insert(l,u),o.Ba[o.currentUser.toKey()]=c}(r,i.batchId,t),yield dn(r,i.changes),yield Pi(r.remoteStore)}catch(i){let s=Ni(i,"Failed to persist write");t.reject(s)}})}function Iw(n,e){return N(this,null,function*(){let t=F(n);try{let r=yield US(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(G(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?G(o.va):i.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield dn(t,r,e)}catch(r){yield Gn(r)}})}function $y(n,e,t){let r=F(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let l=o.view.Z_(e);l.snapshot&&i.push(l.snapshot)}),function(o,l){let u=F(o);u.onlineState=l;let c=!1;u.queries.forEach((d,m)=>{for(let p of m.j_)p.Z_(l)&&(c=!0)}),c&&Pf(u)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function aA(n,e,t){return N(this,null,function*(){let r=F(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new we(L.comparator);o=o.insert(s,Fe.newNoDocument(s,z.min()));let l=Y().add(s),u=new $s(z.min(),new Map,new we(Q),o,l);yield Iw(r,u),r.Oa=r.Oa.remove(s),r.Na.delete(e),kf(r)}else yield vi(r.localStore,e,!1).then(()=>Ii(r,e,t)).catch(Gn)})}function lA(n,e){return N(this,null,function*(){let t=F(n),r=e.batch.batchId;try{let i=yield LS(t.localStore,e);Df(t,r,null),Nf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield dn(t,i)}catch(i){yield Gn(i)}})}function uA(n,e,t){return N(this,null,function*(){let r=F(n);try{let i=yield function(o,l){let u=F(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return u.mutationQueue.lookupMutationBatch(c,l).next(m=>(G(m!==null),d=m.keys(),u.mutationQueue.removeMutationBatch(c,m))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,d,l)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>u.localDocuments.getDocuments(c,d))})}(r.localStore,e);Df(r,e,t),Nf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield dn(r,i)}catch(i){yield Gn(i)}})}function cA(n,e){return N(this,null,function*(){let t=F(n);zn(t.remoteStore)||V("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let l=F(o);return l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>l.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.ka.get(r)||[];i.push(e),t.ka.set(r,i)}catch(r){let i=Ni(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Nf(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Df(n,e,t){let r=F(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function Ii(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Tw(n,r)})}function Tw(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(wi(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),kf(n))}function Gd(n,e,t){for(let r of t)r instanceof Kl?(n.La.addReference(r.key,e),hA(n,r)):r instanceof Wl?(V("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Tw(n,r.key)):U()}function hA(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(V("SyncEngine","New document in limbo: "+t),n.xa.add(r),kf(n))}function kf(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new L(ae.fromString(e)),r=n.qa.next();n.Na.set(r,new qd(t)),n.Oa=n.Oa.insert(t,r),ou(n.remoteStore,new gi(st(bi(t.path)),r,"TargetPurposeLimboResolution",mt.oe))}}function dn(n,e,t){return N(this,null,function*(){let r=F(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((l,u)=>{o.push(r.Ka(u,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){let m=c?!c.fromCache:(d=t?.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(c){i.push(c);let m=wd.Wi(u.targetId,c);s.push(m)}}))}),yield Promise.all(o),r.Ca.d_(i),yield function(u,c){return N(this,null,function*(){let d=F(u);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>b.forEach(c,p=>b.forEach(p.$i,y=>d.persistence.referenceDelegate.addReference(m,p.targetId,y)).next(()=>b.forEach(p.Ui,y=>d.persistence.referenceDelegate.removeReference(m,p.targetId,y)))))}catch(m){if(!jn(m))throw m;V("LocalStore","Failed to update sequence numbers: "+m)}for(let m of c){let p=m.targetId;if(!m.fromCache){let y=d.os.get(p),A=y.snapshotVersion,x=y.withLastLimboFreeSnapshotVersion(A);d.os=d.os.insert(p,x)}}})}(r.localStore,s))})}function dA(n,e){return N(this,null,function*(){let t=F(n);if(!t.currentUser.isEqual(e)){V("SyncEngine","User change. New user:",e.toKey());let r=yield lw(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(l=>{l.forEach(u=>{u.reject(new k(R.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield dn(t,r.hs)}})}function fA(n,e){let t=F(n),r=t.Na.get(e);if(r&&r.va)return Y().add(r.key);{let i=Y(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let l=t.Fa.get(o);i=i.unionWith(l.view.Va)}return i}}function mA(n,e){return N(this,null,function*(){let t=F(n),r=yield Ml(t.localStore,e.query,!0),i=e.view.ba(r);return t.isPrimaryClient&&Gd(t,e.targetId,i.wa),i})}function pA(n,e){return N(this,null,function*(){let t=F(n);return dw(t.localStore,e).then(r=>dn(t,r))})}function gA(n,e,t,r){return N(this,null,function*(){let i=F(n),s=yield function(l,u){let c=F(l),d=F(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",m=>d.Mn(m,u).next(p=>p?c.localDocuments.getDocuments(m,p):b.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Pi(i.remoteStore):t==="acknowledged"||t==="rejected"?(Df(i,e,r||null),Nf(i,e),function(l,u){F(F(l).mutationQueue).On(u)}(i.localStore,e)):U(),yield dn(i,s)):V("SyncEngine","Cannot apply mutation batch with id: "+e)})}function _A(n,e){return N(this,null,function*(){let t=F(n);if(au(t),Vf(t),e===!0&&t.Qa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Hy(t,r.toArray());t.Qa=!0,yield Dd(t.remoteStore,!0);for(let s of i)ou(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let r=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Ii(t,o),vi(t.localStore,o,!0))),wi(t.remoteStore,o)}),yield i,yield Hy(t,r),function(o){let l=F(o);l.Na.forEach((u,c)=>{wi(l.remoteStore,c)}),l.La.pr(),l.Na=new Map,l.Oa=new we(L.comparator)}(t),t.Qa=!1,yield Dd(t.remoteStore,!1)}})}function Hy(n,e,t){return N(this,null,function*(){let r=F(n),i=[],s=[];for(let o of e){let l,u=r.Ma.get(o);if(u&&u.length!==0){l=yield yi(r.localStore,st(u[0]));for(let c of u){let d=r.Fa.get(c),m=yield mA(r,d);m.snapshot&&s.push(m.snapshot)}}else{let c=yield hw(r.localStore,o);l=yield yi(r.localStore,c),yield xf(r,Sw(c),o,!1,l.resumeToken)}i.push(l)}return r.Ca.d_(s),i})}function Sw(n){return Sv(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function yA(n){return function(t){return F(F(t).persistence).Qi()}(F(n).localStore)}function vA(n,e,t,r){return N(this,null,function*(){let i=F(n);if(i.Qa)return void V("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield dw(i.localStore,Cv(s[0])),l=$s.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ne.EMPTY_BYTE_STRING);yield dn(i,o,l);break}case"rejected":yield vi(i.localStore,e,!0),Ii(i,e,r);break;default:U()}})}function wA(n,e,t){return N(this,null,function*(){let r=au(n);if(r.Qa){for(let i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){V("SyncEngine","Adding an already active target "+i);continue}let s=yield hw(r.localStore,i),o=yield yi(r.localStore,s);yield xf(r,Sw(s),o.targetId,!1,o.resumeToken),ou(r.remoteStore,o)}for(let i of t)r.Ma.has(i)&&(yield vi(r.localStore,i,!1).then(()=>{wi(r.remoteStore,i),Ii(r,i)}).catch(Gn))}})}function au(n){let e=F(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Iw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=aA.bind(null,e),e.Ca.d_=eA.bind(null,e.eventManager),e.Ca.$a=tA.bind(null,e.eventManager),e}function Vf(n){let e=F(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=lA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=uA.bind(null,e),e}function EA(n,e,t){let r=F(n);(function(s,o,l){return N(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(y,A){let x=F(y),D=xe(A.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",B=>x.Gr.getBundleMetadata(B,A.id)).then(B=>!!B&&B.createTime.compareTo(D)>=0)}(s.localStore,u))return yield o.close(),l._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(u)),Promise.resolve(new Set);l._updateProgress(ww(u));let c=new Ld(u,s.localStore,o.serializer),d=yield o.Ua();for(;d;){let p=yield c.la(d);p&&l._updateProgress(p),d=yield o.Ua()}let m=yield c.complete();return yield dn(s,m.Ia,void 0),yield function(y,A){let x=F(y);return x.persistence.runTransaction("Save bundle","readwrite",D=>x.Gr.saveBundleMetadata(D,A))}(s.localStore,u),l._completeWith(m.progress),Promise.resolve(m.Pa)}catch(u){return Tt("SyncEngine",`Loading bundle failed with ${u}`),l._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var ro=class{constructor(){this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){this.serializer=fo(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return aw(this.persistence,new Vl,e.initialUser,this.serializer)}createPersistence(e){return new Dl(kl.Zr,this.serializer)}createSharedClientState(e){return new Ll}terminate(){return N(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var $l=class n extends ro{constructor(e,t,r){super(),this.Wa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){yield qc(n.prototype,this,"initialize").call(this,e),yield this.Wa.initialize(this,e),yield Vf(this.Wa.syncEngine),yield Pi(this.Wa.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return aw(this.persistence,new Vl,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new id(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Eh(t,this.persistence);return new wh(e.asyncQueue,r)}createPersistence(e){let t=Tf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?It.withCacheSize(this.cacheSizeBytes):It.DEFAULT;return new vd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,mw(),ol(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Ll}},jd=class n extends $l{constructor(e,t){super(e,t,!1),this.Wa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return N(this,null,function*(){yield qc(n.prototype,this,"initialize").call(this,e);let t=this.Wa.syncEngine;this.sharedClientState instanceof Ls&&(this.sharedClientState.syncEngine={no:gA.bind(null,t),ro:vA.bind(null,t),io:wA.bind(null,t),Qi:yA.bind(null,t),eo:pA.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(r=>N(this,null,function*(){yield _A(this.Wa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=mw();if(!Ls.D(t))throw new k(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Tf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ls(t,e.asyncQueue,r,e.clientId,e.initialUser)}},io=class{initialize(e,t){return N(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$y(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=dA.bind(null,this.syncEngine),yield Dd(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Md}()}createDatastore(e){let t=fo(e.databaseInfo.databaseId),r=function(s){return new Cd(s)}(e.databaseInfo);return function(s,o,l,u){return new Pd(s,o,l,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,l){return new Nd(r,i,s,o,l)}(this.localStore,this.datastore,e.asyncQueue,t=>$y(this.syncEngine,t,0),function(){return Ul.D()?new Ul:new Sd}())}createSyncEngine(e,t){return function(i,s,o,l,u,c,d){let m=new Bd(i,s,o,l,u,c);return d&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return N(this,null,function*(){var e,t;yield function(i){return N(this,null,function*(){let s=F(i);V("RemoteStore","RemoteStore shutting down."),s.L_.add(5),yield Ri(s),s.k_.shutdown(),s.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()})}};function Yy(n,e=10240){let t=0;return{read(){return N(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return N(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Ti=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Re("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var zd=class{constructor(e,t){this.ja=e,this.serializer=t,this.metadata=new Oe,this.buffer=new Uint8Array,this.Ha=function(){return new TextDecoder("utf-8")}(),this.Ja().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.aa)}`))},r=>this.metadata.reject(r))}close(){return this.ja.cancel()}getMetadata(){return N(this,null,function*(){return this.metadata.promise})}Ua(){return N(this,null,function*(){return yield this.getMetadata(),this.Ja()})}Ja(){return N(this,null,function*(){let e=yield this.Ya();if(e===null)return null;let t=this.Ha.decode(e),r=Number(t);isNaN(r)&&this.Za(`length string (${t}) is not valid number`);let i=yield this.Xa(r);return new Fd(JSON.parse(i),e.length+r)})}eu(){return this.buffer.findIndex(e=>e===123)}Ya(){return N(this,null,function*(){for(;this.eu()<0&&!(yield this.tu()););if(this.buffer.length===0)return null;let e=this.eu();e<0&&this.Za("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Xa(e){return N(this,null,function*(){for(;this.buffer.length<e;)(yield this.tu())&&this.Za("Reached the end of bundle when more is expected.");let t=this.Ha.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Za(e){throw this.ja.cancel(),new Error(`Invalid bundle format: ${e}`)}tu(){return N(this,null,function*(){let e=yield this.ja.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Kd=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new k(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return N(this,null,function*(){let o=F(i),l={documents:s.map(m=>Ys(o.serializer,m))},u=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,ae.emptyPath(),l,s.length),c=new Map;u.forEach(m=>{let p=CS(o.serializer,m);c.set(p.key.toString(),p)});let d=[];return s.forEach(m=>{let p=c.get(m.toString());G(!!p),d.push(p)}),d})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new qn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=L.fromPath(r);this.mutations.push(new Ks(i,this.precondition(i)))}),yield function(r,i){return N(this,null,function*(){let s=F(r),o={writes:i.map(l=>Js(s.serializer,l))};yield s.Mo("Commit",s.serializer.databaseId,ae.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=z.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new k(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(z.min())?be.exists(!1):be.updateTime(t):be.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(z.min()))throw new k(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return be.updateTime(t)}return be.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Wd=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.nu=r.maxAttempts,this.t_=new to(this.asyncQueue,"transaction_retry")}ru(){this.nu-=1,this.iu()}iu(){this.t_.Go(()=>N(this,null,function*(){let e=new Kd(this.datastore),t=this.su(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ou(i)}))}).catch(r=>{this.ou(r)})}))}su(e){try{let t=this.updateFunction(e);return!lo(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ou(e){this.nu>0&&this._u(e)?(this.nu-=1,this.asyncQueue.enqueueAndForget(()=>(this.iu(),Promise.resolve()))):this.deferred.reject(e)}_u(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Uv(t)}return!1}};var Qd=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Me.UNAUTHENTICATED,this.clientId=ul.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>N(this,null,function*(){V("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(V("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new k(R.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Oe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Ni(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function al(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),V("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>N(this,null,function*(){r.isEqual(i)||(yield lw(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function $d(n,e){return N(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Mf(n);V("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Ky(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Ky(e.remoteStore,i)),n._onlineComponents=e})}function Aw(n){return n.name==="FirebaseError"?n.code===R.FAILED_PRECONDITION||n.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Mf(n){return N(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){V("FirestoreClient","Using user provided OfflineComponentProvider");try{yield al(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!Aw(t))throw t;Tt("Error using user provided cache. Falling back to memory cache: "+t),yield al(n,new ro)}}else V("FirestoreClient","Using default OfflineComponentProvider"),yield al(n,new ro);return n._offlineComponents})}function lu(n){return N(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(V("FirestoreClient","Using user provided OnlineComponentProvider"),yield $d(n,n._uninitializedComponentsProvider._online)):(V("FirestoreClient","Using default OnlineComponentProvider"),yield $d(n,new io))),n._onlineComponents})}function Cw(n){return Mf(n).then(e=>e.persistence)}function Of(n){return Mf(n).then(e=>e.localStore)}function bw(n){return lu(n).then(e=>e.remoteStore)}function Ff(n){return lu(n).then(e=>e.syncEngine)}function IA(n){return lu(n).then(e=>e.datastore)}function Si(n){return N(this,null,function*(){let e=yield lu(n),t=e.eventManager;return t.onListen=nA.bind(null,e.syncEngine),t.onUnlisten=iA.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=rA.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=sA.bind(null,e.syncEngine),t})}function TA(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield Cw(n),t=yield bw(n);return e.setNetworkEnabled(!0),function(i){let s=F(i);return s.L_.delete(0),mo(s)}(t)}))}function SA(n){return n.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield Cw(n),t=yield bw(n);return e.setNetworkEnabled(!1),function(i){return N(this,null,function*(){let s=F(i);s.L_.add(0),yield Ri(s),s.q_.set("Offline")})}(t)}))}function AA(n,e){let t=new Oe;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(i,s,o){return N(this,null,function*(){try{let l=yield function(c,d){let m=F(c);return m.persistence.runTransaction("read document","readonly",p=>m.localDocuments.getDocument(p,d))}(i,s);l.isFoundDocument()?o.resolve(l):l.isNoDocument()?o.resolve(null):o.reject(new k(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){let u=Ni(l,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield Of(n),e,t)})),t.promise}function Rw(n,e,t={}){let r=new Oe;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,l,u,c){let d=new Ti({next:p=>{o.enqueueAndForget(()=>Rf(s,m));let y=p.docs.has(l);!y&&p.fromCache?c.reject(new k(R.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&u&&u.source==="server"?c.reject(new k(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(p)},error:p=>c.reject(p)}),m=new no(bi(l.path),d,{includeMetadataChanges:!0,_a:!0});return bf(s,m)}(yield Si(n),n.asyncQueue,e,t,r)})),r.promise}function CA(n,e){let t=new Oe;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(i,s,o){return N(this,null,function*(){try{let l=yield Ml(i,s,!0),u=new Ql(s,l.Ts),c=u.ma(l.documents),d=u.applyChanges(c,!1);o.resolve(d.snapshot)}catch(l){let u=Ni(l,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield Of(n),e,t)})),t.promise}function Pw(n,e,t={}){let r=new Oe;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,o,l,u,c){let d=new Ti({next:p=>{o.enqueueAndForget(()=>Rf(s,m)),p.fromCache&&u.source==="server"?c.reject(new k(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(p)},error:p=>c.reject(p)}),m=new no(l,d,{includeMetadataChanges:!0,_a:!0});return bf(s,m)}(yield Si(n),n.asyncQueue,e,t,r)})),r.promise}function bA(n,e){let t=new Ti(e);return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(i,s){F(i).Y_.add(s),s.next()}(yield Si(n),t)})),()=>{t.za(),n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(i,s){F(i).Y_.delete(s)}(yield Si(n),t)}))}}function RA(n,e,t,r){let i=function(o,l){let u;return u=typeof o=="string"?Bv().encode(o):o,function(d,m){return new zd(d,m)}(function(d,m){if(d instanceof Uint8Array)return Yy(d,m);if(d instanceof ArrayBuffer)return Yy(new Uint8Array(d),m);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),l)}(t,fo(e));n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){EA(yield Ff(n),i,r)}))}function PA(n,e){return n.asyncQueue.enqueue(()=>N(this,null,function*(){return function(r,i){let s=F(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))}(yield Of(n),e)}))}function xw(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Jy=new Map;function Lf(n,e,t){if(!t)throw new k(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Uf(n,e,t,r){if(e===!0&&r===!0)throw new k(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Xy(n){if(!L.isDocumentKey(n))throw new k(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Zy(n){if(L.isDocumentKey(n))throw new k(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function uu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U()}function le(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new k(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=uu(n);throw new k(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Nw(n,e){if(e<=0)throw new k(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Hl=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new k(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new k(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Uf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new k(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},wr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new k(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new k(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hl(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new ch;switch(r.type){case"firstParty":return new mh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new k(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Jy.get(t);r&&(V("ComponentProvider","Removing Datastore"),Jy.delete(t),r.terminate())}(this),Promise.resolve()}};function Dw(n,e,t,r={}){var i;let s=(n=le(n,wr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Tt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let l,u;if(typeof r.mockUserToken=="string")l=r.mockUserToken,u=Me.MOCK_USER;else{l=ba(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new k(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Me(c)}n._authCredentials=new hh(new ll(l,u))}}var Qe=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},_e=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},jt=class n extends Qe{constructor(e,t,r){super(e,t,bi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new _e(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function qf(n,e,...t){if(n=ne(n),Lf("collection","path",e),n instanceof wr){let r=ae.fromString(e,...t);return Zy(r),new jt(n,null,r)}{if(!(n instanceof _e||n instanceof jt))throw new k(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ae.fromString(e,...t));return Zy(r),new jt(n.firestore,null,r)}}function kw(n,e){if(n=le(n,wr),Lf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Qe(n,null,function(r){return new xt(ae.emptyPath(),r)}(e))}function po(n,e,...t){if(n=ne(n),arguments.length===1&&(e=ul.newId()),Lf("doc","path",e),n instanceof wr){let r=ae.fromString(e,...t);return Xy(r),new _e(n,null,new L(r))}{if(!(n instanceof _e||n instanceof jt))throw new k(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ae.fromString(e,...t));return Xy(r),new _e(n.firestore,n instanceof jt?n.converter:null,new L(r))}}function Bf(n,e){return n=ne(n),e=ne(e),(n instanceof _e||n instanceof jt)&&(e instanceof _e||e instanceof jt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Gf(n,e){return n=ne(n),e=ne(e),n instanceof Qe&&e instanceof Qe&&n.firestore===e.firestore&&co(n._query,e._query)&&n.converter===e.converter}var Hd=class{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new to(this,"async_queue_retry"),this.Eu=()=>{let t=ol();t&&V("AsyncQueue","Visibility state changed to "+t.visibilityState),this.t_.jo()};let e=ol();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;let t=ol();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});let t=new Oe;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}Ru(){return N(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!jn(e))throw e;V("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(e){let t=this.au.then(()=>(this.Pu=!0,e().catch(r=>{this.hu=r,this.Pu=!1;let i=function(o){let l=o.message||"";return o.stack&&(l=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),l}(r);throw Re("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Pu=!1,r))));return this.au=t,t}enqueueAfterDelay(e,t,r){this.du(),this.Tu.indexOf(e)>-1&&(t=0);let i=kd.createAndSchedule(this,e,t,r,s=>this.Vu(s));return this.lu.push(i),i}du(){this.hu&&U()}verifyOperationInProgress(){}mu(){return N(this,null,function*(){let e;do e=this.au,yield e;while(e!==this.au)})}fu(e){for(let t of this.lu)if(t.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.lu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){let t=this.lu.indexOf(e);this.lu.splice(t,1)}};function Yd(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var Jd=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Oe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var Vw=-1,Ie=class extends wr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new Hd}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Mw(this),this._firestoreClient.terminate()}};function Be(n){return n._firestoreClient||Mw(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Mw(n){var e,t,r;let i=n._freezeSettings(),s=function(l,u,c,d){return new Ih(l,u,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,xw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new Qd(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Ow(n,e){Kw(n=le(n,Ie));let t=Be(n);if(t._uninitializedComponentsProvider)throw new k(R.FAILED_PRECONDITION,"SDK cache is already specified.");Tt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new io;return Lw(t,i,new $l(i,r.cacheSizeBytes,e?.forceOwnership))}function Fw(n){Kw(n=le(n,Ie));let e=Be(n);if(e._uninitializedComponentsProvider)throw new k(R.FAILED_PRECONDITION,"SDK cache is already specified.");Tt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new io;return Lw(e,r,new jd(r,t.cacheSizeBytes))}function Lw(n,e,t){let r=new Oe;return n.asyncQueue.enqueue(()=>N(this,null,function*(){try{yield al(n,t),yield $d(n,e),r.resolve()}catch(i){let s=i;if(!Aw(s))throw s;Tt("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function Uw(n){if(n._initialized&&!n._terminated)throw new k(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Oe;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{yield function(r){return N(this,null,function*(){if(!kn.D())return Promise.resolve();let i=r+"main";yield kn.delete(i)})}(Tf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function qw(n){return function(t){let r=new Oe;return t.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return cA(yield Ff(t),r)})),r.promise}(Be(n=le(n,Ie)))}function Bw(n){return TA(Be(n=le(n,Ie)))}function Gw(n){return SA(Be(n=le(n,Ie)))}function jw(n,e){let t=Be(n=le(n,Ie)),r=new Jd;return RA(t,n._databaseId,e,r),r}function zw(n,e){return PA(Be(n=le(n,Ie)),e).then(t=>t?new Qe(n,null,t.query):null)}function Kw(n){if(n._initialized||n._terminated)throw new k(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Qt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ne.fromBase64String(e))}catch(t){throw new k(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Dt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new k(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var cn=class{constructor(e){this._methodName=e}};var Er=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}};var so=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}};var xA=/^__.*__$/,Xd=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Nt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Un(e,this.data,t,this.fieldTransforms)}},Yl=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Nt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Ww(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var Jl=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.yu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.vu(e),i}Cu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Su({path:r,Du:!1});return i.yu(),i}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return Xl(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(Ww(this.wu)&&xA.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}},Zd=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||fo(e)}Nu(e,t,r,i=!1){return new Jl({wu:e,methodName:t,Ou:r,path:Pe.emptyPath(),Du:!1,xu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ar(n){let e=n._freezeSettings(),t=fo(n._databaseId);return new Zd(n._databaseId,!!e.ignoreUndefinedProperties,t)}function cu(n,e,t,r,i,s={}){let o=n.Nu(s.merge||s.mergeFields?2:0,e,t,i);Kf("Data must be an object, but it was:",o,r);let l=Hw(r,o),u,c;if(s.merge)u=new pt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let m of s.mergeFields){let p=sf(e,m,t);if(!o.contains(p))throw new k(R.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);Jw(d,p)||d.push(p)}u=new pt(d),c=o.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,c=o.fieldTransforms;return new Xd(new Ze(l),u,c)}var oo=class n extends cn{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function Qw(n,e,t){return new Jl({wu:3,Ou:e.settings.Ou,methodName:n._methodName,Du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var ef=class n extends cn{_toFieldTransform(e){return new _r(e.path,new Fn)}isEqual(e){return e instanceof n}},tf=class n extends cn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=Qw(this,e,!0),r=this.Lu.map(s=>Cr(s,t)),i=new ln(r);return new _r(e.path,i)}isEqual(e){return e instanceof n&&Yc(this.Lu,e.Lu)}},nf=class n extends cn{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){let t=Qw(this,e,!0),r=this.Lu.map(s=>Cr(s,t)),i=new un(r);return new _r(e.path,i)}isEqual(e){return e instanceof n&&Yc(this.Lu,e.Lu)}},rf=class n extends cn{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){let t=new Ln(e.serializer,Dv(e.serializer,this.Bu));return new _r(e.path,t)}isEqual(e){return e instanceof n&&this.Bu===e.Bu}};function jf(n,e,t,r){let i=n.Nu(1,e,t);Kf("Data must be an object, but it was:",i,r);let s=[],o=Ze.empty();Sr(r,(u,c)=>{let d=Wf(e,u,t);c=ne(c);let m=i.Cu(d);if(c instanceof oo)s.push(d);else{let p=Cr(c,m);p!=null&&(s.push(d),o.set(d,p))}});let l=new pt(s);return new Yl(o,l,i.fieldTransforms)}function zf(n,e,t,r,i,s){let o=n.Nu(1,e,t),l=[sf(e,r,t)],u=[i];if(s.length%2!=0)throw new k(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)l.push(sf(e,s[p])),u.push(s[p+1]);let c=[],d=Ze.empty();for(let p=l.length-1;p>=0;--p)if(!Jw(c,l[p])){let y=l[p],A=u[p];A=ne(A);let x=o.Cu(y);if(A instanceof oo)c.push(y);else{let D=Cr(A,x);D!=null&&(c.push(y),d.set(y,D))}}let m=new pt(c);return new Yl(d,m,o.fieldTransforms)}function $w(n,e,t,r=!1){return Cr(t,n.Nu(r?4:3,e))}function Cr(n,e){if(Yw(n=ne(n)))return Kf("Unsupported field value:",e,n),Hw(n,e);if(n instanceof cn)return function(r,i){if(!Ww(i.wu))throw i.Mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Mu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let l of r){let u=Cr(l,i.Fu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Dv(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Se.fromDate(r);return{timestampValue:pi(i.serializer,s)}}if(r instanceof Se){let s=new Se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:pi(i.serializer,s)}}if(r instanceof Er)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Qt)return{bytesValue:Gv(i.serializer,r._byteString)};if(r instanceof _e){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:wf(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof so)return function(o,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw l.Mu("VectorValues must only contain numeric values.");return vf(l.serializer,u)})}}}}}}(r,i);throw i.Mu(`Unsupported field value: ${uu(r)}`)}(n,e)}function Hw(n,e){let t={};return mv(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Sr(n,(r,i)=>{let s=Cr(i,e.bu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Yw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Se||n instanceof Er||n instanceof Qt||n instanceof _e||n instanceof cn||n instanceof so)}function Kf(n,e,t){if(!Yw(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=uu(t);throw r==="an object"?e.Mu(n+" a custom object"):e.Mu(n+" "+r)}}function sf(n,e,t){if((e=ne(e))instanceof Dt)return e._internalPath;if(typeof e=="string")return Wf(n,e);throw Xl("Field path arguments must be of type string or ",n,!1,void 0,t)}var NA=new RegExp("[~\\*/\\[\\]]");function Wf(n,e,t){if(e.search(NA)>=0)throw Xl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Dt(...e.split("."))._internalPath}catch{throw Xl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Xl(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new k(R.INVALID_ARGUMENT,l+n+u)}function Jw(n,e){return n.some(t=>t.isEqual(e))}var Ir=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new _e(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new of(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(hu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},of=class extends Ir{data(){return super.data()}};function hu(n,e){return typeof e=="string"?Wf(n,e):e instanceof Dt?e._internalPath:e._delegate._internalPath}function Xw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ao=class{},Tr=class extends ao{};function fn(n,e,...t){let r=[];e instanceof ao&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof af).length,l=s.filter(u=>u instanceof Zl).length;if(o>1||o>0&&l>0)throw new k(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Zl=class n extends Tr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return lE(e._query,t),new Qe(e.firestore,e.converter,Mh(e._query,t))}_parse(e){let t=Ar(e.firestore);return function(s,o,l,u,c,d,m){let p;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new k(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){tv(m,d);let y=[];for(let A of m)y.push(ev(u,s,A));p={arrayValue:{values:y}}}else p=ev(u,s,m)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||tv(m,d),p=$w(l,o,m,d==="in"||d==="not-in");return re.create(c,d,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function Zw(n,e,t){let r=e,i=hu("where",n);return Zl._create(i,r,t)}var af=class n extends ao{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:de.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,l=s.getFlattenedFilters();for(let u of l)lE(o,u),o=Mh(o,u)}(e._query,t),new Qe(e.firestore,e.converter,Mh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var lf=class n extends Tr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new k(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new k(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new pr(s,o)}(e._query,this._field,this._direction);return new Qe(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new xt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function eE(n,e="asc"){let t=e,r=hu("orderBy",n);return lf._create(r,t)}var eu=class n extends Tr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Qe(e.firestore,e.converter,vl(e._query,this._limit,this._limitType))}};function tE(n){return Nw("limit",n),eu._create("limit",n,"F")}function nE(n){return Nw("limitToLast",n),eu._create("limitToLast",n,"L")}var tu=class n extends Tr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=aE(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(i,s){return new xt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function rE(...n){return tu._create("startAt",n,!0)}function iE(...n){return tu._create("startAfter",n,!1)}var nu=class n extends Tr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=aE(e,this.type,this._docOrFields,this._inclusive);return new Qe(e.firestore,e.converter,function(i,s){return new xt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function sE(...n){return nu._create("endBefore",n,!1)}function oE(...n){return nu._create("endAt",n,!0)}function aE(n,e,t,r){if(t[0]=ne(t[0]),t[0]instanceof Ir)return function(s,o,l,u,c){if(!u)throw new k(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);let d=[];for(let m of ai(s))if(m.field.isKeyField())d.push(mr(o,u.key));else{let p=u.data.field(m.field);if(iu(p))throw new k(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){let y=m.field.canonicalString();throw new k(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(p)}return new Kt(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Ar(n.firestore);return function(o,l,u,c,d,m){let p=o.explicitOrderBy;if(d.length>p.length)throw new k(R.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let A=0;A<d.length;A++){let x=d[A];if(p[A].field.isKeyField()){if(typeof x!="string")throw new k(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof x}`);if(!_f(o)&&x.indexOf("/")!==-1)throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${x}' contains a slash.`);let D=o.path.child(ae.fromString(x));if(!L.isDocumentKey(D))throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let B=new L(D);y.push(mr(l,B))}else{let D=$w(u,c,x);y.push(D)}}return new Kt(y,m)}(n._query,n.firestore._databaseId,i,e,t,r)}}function ev(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new k(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!_f(e)&&t.indexOf("/")!==-1)throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ae.fromString(t));if(!L.isDocumentKey(r))throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return mr(n,new L(r))}if(t instanceof _e)return mr(n,t._key);throw new k(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uu(t)}.`)}function tv(n,e){if(!Array.isArray(n)||n.length===0)throw new k(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function lE(n,e){let t=function(i,s){for(let o of i)for(let l of o.getFlattenedFilters())if(s.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new k(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ai=class{convertValue(e,t="none"){switch(fr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Sr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Ee(o.doubleValue));return new so(s)}convertGeoPoint(e){return new Er(Ee(e.latitude),Ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=pf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Gs(e));default:return null}}convertTimestamp(e){let t=an(e);return new Se(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ae.fromString(e);G(Zv(r));let i=new Mn(r.get(1),r.get(3)),s=new L(r.popFirst(5));return i.isEqual(t)||Re(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function du(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var uf=class extends Ai{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new _e(this.firestore,null,t)}};var on=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},At=class extends Ir{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Nn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(hu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Nn=class extends At{data(e={}){return super.data(e)}},kt=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new on(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Nn(this._firestore,this._userDataWriter,r.key,r,new on(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(l=>{let u=new Nn(i._firestore,i._userDataWriter,l.doc.key,l.doc,new on(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>s||l.type!==3).map(l=>{let u=new Nn(i._firestore,i._userDataWriter,l.doc.key,l.doc,new on(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,d=-1;return l.type!==0&&(c=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),d=o.indexOf(l.doc.key)),{type:DA(l.type),doc:u,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function DA(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function Qf(n,e){return n instanceof At&&e instanceof At?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof kt&&e instanceof kt&&n._firestore===e._firestore&&Gf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function uE(n){n=le(n,_e);let e=le(n.firestore,Ie);return Rw(Be(e),n._key).then(t=>Jf(e,n,t))}var hn=class extends Ai{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new _e(this.firestore,null,t)}};function cE(n){n=le(n,_e);let e=le(n.firestore,Ie),t=Be(e),r=new hn(e);return AA(t,n._key).then(i=>new At(e,r,n._key,i,new on(i!==null&&i.hasLocalMutations,!0),n.converter))}function hE(n){n=le(n,_e);let e=le(n.firestore,Ie);return Rw(Be(e),n._key,{source:"server"}).then(t=>Jf(e,n,t))}function dE(n){n=le(n,Qe);let e=le(n.firestore,Ie),t=Be(e),r=new hn(e);return Xw(n._query),Pw(t,n._query).then(i=>new kt(e,r,n,i))}function fE(n){n=le(n,Qe);let e=le(n.firestore,Ie),t=Be(e),r=new hn(e);return CA(t,n._query).then(i=>new kt(e,r,n,i))}function mE(n){n=le(n,Qe);let e=le(n.firestore,Ie),t=Be(e),r=new hn(e);return Pw(t,n._query,{source:"server"}).then(i=>new kt(e,r,n,i))}function $f(n,e,t){n=le(n,_e);let r=le(n.firestore,Ie),i=du(n.converter,e,t);return Di(r,[cu(Ar(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,be.none())])}function Hf(n,e,t,...r){n=le(n,_e);let i=le(n.firestore,Ie),s=Ar(i),o;return o=typeof(e=ne(e))=="string"||e instanceof Dt?zf(s,"updateDoc",n._key,e,t,r):jf(s,"updateDoc",n._key,e),Di(i,[o.toMutation(n._key,be.exists(!0))])}function pE(n){return Di(le(n.firestore,Ie),[new qn(n._key,be.none())])}function gE(n,e){let t=le(n.firestore,Ie),r=po(n),i=du(n.converter,e);return Di(t,[cu(Ar(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,be.exists(!1))]).then(()=>r)}function Yf(n,...e){var t,r,i;n=ne(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Yd(e[o])||(s=e[o],o++);let l={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Yd(e[o])){let m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let u,c,d;if(n instanceof _e)c=le(n.firestore,Ie),d=bi(n._key.path),u={next:m=>{e[o]&&e[o](Jf(c,n,m))},error:e[o+1],complete:e[o+2]};else{let m=le(n,Qe);c=le(m.firestore,Ie),d=m._query;let p=new hn(c);u={next:y=>{e[o]&&e[o](new kt(c,p,m,y))},error:e[o+1],complete:e[o+2]},Xw(n._query)}return function(p,y,A,x){let D=new Ti(x),B=new no(y,D,A);return p.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return bf(yield Si(p),B)})),()=>{D.za(),p.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return Rf(yield Si(p),B)}))}}(Be(c),d,l,u)}function _E(n,e){return bA(Be(n=le(n,Ie)),Yd(e)?e:{next:e})}function Di(n,e){return function(r,i){let s=new Oe;return r.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return oA(yield Ff(r),i,s)})),s.promise}(Be(n),e)}function Jf(n,e,t){let r=t.docs.get(e._key),i=new hn(n);return new At(n,i,e._key,r,new on(t.hasPendingWrites,t.fromCache),e.converter)}var kA={maxAttempts:5};var ru=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ar(e)}set(e,t,r){this._verifyNotCommitted();let i=Pn(e,this._firestore),s=du(i.converter,t,r),o=cu(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,be.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Pn(e,this._firestore),o;return o=typeof(t=ne(t))=="string"||t instanceof Dt?zf(this._dataReader,"WriteBatch.update",s._key,t,r,i):jf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,be.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Pn(e,this._firestore);return this._mutations=this._mutations.concat(new qn(t._key,be.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Pn(n,e){if((n=ne(n)).firestore!==e)throw new k(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var cf=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Ar(t)}get(t){let r=Pn(t,this._firestore),i=new uf(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return U();let o=s[0];if(o.isFoundDocument())return new Ir(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Ir(this._firestore,i,r._key,null,r.converter);throw U()})}set(t,r,i){let s=Pn(t,this._firestore),o=du(s.converter,r,i),l=cu(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,l),this}update(t,r,i,...s){let o=Pn(t,this._firestore),l;return l=typeof(r=ne(r))=="string"||r instanceof Dt?zf(this._dataReader,"Transaction.update",o._key,r,i,s):jf(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,l),this}delete(t){let r=Pn(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Pn(e,this._firestore),r=new hn(this._firestore);return super.get(e).then(i=>new At(this._firestore,r,t._key,i._document,new on(!1,!1),t.converter))}};function yE(n,e,t){n=le(n,Ie);let r=Object.assign(Object.assign({},kA),t);return function(s){if(s.maxAttempts<1)throw new k(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,l){let u=new Oe;return s.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){let c=yield IA(s);new Wd(s.asyncQueue,c,l,o,u).ru()})),u.promise}(Be(n),i=>e(new cf(n,i)),r)}function vE(){return new oo("deleteField")}function wE(){return new ef("serverTimestamp")}function EE(...n){return new tf("arrayUnion",n)}function IE(...n){return new nf("arrayRemove",n)}function TE(n){return new rf("increment",n)}(function(e,t=!0){(function(i){Ci=i})(Da),Na(new Lt("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),l=new Ie(new dh(r.getProvider("auth-internal")),new gh(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new k(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Mn(c.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),l._setSettings(s),l},"PUBLIC").setMultipleInstances(!0)),$r(ey,"4.7.0",e),$r(ey,"4.7.0","esm2017")})();var VA="@firebase/firestore-compat",MA="0.3.35";function rm(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new k("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function SE(){if(typeof Uint8Array>"u")throw new k("unimplemented","Uint8Arrays are not available in this environment.")}function AE(){if(!pv())throw new k("unimplemented","Blobs are unavailable in Firestore in this environment.")}var fu=class n{constructor(e){this._delegate=e}static fromBase64String(e){return AE(),new n(Qt.fromBase64String(e))}static fromUint8Array(e){return SE(),new n(Qt.fromUint8Array(e))}toBase64(){return AE(),this._delegate.toBase64()}toUint8Array(){return SE(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Xf(n){return OA(n,["next","error","complete"])}function OA(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Zf=class{enableIndexedDbPersistence(e,t){return Ow(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Fw(e._delegate)}clearIndexedDbPersistence(e){return Uw(e._delegate)}},mu=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Mn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Tt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){Dw(this._delegate,e,t,r)}enableNetwork(){return Bw(this._delegate)}disableNetwork(){return Gw(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Uf("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return qw(this._delegate)}onSnapshotsInSync(e){return _E(this._delegate,e)}get app(){if(!this._appCompat)throw new k("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Mi(this,qf(this._delegate,e))}catch(t){throw ot(t,"collection()","Firestore.collection()")}}doc(e){try{return new $t(this,po(this._delegate,e))}catch(t){throw ot(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new xr(this,kw(this._delegate,e))}catch(t){throw ot(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return yE(this._delegate,t=>e(new pu(this,t)))}batch(){return Be(this._delegate),new gu(new ru(this._delegate,e=>Di(this._delegate,e)))}loadBundle(e){return jw(this._delegate,e)}namedQuery(e){return zw(this._delegate,e).then(t=>t?new xr(this,t):null)}},ki=class extends Ai{constructor(e){super(),this.firestore=e}convertBytes(e){return new fu(new Qt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return $t.forKey(t,this.firestore,null)}};function FA(n){nv(n)}var pu=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ki(e)}get(e){let t=br(e);return this._delegate.get(t).then(r=>new Rr(this._firestore,new At(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=br(e);return r?(rm("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=br(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=br(e);return this._delegate.delete(t),this}},gu=class{constructor(e){this._delegate=e}set(e,t,r){let i=br(e);return r?(rm("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=br(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=br(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Vi=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Nn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Pr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new ki(e),t),i.set(t,s)),s}};Vi.INSTANCES=new WeakMap;var $t=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ki(e)}static forPath(e,t,r){if(e.length%2!==0)throw new k("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new _e(t._delegate,r,new L(e)))}static forKey(e,t,r){return new n(t,new _e(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Mi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Mi(this.firestore,qf(this._delegate,e))}catch(t){throw ot(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ne(e),e instanceof _e?Bf(this._delegate,e):!1}set(e,t){t=rm("DocumentReference.set",t);try{return t?$f(this._delegate,e,t):$f(this._delegate,e)}catch(r){throw ot(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Hf(this._delegate,e):Hf(this._delegate,e,t,...r)}catch(i){throw ot(i,"updateDoc()","DocumentReference.update()")}}delete(){return pE(this._delegate)}onSnapshot(...e){let t=CE(e),r=bE(e,i=>new Rr(this.firestore,new At(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Yf(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=cE(this._delegate):e?.source==="server"?t=hE(this._delegate):t=uE(this._delegate),t.then(r=>new Rr(this.firestore,new At(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Vi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ot(n,e,t){return n.message=n.message.replace(e,t),n}function CE(n){for(let e of n)if(typeof e=="object"&&!Xf(e))return e;return{}}function bE(n,e){var t,r;let i;return Xf(n[0])?i=n[0]:Xf(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Rr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new $t(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Qf(this._delegate,e._delegate)}},Pr=class extends Rr{data(e){let t=this._delegate.data(e);return this._delegate._converter||rv(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},xr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ki(e)}where(e,t,r){try{return new n(this.firestore,fn(this._delegate,Zw(e,t,r)))}catch(i){throw ot(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,fn(this._delegate,eE(e,t)))}catch(r){throw ot(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,fn(this._delegate,tE(e)))}catch(t){throw ot(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,fn(this._delegate,nE(e)))}catch(t){throw ot(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,fn(this._delegate,rE(...e)))}catch(t){throw ot(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,fn(this._delegate,iE(...e)))}catch(t){throw ot(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,fn(this._delegate,sE(...e)))}catch(t){throw ot(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,fn(this._delegate,oE(...e)))}catch(t){throw ot(t,"endAt()","Query.endAt()")}}isEqual(e){return Gf(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=fE(this._delegate):e?.source==="server"?t=mE(this._delegate):t=dE(this._delegate),t.then(r=>new go(this.firestore,new kt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=CE(e),r=bE(e,i=>new go(this.firestore,new kt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Yf(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Vi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},em=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Pr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},go=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new xr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Pr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new em(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Pr(this._firestore,r))})}isEqual(e){return Qf(this._delegate,e._delegate)}},Mi=class n extends xr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new $t(this.firestore,e):null}doc(e){try{return e===void 0?new $t(this.firestore,po(this._delegate)):new $t(this.firestore,po(this._delegate,e))}catch(t){throw ot(t,"doc()","CollectionReference.doc()")}}add(e){return gE(this._delegate,e).then(t=>new $t(this.firestore,t))}isEqual(e){return Bf(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Vi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function br(n){return le(n,_e)}var tm=class n{constructor(...e){this._delegate=new Dt(...e)}static documentId(){return new n(Pe.keyField().canonicalString())}isEqual(e){return e=ne(e),e instanceof Dt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var nm=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=wE();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=vE();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=EE(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=IE(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=TE(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var LA={Firestore:mu,GeoPoint:Er,Timestamp:Se,Blob:fu,Transaction:pu,WriteBatch:gu,DocumentReference:$t,DocumentSnapshot:Rr,Query:xr,QueryDocumentSnapshot:Pr,QuerySnapshot:go,CollectionReference:Mi,FieldPath:tm,FieldValue:nm,setLogLevel:FA,CACHE_SIZE_UNLIMITED:Vw};function UA(n,e){n.INTERNAL.registerComponent(new Lt("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},LA)))}function qA(n){UA(n,(e,t)=>new mu(e,t,new Zf)),n.registerVersion(VA,MA)}qA(Sn);function zA(n,e=ma){return new fa(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function RE(n,e){return zA(n,e)}function KA(n,e){return RE(n,e).pipe(_a(void 0),ga(),Ge(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function am(n,e){return RE(n,e).pipe(Ge(t=>({payload:t,type:"query"})))}var _u=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=kE(r,t);return new vu(i,s,this.afs)}snapshotChanges(){return KA(this.ref,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return this.snapshotChanges().pipe(Ge(({payload:t})=>e.idField?ys(zr({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return vs(this.ref.get(e)).pipe(Ue)}};function yu(n,e){return am(n,e).pipe(_a(void 0),ga(),Ge(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(l=>({type:l.type,payload:l}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((l,u)=>{let c=s.find(m=>m.doc.ref.isEqual(l.ref)),d=r?.payload.docs.find(m=>m.ref.isEqual(l.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(l.metadata)||!c&&d&&JSON.stringify(d.metadata)===JSON.stringify(l.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:l}})}),o}))}function PE(n,e,t){return yu(n,t).pipe(ir((r,i)=>WA(r,i.map(s=>s.payload),e),[]),pa(),Ge(r=>r.map(i=>({type:i.type,payload:i}))))}function WA(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=QA(n,r))}),n}function im(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function QA(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return im(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return im(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return im(n,e.oldIndex,1);break}return n}function xE(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var vu=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=yu(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ge(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(_a(void 0),ga(),Gc(([r,i])=>i.length>0||!r),Ge(([,r])=>r),Ue)}auditTrail(e){return this.stateChanges(e).pipe(ir((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=xE(e);return PE(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return am(this.query,this.afs.schedulers.outsideAngular).pipe(Ge(t=>t.payload.docs.map(r=>e.idField?ys(zr({},r.data()),{[e.idField]:r.id}):r.data())),Ue)}get(e){return vs(this.query.get(e)).pipe(Ue)}add(e){return this.ref.add(e)}doc(e){return new _u(this.ref.doc(e),this.afs)}},sm=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?yu(this.query,this.afs.schedulers.outsideAngular).pipe(Ue):yu(this.query,this.afs.schedulers.outsideAngular).pipe(Ge(t=>t.filter(r=>e.indexOf(r.type)>-1)),Gc(t=>t.length>0),Ue)}auditTrail(e){return this.stateChanges(e).pipe(ir((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=xE(e);return PE(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ue)}valueChanges(e={}){return am(this.query,this.afs.schedulers.outsideAngular).pipe(Ge(r=>r.payload.docs.map(i=>e.idField?zr({[e.idField]:i.id},i.data()):i.data())),Ue)}get(e){return vs(this.query.get(e)).pipe(Ue)}},NE=new wn("angularfire2.enableFirestorePersistence"),DE=new wn("angularfire2.firestore.persistenceSettings"),$A=new wn("angularfire2.firestore.settings"),HA=new wn("angularfire2.firestore.use-emulator");function kE(n,e=t=>t){return{query:e(n),ref:n}}var YA=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,l,u,c,d,m,p,y,A,x,D,B,j){this.schedulers=u;let q=La(t,l,r),J=d;m&&Qa(q,l,p,A,x,D,y,B),[this.firestore,this.persistenceEnabled$]=qa(`${q.name}.firestore`,"AngularFirestore",q.name,()=>{let ie=l.runOutsideAngular(()=>q.firestore());if(s&&ie.settings(s),J&&ie.useEmulator(...J),i&&!p_(o)){let $=()=>{try{return vs(ie.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(E){return typeof console<"u"&&console.warn(E),ws(!1)}};return[ie,l.runOutsideAngular($)]}else return[ie,ws(!1)]},[s,J,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=kE(i,r),l=this.schedulers.ngZone.run(()=>s);return new vu(l,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new sm(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new _u(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(se(Oa),se(Fa,8),se(NE,8),se($A,8),se(wa),se(Ea),se(Ma),se(DE,8),se(HA,8),se($a,8),se(Ba,8),se(Ga,8),se(ja,8),se(za,8),se(Ka,8),se(Wa,8),se(Va,8))};static \u0275prov=Kr({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),wu=(()=>{class n{constructor(){Sn.registerVersion("angularfire",ka.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:NE,useValue:!0},{provide:DE,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=va({type:n});static \u0275inj=ya({providers:[YA]})}return n})();var VE="@firebase/database",ME="1.0.7";var vp="";function wp(n){vp=n}var pm=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),De(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ra(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var gm=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return wt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var dI=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new pm(e)}}catch{}return new gm},Dr=dI("localStorage"),_m=dI("sessionStorage");var Ui=new Qr("@firebase/database"),fI=function(){let n=1;return function(){return n++}}(),mI=function(n){let e=B_(n),t=new q_;t.update(e);let r=t.digest();return N_.encodeByteArray(r)},qo=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=qo.apply(null,r):typeof r=="object"?e+=De(r):e+=r,e+=" "}return e},kr=null,OE=!0,pI=function(n,e){M(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ui.logLevel=Et.VERBOSE,kr=Ui.log.bind(Ui),e&&_m.set("logging_enabled",!0)):typeof n=="function"?kr=n:(kr=null,_m.remove("logging_enabled"))},je=function(...n){if(OE===!0&&(OE=!1,kr===null&&_m.get("logging_enabled")===!0&&pI(!0)),kr){let e=qo.apply(null,n);kr(e)}},Bo=function(n){return function(...e){je(n,...e)}},ym=function(...n){let e="FIREBASE INTERNAL ERROR: "+qo(...n);Ui.error(e)},Jt=function(...n){let e=`FIREBASE FATAL ERROR: ${qo(...n)}`;throw Ui.error(e),new Error(e)},et=function(...n){let e="FIREBASE WARNING: "+qo(...n);Ui.warn(e)},JA=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&et("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},$u=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},XA=function(n){if(Ft()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},$n="[MIN_NAME]",mn="[MAX_NAME]",Mr=function(n,e){if(n===e)return 0;if(n===$n||e===mn)return-1;if(e===$n||n===mn)return 1;{let t=FE(n),r=FE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},ZA=function(n,e){return n===e?0:n<e?-1:1},_o=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+De(e))},Ep=function(n){if(typeof n!="object"||n===null)return De(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=De(e[r]),t+=":",t+=Ep(n[e[r]]);return t+="}",t},gI=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function ze(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var _I=function(n){M(!$u(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,l,u;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=l+r,o=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let c=[];for(u=t;u;u-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();let d=c.join(""),m="";for(u=0;u<64;u+=8){let p=parseInt(d.substr(u,8),2).toString(16);p.length===1&&(p="0"+p),m=m+p}return m.toLowerCase()},eC=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},tC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function nC(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var rC=new RegExp("^-?(0*)\\d{1,10}$"),iC=-2147483648,sC=2147483647,FE=function(n){if(rC.test(n)){let e=Number(n);if(e>=iC&&e<=sC)return e}return null},$i=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw et("Exception was thrown by user callback.",t),e},Math.floor(0))}},oC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Eo=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var vm=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){et(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var wm=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(je("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',et(e)}},Io=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Iu="5",yI="v",vI="s",wI="r",EI="f",II=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,TI="ls",SI="p",Em="ac",AI="websocket",CI="long_polling";var Tu=class{constructor(e,t,r,i,s=!1,o="",l=!1,u=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Dr.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Dr.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function aC(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function bI(n,e,t){M(typeof e=="string","typeof type must == string"),M(typeof t=="object","typeof params must == object");let r;if(e===AI)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===CI)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);aC(n)&&(t.ns=n.namespace);let i=[];return ze(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var Im=class{constructor(){this.counters_={}}incrementCounter(e,t=1){wt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return k_(this.counters_)}};var lm={},um={};function Ip(n){let e=n.toString();return lm[e]||(lm[e]=new Im),lm[e]}function lC(n,e){let t=n.toString();return um[t]||(um[t]=e()),um[t]}var Tm=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&$i(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var LE="start",uC="close",cC="pLPCommand",hC="pRTLPCB",RI="id",PI="pw",xI="ser",dC="cb",fC="seg",mC="ts",pC="d",gC="dframe",NI=1870,DI=30,_C=NI-DI,yC=25e3,vC=3e4,Co=class n{constructor(e,t,r,i,s,o,l){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Bo(e),this.stats_=Ip(t),this.urlFn=u=>(this.appCheckToken&&(u[Em]=this.appCheckToken),bI(t,CI,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Tm(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(vC)),XA(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Sm((...s)=>{let[o,l,u,c,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===LE)this.id=l,this.password=u;else if(o===uC)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,l]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);let r={};r[LE]="t",r[xI]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[dC]=this.scriptTagHolder.uniqueCallbackIdentifier),r[yI]=Iu,this.transportSessionId&&(r[vI]=this.transportSessionId),this.lastSessionId&&(r[TI]=this.lastSessionId),this.applicationId&&(r[SI]=this.applicationId),this.appCheckToken&&(r[Em]=this.appCheckToken),typeof location<"u"&&location.hostname&&II.test(location.hostname)&&(r[wI]=EI);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Ft()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!eC()&&!tC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=De(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=D_(t),i=gI(r,_C);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ft())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[gC]="t",r[RI]=e,r[PI]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=De(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Sm=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ft())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=fI(),window[cC+this.uniqueCallbackIdentifier]=e,window[hC+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){je("frame writing exception"),l.stack&&je(l.stack),je(l)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||je("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[RI]=this.myID,e[PI]=this.myPW,e[xI]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+DI+r.length<=NI;){let o=this.pendingSegs.shift();r=r+"&"+fC+i+"="+o.seg+"&"+mC+i+"="+o.ts+"&"+pC+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(yC)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){Ft()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{je("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var wC=16384,EC=45e3,Su=null;typeof MozWebSocket<"u"?Su=MozWebSocket:typeof WebSocket<"u"&&(Su=WebSocket);var Fi=(()=>{class n{constructor(t,r,i,s,o,l,u){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Bo(this.connId),this.stats_=Ip(r),this.connURL=n.connectionURL_(r,l,u,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let l={};return l[yI]=Iu,!Ft()&&typeof location<"u"&&location.hostname&&II.test(location.hostname)&&(l[wI]=EI),r&&(l[vI]=r),i&&(l[TI]=i),s&&(l[Em]=s),o&&(l[SI]=o),bI(t,AI,l)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Dr.set("previous_websocket_failure",!0);try{let i;if(Ft()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${Iu}/${vp}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,l=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;l&&(i.proxy={origin:l})}this.mySock=new Su(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&Su!==null&&!n.forceDisallow_}static previouslyFailed(){return Dr.isInMemoryStorage||Dr.get("previous_websocket_failure")===!0}markConnectionHealthy(){Dr.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=Ra(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(M(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=De(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=gI(r,wC);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(EC))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),kI=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Co,Fi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=Fi&&Fi.isAvailable(),i=r&&!Fi.previouslyFailed();if(t.webSocketOnly&&(r||et("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Fi];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),IC=6e4,TC=5e3,SC=10*1024,AC=100*1024,cm="t",UE="d",CC="s",qE="r",bC="e",BE="o",GE="a",jE="n",zE="p",RC="h",Am=class{constructor(e,t,r,i,s,o,l,u,c,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Bo("c:"+this.id+":"),this.transportManager_=new kI(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Eo(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>AC?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>SC?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(cm in e){let t=e[cm];t===GE?this.upgradeIfSecondaryHealthy_():t===qE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===BE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=_o("t",e),r=_o("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:zE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:GE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:jE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=_o("t",e),r=_o("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=_o(cm,e);if(UE in e){let r=e[UE];if(t===RC){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===jE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===CC?this.onConnectionShutdown_(r):t===qE?this.onReset_(r):t===bC?ym("Server Error: "+r):t===BE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ym("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Iu!==r&&et("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Eo(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(IC))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Eo(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(TC))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:zE,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Dr.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Au=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var Cu=class{constructor(e){this.allowedEvents_=e,this.listeners_={},M(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){M(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var bu=class n extends Cu{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!$c()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return M(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var KE=32,WE=768,he=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function ce(){return new he("")}function Z(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Hn(n){return n.pieces_.length-n.pieceNum_}function ge(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new he(n.pieces_,e)}function Tp(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function PC(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function bo(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function VI(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new he(e,0)}function Te(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof he)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new he(t,0)}function ee(n){return n.pieceNum_>=n.pieces_.length}function at(n,e){let t=Z(n),r=Z(e);if(t===null)return e;if(t===r)return at(ge(n),ge(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function xC(n,e){let t=bo(n,0),r=bo(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=Mr(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Sp(n,e){if(Hn(n)!==Hn(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Ct(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Hn(n)>Hn(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var Cm=class{constructor(e,t){this.errorPrefix_=t,this.parts_=bo(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=As(this.parts_[r]);MI(this)}};function NC(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=As(e),MI(n)}function DC(n){let e=n.parts_.pop();n.byteLength_-=As(e),n.parts_.length>0&&(n.byteLength_-=1)}function MI(n){if(n.byteLength_>WE)throw new Error(n.errorPrefix_+"has a key path longer than "+WE+" bytes ("+n.byteLength_+").");if(n.parts_.length>KE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+KE+") or object contains a cycle "+Nr(n))}function Nr(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var bm=class n extends Cu{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return M(e==="visible","Unknown event type: "+e),[this.visible_]}};var yo=1e3,kC=60*5*1e3,QE=30*1e3,VC=1.3,MC=3e4,OC="server_kill",$E=3,Ap=(()=>{class n extends Au{constructor(t,r,i,s,o,l,u,c){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=l,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Bo("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=yo,this.maxReconnectDelay_=kC,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Ft())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");bm.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&bu.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(De(o)),M(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new rt,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:l=>{let u=l.d;l.s==="ok"?r.resolve(u):r.reject(u)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,l=t._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),M(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),M(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");let u={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(l).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},l="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(l,o,u=>{let c=u.d,d=u.s;n.warnOnListenWarnings_(c,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",u),d!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(d,c))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&wt(t,"w")){let i=Tn(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();et(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||L_(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=QE)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=F_(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,l=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,l))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),M(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},l="n";s&&(o.q=i,o.t=s),this.sendRequest(l,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,l=>{s&&setTimeout(()=>{s(l.s,l.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let l={p:r,d:i};o!==void 0&&(l.h=o),this.outstandingPuts_.push({action:t,request:l,onComplete:s}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+De(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):ym("Unrecognized action received from server: "+De(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){M(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=yo,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=yo,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>MC&&(this.reconnectDelay_=yo),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*VC)}this.onConnectStatus_(!1)}establishConnection_(){return N(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,l=!1,u=null,c=function(){u?u.close():(l=!0,i())},d=function(p){M(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(p)};this.realtime_={close:c,sendRequest:d};let m=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[p,y]=yield Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)]);l?je("getToken() completed but was canceled"):(je("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=y&&y.token,u=new Am(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,A=>{et(A+" ("+this.repoInfo_.toString()+")"),this.interrupt(OC)},o))}catch(p){this.log_("Failed to get token: "+p),l||(this.repoInfo_.nodeAdmin&&et(p),c())}}})}interrupt(t){je("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){je("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Pa(this.interruptReasons_)&&(this.reconnectDelay_=yo,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>Ep(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new he(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){je("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=$E&&(this.reconnectDelay_=QE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){je("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=$E&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";Ft()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+vp.replace(/\./g,"-")]=1,$c()?t["framework.cordova"]=1:V_()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=bu.getInstance().currentlyOnline();return Pa(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),te=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var qi=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new te($n,e),i=new te($n,t);return this.compare(r,i)!==0}minPost(){return te.MIN}};var Eu,Ru=class extends qi{static get __EMPTY_NODE(){return Eu}static set __EMPTY_NODE(e){Eu=e}compare(e,t){return Mr(e.name,t.name)}isDefinedOn(e){throw Wr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return te.MIN}maxPost(){return new te(mn,Eu)}makePost(e,t){return M(typeof e=="string","KeyIndex indexValue must always be a string."),new te(e,Eu)}toString(){return".key"}},Yt=new Ru;var Li=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Vt=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??bt.EMPTY_NODE,this.right=o??bt.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return bt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return bt.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Rm=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new Vt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},bt=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Vt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Vt.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Li(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Li(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Li(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Li(this.root_,null,this.comparator_,!0,e)}};bt.EMPTY_NODE=new Rm;function FC(n,e){return Mr(n.name,e.name)}function Cp(n,e){return Mr(n,e)}var Pm;function LC(n){Pm=n}var OI=function(n){return typeof n=="number"?"number:"+_I(n):"string:"+n},FI=function(n){if(n.isLeafNode()){let e=n.val();M(typeof e=="string"||typeof e=="number"||typeof e=="object"&&wt(e,".sv"),"Priority must be a string or number.")}else M(n===Pm||n.isEmpty(),"priority of unexpected type.");M(n===Pm||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var HE,Bi=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,M(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),FI(this.priorityNode_)}static set __childrenNodeConstructor(t){HE=t}static get __childrenNodeConstructor(){return HE}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ee(t)?this:Z(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=Z(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(M(i!==".priority"||Hn(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(ge(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+OI(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=_I(this.value_):t+=this.value_,this.lazyHash_=mI(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(M(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return M(s>=0,"Unknown leaf type: "+r),M(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),LI,UI;function UC(n){LI=n}function qC(n){UI=n}var xm=class extends qi{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?Mr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return te.MIN}maxPost(){return new te(mn,new Bi("[PRIORITY-POST]",UI))}makePost(e,t){let r=LI(e);return new te(t,new Bi("[PRIORITY-POST]",r))}toString(){return".priority"}},ye=new xm;var BC=Math.log(2),Nm=class{constructor(e){let t=s=>parseInt(Math.log(s)/BC,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Pu=function(n,e,t,r){n.sort(e);let i=function(u,c){let d=c-u,m,p;if(d===0)return null;if(d===1)return m=n[u],p=t?t(m):m,new Vt(p,m.node,Vt.BLACK,null,null);{let y=parseInt(d/2,10)+u,A=i(u,y),x=i(y+1,c);return m=n[y],p=t?t(m):m,new Vt(p,m.node,Vt.BLACK,A,x)}},s=function(u){let c=null,d=null,m=n.length,p=function(A,x){let D=m-A,B=m;m-=A;let j=i(D+1,B),q=n[D],J=t?t(q):q;y(new Vt(J,q.node,x,null,j))},y=function(A){c?(c.left=A,c=A):(d=A,c=A)};for(let A=0;A<u.count;++A){let x=u.nextBitIsOne(),D=Math.pow(2,u.count-(A+1));x?p(D,Vt.BLACK):(p(D,Vt.BLACK),p(D,Vt.RED))}return d},o=new Nm(n.length),l=s(o);return new bt(r||e,l)};var hm,Oi={},Gi=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return M(Oi&&ye,"ChildrenNode.ts has not been loaded"),hm=hm||new n({".priority":Oi},{".priority":ye}),hm}get(e){let t=Tn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof bt?t:null}hasIndex(e){return wt(this.indexSet_,e.toString())}addIndex(e,t){M(e!==Yt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(te.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let l;i?l=Pu(r,e.getCompare()):l=Oi;let u=e.toString(),c=Object.assign({},this.indexSet_);c[u]=e;let d=Object.assign({},this.indexes_);return d[u]=l,new n(d,c)}addToIndexes(e,t){let r=Ss(this.indexes_,(i,s)=>{let o=Tn(this.indexSet_,s);if(M(o,"Missing index implementation for "+s),i===Oi)if(o.isDefinedOn(e.node)){let l=[],u=t.getIterator(te.Wrap),c=u.getNext();for(;c;)c.name!==e.name&&l.push(c),c=u.getNext();return l.push(e),Pu(l,o.getCompare())}else return Oi;else{let l=t.get(e.name),u=i;return l&&(u=u.remove(new te(e.name,l))),u.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=Ss(this.indexes_,i=>{if(i===Oi)return i;{let s=t.get(e.name);return s?i.remove(new te(e.name,s)):i}});return new n(r,this.indexSet_)}};var vo,H=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&FI(this.priorityNode_),this.children_.isEmpty()&&M(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return vo||(vo=new n(new bt(Cp),null,Gi.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||vo}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?vo:r}}getChild(t){let r=Z(t);return r===null?this:this.getImmediateChild(r).getChild(ge(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(M(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new te(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let l=s.isEmpty()?vo:this.priorityNode_;return new n(s,l,o)}}updateChild(t,r){let i=Z(t);if(i===null)return r;{M(Z(t)!==".priority"||Hn(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(ge(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(ye,(l,u)=>{r[l]=u.val(t),i++,o&&n.INTEGER_REGEXP_.test(l)?s=Math.max(s,Number(l)):o=!1}),!t&&o&&s<2*i){let l=[];for(let u in r)l[u]=r[u];return l}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+OI(this.getPriority().val())+":"),this.forEachChild(ye,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":mI(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new te(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new te(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new te(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,te.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Go?-1:0}withIndex(t){if(t===Yt||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===Yt||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(ye),s=r.getIterator(ye),o=i.getNext(),l=s.getNext();for(;o&&l;){if(o.name!==l.name||!o.node.equals(l.node))return!1;o=i.getNext(),l=s.getNext()}return o===null&&l===null}else return!1;else return!1}}resolveIndex_(t){return t===Yt?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Dm=class extends H{constructor(){super(new bt(Cp),H.EMPTY_NODE,Gi.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return H.EMPTY_NODE}isEmpty(){return!1}},Go=new Dm;Object.defineProperties(te,{MIN:{value:new te($n,H.EMPTY_NODE)},MAX:{value:new te(mn,Go)}});Ru.__EMPTY_NODE=H.EMPTY_NODE;Bi.__childrenNodeConstructor=H;LC(Go);qC(Go);var GC=!0;function Ae(n,e=null){if(n===null)return H.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),M(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Bi(t,Ae(e))}if(!(n instanceof Array)&&GC){let t=[],r=!1;if(ze(n,(o,l)=>{if(o.substring(0,1)!=="."){let u=Ae(l);u.isEmpty()||(r=r||!u.getPriority().isEmpty(),t.push(new te(o,u)))}}),t.length===0)return H.EMPTY_NODE;let s=Pu(t,FC,o=>o.name,Cp);if(r){let o=Pu(t,ye.getCompare());return new H(s,Ae(e),new Gi({".priority":o},{".priority":ye}))}else return new H(s,Ae(e),Gi.Default)}else{let t=H.EMPTY_NODE;return ze(n,(r,i)=>{if(wt(n,r)&&r.substring(0,1)!=="."){let s=Ae(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Ae(e))}}UC(Ae);var Ro=class extends qi{constructor(e){super(),this.indexPath_=e,M(!ee(e)&&Z(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?Mr(e.name,t.name):s}makePost(e,t){let r=Ae(e),i=H.EMPTY_NODE.updateChild(this.indexPath_,r);return new te(t,i)}maxPost(){let e=H.EMPTY_NODE.updateChild(this.indexPath_,Go);return new te(mn,e)}toString(){return bo(this.indexPath_,0).join("/")}};var km=class extends qi{compare(e,t){let r=e.node.compareTo(t.node);return r===0?Mr(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return te.MIN}maxPost(){return te.MAX}makePost(e,t){let r=Ae(e);return new te(t,r)}toString(){return".value"}},bp=new km;function qI(n){return{type:"value",snapshotNode:n}}function ji(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Po(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function xo(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function jC(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var No=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){M(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let l=e.getImmediateChild(t);return l.getChild(i).equals(r.getChild(i))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Po(t,l)):M(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(ji(t,r)):o.trackChildChange(xo(t,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(ye,(i,s)=>{t.hasChild(i)||r.trackChildChange(Po(i,s))}),t.isLeafNode()||t.forEachChild(ye,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(xo(i,s,o))}else r.trackChildChange(ji(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?H.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var xu=class n{constructor(e){this.indexedFilter_=new No(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new te(t,r))||(r=H.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=H.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(H.EMPTY_NODE);let s=this;return t.forEachChild(ye,(o,l)=>{s.matches(new te(o,l))||(i=i.updateImmediateChild(o,H.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Vm=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new xu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new te(t,r))||(r=H.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=H.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=H.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let l=s.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))i=i.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(H.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let l=s.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:i=i.updateImmediateChild(l.name,H.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let m=this.index_.getCompare();o=(p,y)=>m(y,p)}else o=this.index_.getCompare();let l=e;M(l.numChildren()===this.limit_,"");let u=new te(t,r),c=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),d=this.rangedFilter_.matches(u);if(l.hasChild(t)){let m=l.getImmediateChild(t),p=i.getChildAfterChild(this.index_,c,this.reverse_);for(;p!=null&&(p.name===t||l.hasChild(p.name));)p=i.getChildAfterChild(this.index_,p,this.reverse_);let y=p==null?1:o(p,u);if(d&&!r.isEmpty()&&y>=0)return s?.trackChildChange(xo(t,r,m)),l.updateImmediateChild(t,r);{s?.trackChildChange(Po(t,m));let x=l.updateImmediateChild(t,H.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(s?.trackChildChange(ji(p.name,p.node)),x.updateImmediateChild(p.name,p.node)):x}}else return r.isEmpty()?e:d&&o(c,u)>=0?(s!=null&&(s.trackChildChange(Po(c.name,c.node)),s.trackChildChange(ji(t,r))),l.updateImmediateChild(t,r).updateImmediateChild(c.name,H.EMPTY_NODE)):e}};var Do=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ye}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return M(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return M(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:$n}hasEnd(){return this.endSet_}getIndexEndValue(){return M(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return M(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:mn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return M(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ye}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function zC(n){return n.loadsAllData()?new No(n.getIndex()):n.hasLimit()?new Vm(n):new xu(n)}function KC(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function WC(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Mm(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function QC(n,e,t){let r;return n.index_===Yt||t?r=Mm(n,e,t):r=Mm(n,e,mn),r.startAfterSet_=!0,r}function Om(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function $C(n,e,t){let r;return n.index_===Yt||t?r=Om(n,e,t):r=Om(n,e,$n),r.endBeforeSet_=!0,r}function Hu(n,e){let t=n.copy();return t.index_=e,t}function YE(n){let e={};if(n.isDefault())return e;let t;if(n.index_===ye?t="$priority":n.index_===bp?t="$value":n.index_===Yt?t="$key":(M(n.index_ instanceof Ro,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=De(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=De(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+De(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=De(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+De(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function JE(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ye&&(e.i=n.index_.toString()),e}var Fm=class n extends Au{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Bo("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(M(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),l={};this.listens_[o]=l;let u=YE(e._queryParams);this.restRequest_(s+".json",u,(c,d)=>{let m=d;if(c===404&&(m=null,c=null),c===null&&this.onDataUpdate_(s,m,!1,r),Tn(this.listens_,o)===l){let p;c?c===401?p="permission_denied":p="rest_error:"+c:p="ok",i(p,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=YE(e._queryParams),r=e._path.toString(),i=new rt;return this.restRequest_(r+".json",t,(s,o)=>{let l=o;s===404&&(l=null,s=null),s===null?(this.onDataUpdate_(r,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+U_(t);this.log_("Sending REST request for "+o);let l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let u=null;if(l.status>=200&&l.status<300){try{u=Ra(l.responseText)}catch{et("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,u)}else l.status!==401&&l.status!==404&&et("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}};var Lm=class{constructor(){this.rootNode_=H.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Nu(){return{value:null,children:new Map}}function Hi(n,e,t){if(ee(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=Z(e);n.children.has(r)||n.children.set(r,Nu());let i=n.children.get(r);e=ge(e),Hi(i,e,t)}}function Um(n,e){if(ee(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(ye,(r,i)=>{Hi(n,new he(r),i)}),Um(n,e)}}else if(n.children.size>0){let t=Z(e);return e=ge(e),n.children.has(t)&&Um(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function qm(n,e,t){n.value!==null?t(e,n.value):HC(n,(r,i)=>{let s=new he(e.toString()+"/"+r);qm(i,s,t)})}function HC(n,e){n.children.forEach((t,r)=>{e(r,t)})}var Bm=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ze(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var XE=10*1e3,YC=30*1e3,JC=5*60*1e3,Gm=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Bm(e);let r=XE+(YC-XE)*Math.random();Eo(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;ze(e,(i,s)=>{s>0&&wt(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Eo(this.reportStats_.bind(this),Math.floor(Math.random()*2*JC))}};var Ht=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Ht||{});function Rp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Pp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function xp(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var jm=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Ht.ACK_USER_WRITE,this.source=Rp()}operationForChild(e){if(ee(this.path)){if(this.affectedTree.value!=null)return M(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new he(e));return new n(ce(),t,this.revert)}}else return M(Z(this.path)===e,"operationForChild called for unrelated child."),new n(ge(this.path),this.affectedTree,this.revert)}};var Du=class n{constructor(e,t){this.source=e,this.path=t,this.type=Ht.LISTEN_COMPLETE}operationForChild(e){return ee(this.path)?new n(this.source,ce()):new n(this.source,ge(this.path))}};var zi=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Ht.OVERWRITE}operationForChild(e){return ee(this.path)?new n(this.source,ce(),this.snap.getImmediateChild(e)):new n(this.source,ge(this.path),this.snap)}};var ko=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Ht.MERGE}operationForChild(e){if(ee(this.path)){let t=this.children.subtree(new he(e));return t.isEmpty()?null:t.value?new zi(this.source,ce(),t.value):new n(this.source,ce(),t)}else return M(Z(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,ge(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Xt=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ee(e))return this.isFullyInitialized()&&!this.filtered_;let t=Z(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var zm=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function XC(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(jC(o.childName,o.snapshotNode))}),wo(n,i,"child_removed",e,r,t),wo(n,i,"child_added",e,r,t),wo(n,i,"child_moved",s,r,t),wo(n,i,"child_changed",e,r,t),wo(n,i,"value",e,r,t),i}function wo(n,e,t,r,i,s){let o=r.filter(l=>l.type===t);o.sort((l,u)=>eb(n,l,u)),o.forEach(l=>{let u=ZC(n,l,s);i.forEach(c=>{c.respondsTo(l.type)&&e.push(c.createEvent(u,n.query_))})})}function ZC(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function eb(n,e,t){if(e.childName==null||t.childName==null)throw Wr("Should only compare child_ events.");let r=new te(e.childName,e.snapshotNode),i=new te(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function Yu(n,e){return{eventCache:n,serverCache:e}}function To(n,e,t,r){return Yu(new Xt(e,t,r),n.serverCache)}function BI(n,e,t,r){return Yu(n.eventCache,new Xt(e,t,r))}function ku(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Vr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var dm,tb=()=>(dm||(dm=new bt(ZA)),dm),lt=class n{constructor(e,t=tb()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return ze(e,(r,i)=>{t=t.set(new he(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ce(),value:this.value};if(ee(e))return null;{let r=Z(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(ge(e),t);return s!=null?{path:Te(new he(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ee(e))return this;{let t=Z(e),r=this.children.get(t);return r!==null?r.subtree(ge(e)):new n(null)}}set(e,t){if(ee(e))return new n(t,this.children);{let r=Z(e),s=(this.children.get(r)||new n(null)).set(ge(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ee(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=Z(e),r=this.children.get(t);if(r){let i=r.remove(ge(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ee(e))return this.value;{let t=Z(e),r=this.children.get(t);return r?r.get(ge(e)):null}}setTree(e,t){if(ee(e))return t;{let r=Z(e),s=(this.children.get(r)||new n(null)).setTree(ge(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(ce(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(Te(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,ce(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ee(e))return null;{let s=Z(e),o=this.children.get(s);return o?o.findOnPath_(ge(e),Te(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ce(),t)}foreachOnPath_(e,t,r){if(ee(e))return this;{this.value&&r(t,this.value);let i=Z(e),s=this.children.get(i);return s?s.foreachOnPath_(ge(e),Te(t,i),r):new n(null)}}foreach(e){this.foreach_(ce(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(Te(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Mt=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new lt(null))}};function So(n,e,t){if(ee(e))return new Mt(new lt(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=at(i,e);return s=s.updateChild(o,t),new Mt(n.writeTree_.set(i,s))}else{let i=new lt(t),s=n.writeTree_.setTree(e,i);return new Mt(s)}}}function Km(n,e,t){let r=n;return ze(t,(i,s)=>{r=So(r,Te(e,i),s)}),r}function ZE(n,e){if(ee(e))return Mt.empty();{let t=n.writeTree_.setTree(e,new lt(null));return new Mt(t)}}function Wm(n,e){return Or(n,e)!=null}function Or(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(at(t.path,e)):null}function eI(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ye,(r,i)=>{e.push(new te(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new te(r,i.value))}),e}function Wn(n,e){if(ee(e))return n;{let t=Or(n,e);return t!=null?new Mt(new lt(t)):new Mt(n.writeTree_.subtree(e))}}function Qm(n){return n.writeTree_.isEmpty()}function Ki(n,e){return GI(ce(),n.writeTree_,e)}function GI(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(M(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=GI(Te(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Te(n,".priority"),r)),t}}function Ju(n,e){return WI(e,n)}function nb(n,e,t,r,i){M(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=So(n.visibleWrites,e,t)),n.lastWriteId=r}function rb(n,e,t,r){M(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Km(n.visibleWrites,e,t),n.lastWriteId=r}function ib(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function sb(n,e){let t=n.allWrites.findIndex(l=>l.writeId===e);M(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let l=n.allWrites[o];l.visible&&(o>=t&&ob(l,r.path)?i=!1:Ct(r.path,l.path)&&(s=!0)),o--}if(i){if(s)return ab(n),!0;if(r.snap)n.visibleWrites=ZE(n.visibleWrites,r.path);else{let l=r.children;ze(l,u=>{n.visibleWrites=ZE(n.visibleWrites,Te(r.path,u))})}return!0}else return!1}function ob(n,e){if(n.snap)return Ct(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Ct(Te(n.path,t),e))return!0;return!1}function ab(n){n.visibleWrites=jI(n.allWrites,lb,ce()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function lb(n){return n.visible}function jI(n,e,t){let r=Mt.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,l;if(s.snap)Ct(t,o)?(l=at(t,o),r=So(r,l,s.snap)):Ct(o,t)&&(l=at(o,t),r=So(r,ce(),s.snap.getChild(l)));else if(s.children){if(Ct(t,o))l=at(t,o),r=Km(r,l,s.children);else if(Ct(o,t))if(l=at(o,t),ee(l))r=Km(r,ce(),s.children);else{let u=Tn(s.children,Z(l));if(u){let c=u.getChild(ge(l));r=So(r,ce(),c)}}}else throw Wr("WriteRecord should have .snap or .children")}}return r}function zI(n,e,t,r,i){if(!r&&!i){let s=Or(n.visibleWrites,e);if(s!=null)return s;{let o=Wn(n.visibleWrites,e);if(Qm(o))return t;if(t==null&&!Wm(o,ce()))return null;{let l=t||H.EMPTY_NODE;return Ki(o,l)}}}else{let s=Wn(n.visibleWrites,e);if(!i&&Qm(s))return t;if(!i&&t==null&&!Wm(s,ce()))return null;{let o=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(Ct(c.path,e)||Ct(e,c.path))},l=jI(n.allWrites,o,e),u=t||H.EMPTY_NODE;return Ki(l,u)}}}function ub(n,e,t){let r=H.EMPTY_NODE,i=Or(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(ye,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=Wn(n.visibleWrites,e);return t.forEachChild(ye,(o,l)=>{let u=Ki(Wn(s,new he(o)),l);r=r.updateImmediateChild(o,u)}),eI(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=Wn(n.visibleWrites,e);return eI(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function cb(n,e,t,r,i){M(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=Te(e,t);if(Wm(n.visibleWrites,s))return null;{let o=Wn(n.visibleWrites,s);return Qm(o)?i.getChild(t):Ki(o,i.getChild(t))}}function hb(n,e,t,r){let i=Te(e,t),s=Or(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=Wn(n.visibleWrites,i);return Ki(o,r.getNode().getImmediateChild(t))}else return null}function db(n,e){return Or(n.visibleWrites,e)}function fb(n,e,t,r,i,s,o){let l,u=Wn(n.visibleWrites,e),c=Or(u,ce());if(c!=null)l=c;else if(t!=null)l=Ki(u,t);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){let d=[],m=o.getCompare(),p=s?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o),y=p.getNext();for(;y&&d.length<i;)m(y,r)!==0&&d.push(y),y=p.getNext();return d}else return[]}function mb(){return{visibleWrites:Mt.empty(),allWrites:[],lastWriteId:-1}}function Vu(n,e,t,r){return zI(n.writeTree,n.treePath,e,t,r)}function Np(n,e){return ub(n.writeTree,n.treePath,e)}function tI(n,e,t,r){return cb(n.writeTree,n.treePath,e,t,r)}function Mu(n,e){return db(n.writeTree,Te(n.treePath,e))}function pb(n,e,t,r,i,s){return fb(n.writeTree,n.treePath,e,t,r,i,s)}function Dp(n,e,t){return hb(n.writeTree,n.treePath,e,t)}function KI(n,e){return WI(Te(n.treePath,e),n.writeTree)}function WI(n,e){return{treePath:n,writeTree:e}}var $m=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;M(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),M(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,xo(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Po(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,ji(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,xo(r,e.snapshotNode,i.oldSnap));else throw Wr("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var Hm=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},QI=new Hm,Vo=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new Xt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Dp(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Vr(this.viewCache_),s=pb(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function gb(n){return{filter:n}}function _b(n,e){M(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),M(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function yb(n,e,t,r,i){let s=new $m,o,l;if(t.type===Ht.OVERWRITE){let c=t;c.source.fromUser?o=Ym(n,e,c.path,c.snap,r,i,s):(M(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered()&&!ee(c.path),o=Ou(n,e,c.path,c.snap,r,i,l,s))}else if(t.type===Ht.MERGE){let c=t;c.source.fromUser?o=wb(n,e,c.path,c.children,r,i,s):(M(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered(),o=Jm(n,e,c.path,c.children,r,i,l,s))}else if(t.type===Ht.ACK_USER_WRITE){let c=t;c.revert?o=Tb(n,e,c.path,r,i,s):o=Eb(n,e,c.path,c.affectedTree,r,i,s)}else if(t.type===Ht.LISTEN_COMPLETE)o=Ib(n,e,t.path,r,s);else throw Wr("Unknown operation type: "+t.type);let u=s.getChanges();return vb(e,o,u),{viewCache:o,changes:u}}function vb(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=ku(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(qI(ku(e)))}}function $I(n,e,t,r,i,s){let o=e.eventCache;if(Mu(r,t)!=null)return e;{let l,u;if(ee(t))if(M(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Vr(e),d=c instanceof H?c:H.EMPTY_NODE,m=Np(r,d);l=n.filter.updateFullNode(e.eventCache.getNode(),m,s)}else{let c=Vu(r,Vr(e));l=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=Z(t);if(c===".priority"){M(Hn(t)===1,"Can't have a priority with additional path components");let d=o.getNode();u=e.serverCache.getNode();let m=tI(r,t,d,u);m!=null?l=n.filter.updatePriority(d,m):l=o.getNode()}else{let d=ge(t),m;if(o.isCompleteForChild(c)){u=e.serverCache.getNode();let p=tI(r,t,o.getNode(),u);p!=null?m=o.getNode().getImmediateChild(c).updateChild(d,p):m=o.getNode().getImmediateChild(c)}else m=Dp(r,c,e.serverCache);m!=null?l=n.filter.updateChild(o.getNode(),c,m,d,i,s):l=o.getNode()}}return To(e,l,o.isFullyInitialized()||ee(t),n.filter.filtersNodes())}}function Ou(n,e,t,r,i,s,o,l){let u=e.serverCache,c,d=o?n.filter:n.filter.getIndexedFilter();if(ee(t))c=d.updateFullNode(u.getNode(),r,null);else if(d.filtersNodes()&&!u.isFiltered()){let y=u.getNode().updateChild(t,r);c=d.updateFullNode(u.getNode(),y,null)}else{let y=Z(t);if(!u.isCompleteForPath(t)&&Hn(t)>1)return e;let A=ge(t),D=u.getNode().getImmediateChild(y).updateChild(A,r);y===".priority"?c=d.updatePriority(u.getNode(),D):c=d.updateChild(u.getNode(),y,D,A,QI,null)}let m=BI(e,c,u.isFullyInitialized()||ee(t),d.filtersNodes()),p=new Vo(i,m,s);return $I(n,m,t,i,p,l)}function Ym(n,e,t,r,i,s,o){let l=e.eventCache,u,c,d=new Vo(i,e,s);if(ee(t))c=n.filter.updateFullNode(e.eventCache.getNode(),r,o),u=To(e,c,!0,n.filter.filtersNodes());else{let m=Z(t);if(m===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),r),u=To(e,c,l.isFullyInitialized(),l.isFiltered());else{let p=ge(t),y=l.getNode().getImmediateChild(m),A;if(ee(p))A=r;else{let x=d.getCompleteChild(m);x!=null?Tp(p)===".priority"&&x.getChild(VI(p)).isEmpty()?A=x:A=x.updateChild(p,r):A=H.EMPTY_NODE}if(y.equals(A))u=e;else{let x=n.filter.updateChild(l.getNode(),m,A,p,d,o);u=To(e,x,l.isFullyInitialized(),n.filter.filtersNodes())}}}return u}function nI(n,e){return n.eventCache.isCompleteForChild(e)}function wb(n,e,t,r,i,s,o){let l=e;return r.foreach((u,c)=>{let d=Te(t,u);nI(e,Z(d))&&(l=Ym(n,l,d,c,i,s,o))}),r.foreach((u,c)=>{let d=Te(t,u);nI(e,Z(d))||(l=Ym(n,l,d,c,i,s,o))}),l}function rI(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function Jm(n,e,t,r,i,s,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,c;ee(t)?c=r:c=new lt(null).setTree(t,r);let d=e.serverCache.getNode();return c.children.inorderTraversal((m,p)=>{if(d.hasChild(m)){let y=e.serverCache.getNode().getImmediateChild(m),A=rI(n,y,p);u=Ou(n,u,new he(m),A,i,s,o,l)}}),c.children.inorderTraversal((m,p)=>{let y=!e.serverCache.isCompleteForChild(m)&&p.value===null;if(!d.hasChild(m)&&!y){let A=e.serverCache.getNode().getImmediateChild(m),x=rI(n,A,p);u=Ou(n,u,new he(m),x,i,s,o,l)}}),u}function Eb(n,e,t,r,i,s,o){if(Mu(i,t)!=null)return e;let l=e.serverCache.isFiltered(),u=e.serverCache;if(r.value!=null){if(ee(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return Ou(n,e,t,u.getNode().getChild(t),i,s,l,o);if(ee(t)){let c=new lt(null);return u.getNode().forEachChild(Yt,(d,m)=>{c=c.set(new he(d),m)}),Jm(n,e,t,c,i,s,l,o)}else return e}else{let c=new lt(null);return r.foreach((d,m)=>{let p=Te(t,d);u.isCompleteForPath(p)&&(c=c.set(d,u.getNode().getChild(p)))}),Jm(n,e,t,c,i,s,l,o)}}function Ib(n,e,t,r,i){let s=e.serverCache,o=BI(e,s.getNode(),s.isFullyInitialized()||ee(t),s.isFiltered());return $I(n,o,t,r,QI,i)}function Tb(n,e,t,r,i,s){let o;if(Mu(r,t)!=null)return e;{let l=new Vo(r,e,i),u=e.eventCache.getNode(),c;if(ee(t)||Z(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Vu(r,Vr(e));else{let m=e.serverCache.getNode();M(m instanceof H,"serverChildren would be complete if leaf node"),d=Np(r,m)}d=d,c=n.filter.updateFullNode(u,d,s)}else{let d=Z(t),m=Dp(r,d,e.serverCache);m==null&&e.serverCache.isCompleteForChild(d)&&(m=u.getImmediateChild(d)),m!=null?c=n.filter.updateChild(u,d,m,ge(t),l,s):e.eventCache.getNode().hasChild(d)?c=n.filter.updateChild(u,d,H.EMPTY_NODE,ge(t),l,s):c=u,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Vu(r,Vr(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||Mu(r,ce())!=null,To(e,c,o,n.filter.filtersNodes())}}var Xm=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new No(r.getIndex()),s=zC(r);this.processor_=gb(s);let o=t.serverCache,l=t.eventCache,u=i.updateFullNode(H.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(H.EMPTY_NODE,l.getNode(),null),d=new Xt(u,o.isFullyInitialized(),i.filtersNodes()),m=new Xt(c,l.isFullyInitialized(),s.filtersNodes());this.viewCache_=Yu(m,d),this.eventGenerator_=new zm(this.query_)}get query(){return this.query_}};function Sb(n){return n.viewCache_.serverCache.getNode()}function Ab(n){return ku(n.viewCache_)}function Cb(n,e){let t=Vr(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ee(e)&&!t.getImmediateChild(Z(e)).isEmpty())?t.getChild(e):null}function iI(n){return n.eventRegistrations_.length===0}function bb(n,e){n.eventRegistrations_.push(e)}function sI(n,e,t){let r=[];if(t){M(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function oI(n,e,t,r){e.type===Ht.MERGE&&e.source.queryId!==null&&(M(Vr(n.viewCache_),"We should always have a full cache before handling merges"),M(ku(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=yb(n.processor_,i,e,t,r);return _b(n.processor_,s.viewCache),M(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,HI(n,s.changes,s.viewCache.eventCache.getNode(),null)}function Rb(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ye,(s,o)=>{r.push(ji(s,o))}),t.isFullyInitialized()&&r.push(qI(t.getNode())),HI(n,r,t.getNode(),e)}function HI(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return XC(n.eventGenerator_,e,t,i)}var Fu,Lu=class{constructor(){this.views=new Map}};function Pb(n){M(!Fu,"__referenceConstructor has already been defined"),Fu=n}function xb(){return M(Fu,"Reference.ts has not been loaded"),Fu}function Nb(n){return n.views.size===0}function kp(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return M(s!=null,"SyncTree gave us an op for an invalid query."),oI(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(oI(o,e,t,r));return s}}function YI(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let l=Vu(t,i?r:null),u=!1;l?u=!0:r instanceof H?(l=Np(t,r),u=!1):(l=H.EMPTY_NODE,u=!1);let c=Yu(new Xt(l,u,!1),new Xt(r,i,!1));return new Xm(e,c)}return o}function Db(n,e,t,r,i,s){let o=YI(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),bb(o,t),Rb(o,t)}function kb(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],l=Yn(n);if(i==="default")for(let[u,c]of n.views.entries())o=o.concat(sI(c,t,r)),iI(c)&&(n.views.delete(u),c.query._queryParams.loadsAllData()||s.push(c.query));else{let u=n.views.get(i);u&&(o=o.concat(sI(u,t,r)),iI(u)&&(n.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return l&&!Yn(n)&&s.push(new(xb())(e._repo,e._path)),{removed:s,events:o}}function JI(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Qn(n,e){let t=null;for(let r of n.views.values())t=t||Cb(r,e);return t}function XI(n,e){if(e._queryParams.loadsAllData())return Xu(n);{let r=e._queryIdentifier;return n.views.get(r)}}function ZI(n,e){return XI(n,e)!=null}function Yn(n){return Xu(n)!=null}function Xu(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Uu;function Vb(n){M(!Uu,"__referenceConstructor has already been defined"),Uu=n}function Mb(){return M(Uu,"Reference.ts has not been loaded"),Uu}var Ob=1,qu=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new lt(null),this.pendingWriteTree_=mb(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Vp(n,e,t,r,i){return nb(n.pendingWriteTree_,e,t,r,i),i?Yi(n,new zi(Rp(),e,t)):[]}function Fb(n,e,t,r){rb(n.pendingWriteTree_,e,t,r);let i=lt.fromObject(t);return Yi(n,new ko(Rp(),e,i))}function Kn(n,e,t=!1){let r=ib(n.pendingWriteTree_,e);if(sb(n.pendingWriteTree_,e)){let s=new lt(null);return r.snap!=null?s=s.set(ce(),!0):ze(r.children,o=>{s=s.set(new he(o),!0)}),Yi(n,new jm(r.path,s,t))}else return[]}function jo(n,e,t){return Yi(n,new zi(Pp(),e,t))}function Lb(n,e,t){let r=lt.fromObject(t);return Yi(n,new ko(Pp(),e,r))}function Ub(n,e){return Yi(n,new Du(Pp(),e))}function qb(n,e,t){let r=Mp(n,t);if(r){let i=Op(r),s=i.path,o=i.queryId,l=at(s,e),u=new Du(xp(o),l);return Fp(n,s,u)}else return[]}function Bu(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),l=[];if(o&&(e._queryIdentifier==="default"||ZI(o,e))){let u=kb(o,e,t,r);Nb(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=u.removed;if(l=u.events,!i){let d=c.findIndex(p=>p._queryParams.loadsAllData())!==-1,m=n.syncPointTree_.findOnPath(s,(p,y)=>Yn(y));if(d&&!m){let p=n.syncPointTree_.subtree(s);if(!p.isEmpty()){let y=jb(p);for(let A=0;A<y.length;++A){let x=y[A],D=x.query,B=rT(n,x);n.listenProvider_.startListening(Ao(D),Mo(n,D),B.hashFn,B.onComplete)}}}!m&&c.length>0&&!r&&(d?n.listenProvider_.stopListening(Ao(e),null):c.forEach(p=>{let y=n.queryToTagMap.get(ec(p));n.listenProvider_.stopListening(Ao(p),y)}))}zb(n,c)}return l}function eT(n,e,t,r){let i=Mp(n,r);if(i!=null){let s=Op(i),o=s.path,l=s.queryId,u=at(o,e),c=new zi(xp(l),u,t);return Fp(n,o,c)}else return[]}function Bb(n,e,t,r){let i=Mp(n,r);if(i){let s=Op(i),o=s.path,l=s.queryId,u=at(o,e),c=lt.fromObject(t),d=new ko(xp(l),u,c);return Fp(n,o,d)}else return[]}function Zm(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(p,y)=>{let A=at(p,i);s=s||Qn(y,A),o=o||Yn(y)});let l=n.syncPointTree_.get(i);l?(o=o||Yn(l),s=s||Qn(l,ce())):(l=new Lu,n.syncPointTree_=n.syncPointTree_.set(i,l));let u;s!=null?u=!0:(u=!1,s=H.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((y,A)=>{let x=Qn(A,ce());x&&(s=s.updateImmediateChild(y,x))}));let c=ZI(l,e);if(!c&&!e._queryParams.loadsAllData()){let p=ec(e);M(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");let y=Kb();n.queryToTagMap.set(p,y),n.tagToQueryMap.set(y,p)}let d=Ju(n.pendingWriteTree_,i),m=Db(l,e,t,d,s,u);if(!c&&!o&&!r){let p=XI(l,e);m=m.concat(Wb(n,e,p))}return m}function Zu(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,l)=>{let u=at(o,e),c=Qn(l,u);if(c)return c});return zI(i,e,s,t,!0)}function Gb(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(c,d)=>{let m=at(c,t);r=r||Qn(d,m)});let i=n.syncPointTree_.get(t);i?r=r||Qn(i,ce()):(i=new Lu,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new Xt(r,!0,!1):null,l=Ju(n.pendingWriteTree_,e._path),u=YI(i,e,l,s?o.getNode():H.EMPTY_NODE,s);return Ab(u)}function Yi(n,e){return tT(e,n.syncPointTree_,null,Ju(n.pendingWriteTree_,ce()))}function tT(n,e,t,r){if(ee(n.path))return nT(n,e,t,r);{let i=e.get(ce());t==null&&i!=null&&(t=Qn(i,ce()));let s=[],o=Z(n.path),l=n.operationForChild(o),u=e.children.get(o);if(u&&l){let c=t?t.getImmediateChild(o):null,d=KI(r,o);s=s.concat(tT(l,u,c,d))}return i&&(s=s.concat(kp(i,n,r,t))),s}}function nT(n,e,t,r){let i=e.get(ce());t==null&&i!=null&&(t=Qn(i,ce()));let s=[];return e.children.inorderTraversal((o,l)=>{let u=t?t.getImmediateChild(o):null,c=KI(r,o),d=n.operationForChild(o);d&&(s=s.concat(nT(d,l,u,c)))}),i&&(s=s.concat(kp(i,n,r,t))),s}function rT(n,e){let t=e.query,r=Mo(n,t);return{hashFn:()=>(Sb(e)||H.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?qb(n,t._path,r):Ub(n,t._path);{let s=nC(i,t);return Bu(n,t,null,s)}}}}function Mo(n,e){let t=ec(e);return n.queryToTagMap.get(t)}function ec(n){return n._path.toString()+"$"+n._queryIdentifier}function Mp(n,e){return n.tagToQueryMap.get(e)}function Op(n){let e=n.indexOf("$");return M(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new he(n.substr(0,e))}}function Fp(n,e,t){let r=n.syncPointTree_.get(e);M(r,"Missing sync point for query tag that we're tracking");let i=Ju(n.pendingWriteTree_,e);return kp(r,t,i,null)}function jb(n){return n.fold((e,t,r)=>{if(t&&Yn(t))return[Xu(t)];{let i=[];return t&&(i=JI(t)),ze(r,(s,o)=>{i=i.concat(o)}),i}})}function Ao(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Mb())(n._repo,n._path):n}function zb(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=ec(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function Kb(){return Ob++}function Wb(n,e,t){let r=e._path,i=Mo(n,e),s=rT(n,t),o=n.listenProvider_.startListening(Ao(e),i,s.hashFn,s.onComplete),l=n.syncPointTree_.subtree(r);if(i)M(!Yn(l.value),"If we're adding a query, it shouldn't be shadowed");else{let u=l.fold((c,d,m)=>{if(!ee(c)&&d&&Yn(d))return[Xu(d).query];{let p=[];return d&&(p=p.concat(JI(d).map(y=>y.query))),ze(m,(y,A)=>{p=p.concat(A)}),p}});for(let c=0;c<u.length;++c){let d=u[c];n.listenProvider_.stopListening(Ao(d),Mo(n,d))}}return o}var ep=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},tp=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=Te(this.path_,e);return new n(this.syncTree_,t)}node(){return Zu(this.syncTree_,this.path_)}},Qb=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},aI=function(n,e,t){if(!n||typeof n!="object")return n;if(M(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return $b(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Hb(n[".sv"],e);M(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},$b=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:M(!1,"Unexpected server value: "+n)}},Hb=function(n,e,t){n.hasOwnProperty("increment")||M(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&M(!1,"Unexpected increment value: "+r);let i=e.node();if(M(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},iT=function(n,e,t,r){return Up(e,new tp(t,n),r)},Lp=function(n,e,t){return Up(n,new ep(e),t)};function Up(n,e,t){let r=n.getPriority().val(),i=aI(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,l=aI(o.getValue(),e,t);return l!==o.getValue()||i!==o.getPriority().val()?new Bi(l,Ae(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Bi(i))),o.forEachChild(ye,(l,u)=>{let c=Up(u,e.getImmediateChild(l),t);c!==u&&(s=s.updateImmediateChild(l,c))}),s}}var Oo=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function tc(n,e){let t=e instanceof he?e:new he(e),r=n,i=Z(t);for(;i!==null;){let s=Tn(r.node.children,i)||{children:{},childCount:0};r=new Oo(i,r,s),t=ge(t),i=Z(t)}return r}function Fr(n){return n.node.value}function qp(n,e){n.node.value=e,np(n)}function sT(n){return n.node.childCount>0}function Yb(n){return Fr(n)===void 0&&!sT(n)}function nc(n,e){ze(n.node.children,(t,r)=>{e(new Oo(t,n,r))})}function oT(n,e,t,r){t&&!r&&e(n),nc(n,i=>{oT(i,e,!0,r)}),t&&r&&e(n)}function Jb(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function zo(n){return new he(n.parent===null?n.name:zo(n.parent)+"/"+n.name)}function np(n){n.parent!==null&&Xb(n.parent,n.name,n)}function Xb(n,e,t){let r=Yb(t),i=wt(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,np(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,np(n))}var Zb=/[\[\].#$\/\u0000-\u001F\u007F]/,eR=/[\[\].#$\u0000-\u001F\u007F]/,fm=10*1024*1024,rc=function(n){return typeof n=="string"&&n.length!==0&&!Zb.test(n)},aT=function(n){return typeof n=="string"&&n.length!==0&&!eR.test(n)},tR=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),aT(n)},Fo=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!$u(n)||n&&typeof n=="object"&&wt(n,".sv")},Zt=function(n,e,t,r){r&&e===void 0||Ko(ct(n,"value"),e,t)},Ko=function(n,e,t){let r=t instanceof he?new Cm(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Nr(r));if(typeof e=="function")throw new Error(n+"contains a function "+Nr(r)+" with contents = "+e.toString());if($u(e))throw new Error(n+"contains "+e.toString()+" "+Nr(r));if(typeof e=="string"&&e.length>fm/3&&As(e)>fm)throw new Error(n+"contains a string greater than "+fm+" utf8 bytes "+Nr(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(ze(e,(o,l)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!rc(o)))throw new Error(n+" contains an invalid key ("+o+") "+Nr(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);NC(r,o),Ko(n,l,r),DC(r)}),i&&s)throw new Error(n+' contains ".value" child '+Nr(r)+" in addition to actual children.")}},nR=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=bo(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!rc(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(xC);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&Ct(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},lT=function(n,e,t,r){if(r&&e===void 0)return;let i=ct(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];ze(e,(o,l)=>{let u=new he(o);if(Ko(i,l,Te(t,u)),Tp(u)===".priority"&&!Fo(l))throw new Error(i+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(u)}),nR(i,s)},Bp=function(n,e,t){if(!(t&&e===void 0)){if($u(e))throw new Error(ct(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Fo(e))throw new Error(ct(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Wo=function(n,e,t,r){if(!(r&&t===void 0)&&!rc(t))throw new Error(ct(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Ji=function(n,e,t,r){if(!(r&&t===void 0)&&!aT(t))throw new Error(ct(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},rR=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ji(n,e,t,r)},gt=function(n,e){if(Z(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},uT=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!rc(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!tR(t))throw new Error(ct(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var rp=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function ic(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!Sp(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function cT(n,e,t){ic(n,t),hT(n,r=>Sp(r,e))}function _t(n,e,t){ic(n,t),hT(n,r=>Ct(r,e)||Ct(e,r))}function hT(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(iR(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function iR(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();kr&&je("event: "+t.toString()),$i(r)}}}var dT="repo_interrupt",sR=25,ip=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rp,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Nu(),this.transactionQueueTree_=new Oo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function oR(n,e,t){if(n.stats_=Ip(n.repoInfo_),n.forceRestClient_||oC())n.server_=new Fm(n.repoInfo_,(r,i,s,o)=>{lI(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>uI(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{De(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Ap(n.repoInfo_,e,(r,i,s,o)=>{lI(n,r,i,s,o)},r=>{uI(n,r)},r=>{aR(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=lC(n.repoInfo_,()=>new Gm(n.stats_,n.server_)),n.infoData_=new Lm,n.infoSyncTree_=new qu({startListening:(r,i,s,o)=>{let l=[],u=n.infoData_.getNode(r._path);return u.isEmpty()||(l=jo(n.infoSyncTree_,r._path,u),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),Gp(n,"connected",!1),n.serverSyncTree_=new qu({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(l,u)=>{let c=o(l,u);_t(n.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function fT(n){let t=n.infoData_.getNode(new he(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Qo(n){return Qb({timestamp:fT(n)})}function lI(n,e,t,r,i){n.dataUpdateCount++;let s=new he(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let u=Ss(t,c=>Ae(c));o=Bb(n.serverSyncTree_,s,u,i)}else{let u=Ae(t);o=eT(n.serverSyncTree_,s,u,i)}else if(r){let u=Ss(t,c=>Ae(c));o=Lb(n.serverSyncTree_,s,u)}else{let u=Ae(t);o=jo(n.serverSyncTree_,s,u)}let l=s;o.length>0&&(l=Wi(n,s)),_t(n.eventQueue_,l,o)}function uI(n,e){Gp(n,"connected",e),e===!1&&cR(n)}function aR(n,e){ze(e,(t,r)=>{Gp(n,t,r)})}function Gp(n,e,t){let r=new he("/.info/"+e),i=Ae(t);n.infoData_.updateSnapshot(r,i);let s=jo(n.infoSyncTree_,r,i);_t(n.eventQueue_,r,s)}function sc(n){return n.nextWriteId_++}function lR(n,e,t){let r=Gb(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=Ae(i).withIndex(e._queryParams.getIndex());Zm(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=jo(n.serverSyncTree_,e._path,s);else{let l=Mo(n.serverSyncTree_,e);o=eT(n.serverSyncTree_,e._path,s,l)}return _t(n.eventQueue_,e._path,o),Bu(n.serverSyncTree_,e,t,null,!0),s},i=>(Xi(n,"get for query "+De(e)+" failed: "+i),Promise.reject(new Error(i))))}function jp(n,e,t,r,i){Xi(n,"set",{path:e.toString(),value:t,priority:r});let s=Qo(n),o=Ae(t,r),l=Zu(n.serverSyncTree_,e),u=Lp(o,l,s),c=sc(n),d=Vp(n.serverSyncTree_,e,u,c,!0);ic(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(p,y)=>{let A=p==="ok";A||et("set at "+e+" failed: "+p);let x=Kn(n.serverSyncTree_,c,!A);_t(n.eventQueue_,e,x),Jn(n,i,p,y)});let m=Kp(n,e);Wi(n,m),_t(n.eventQueue_,m,[])}function uR(n,e,t,r){Xi(n,"update",{path:e.toString(),value:t});let i=!0,s=Qo(n),o={};if(ze(t,(l,u)=>{i=!1,o[l]=iT(Te(e,l),Ae(u),n.serverSyncTree_,s)}),i)je("update() called with empty data.  Don't do anything."),Jn(n,r,"ok",void 0);else{let l=sc(n),u=Fb(n.serverSyncTree_,e,o,l);ic(n.eventQueue_,u),n.server_.merge(e.toString(),t,(c,d)=>{let m=c==="ok";m||et("update at "+e+" failed: "+c);let p=Kn(n.serverSyncTree_,l,!m),y=p.length>0?Wi(n,e):e;_t(n.eventQueue_,y,p),Jn(n,r,c,d)}),ze(t,c=>{let d=Kp(n,Te(e,c));Wi(n,d)}),_t(n.eventQueue_,e,[])}}function cR(n){Xi(n,"onDisconnectEvents");let e=Qo(n),t=Nu();qm(n.onDisconnect_,ce(),(i,s)=>{let o=iT(i,s,n.serverSyncTree_,e);Hi(t,i,o)});let r=[];qm(t,ce(),(i,s)=>{r=r.concat(jo(n.serverSyncTree_,i,s));let o=Kp(n,i);Wi(n,o)}),n.onDisconnect_=Nu(),_t(n.eventQueue_,ce(),r)}function hR(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&Um(n.onDisconnect_,e),Jn(n,t,r,i)})}function cI(n,e,t,r){let i=Ae(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Hi(n.onDisconnect_,e,i),Jn(n,r,s,o)})}function dR(n,e,t,r,i){let s=Ae(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,l)=>{o==="ok"&&Hi(n.onDisconnect_,e,s),Jn(n,i,o,l)})}function fR(n,e,t,r){if(Pa(t)){je("onDisconnect().update() called with empty data.  Don't do anything."),Jn(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&ze(t,(o,l)=>{let u=Ae(l);Hi(n.onDisconnect_,Te(e,o),u)}),Jn(n,r,i,s)})}function mR(n,e,t){let r;Z(e._path)===".info"?r=Zm(n.infoSyncTree_,e,t):r=Zm(n.serverSyncTree_,e,t),cT(n.eventQueue_,e._path,r)}function sp(n,e,t){let r;Z(e._path)===".info"?r=Bu(n.infoSyncTree_,e,t):r=Bu(n.serverSyncTree_,e,t),cT(n.eventQueue_,e._path,r)}function mT(n){n.persistentConnection_&&n.persistentConnection_.interrupt(dT)}function pR(n){n.persistentConnection_&&n.persistentConnection_.resume(dT)}function Xi(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),je(t,...e)}function Jn(n,e,t,r){e&&$i(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function gR(n,e,t,r,i,s){Xi(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:fI(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=zp(n,e,void 0);o.currentInputSnapshot=l;let u=o.update(l.val());if(u===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Ko("transaction failed: Data returned ",u,o.path),o.status=0;let c=tc(n.transactionQueueTree_,e),d=Fr(c)||[];d.push(o),qp(c,d);let m;typeof u=="object"&&u!==null&&wt(u,".priority")?(m=Tn(u,".priority"),M(Fo(m),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):m=(Zu(n.serverSyncTree_,e)||H.EMPTY_NODE).getPriority().val();let p=Qo(n),y=Ae(u,m),A=Lp(y,l,p);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=A,o.currentWriteId=sc(n);let x=Vp(n.serverSyncTree_,e,A,o.currentWriteId,o.applyLocally);_t(n.eventQueue_,e,x),oc(n,n.transactionQueueTree_)}}function zp(n,e,t){return Zu(n.serverSyncTree_,e,t)||H.EMPTY_NODE}function oc(n,e=n.transactionQueueTree_){if(e||ac(n,e),Fr(e)){let t=gT(n,e);M(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&_R(n,zo(e),t)}else sT(e)&&nc(e,t=>{oc(n,t)})}function _R(n,e,t){let r=t.map(c=>c.currentWriteId),i=zp(n,e,r),s=i,o=i.hash();for(let c=0;c<t.length;c++){let d=t[c];M(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let m=at(e,d.path);s=s.updateChild(m,d.currentOutputSnapshotRaw)}let l=s.val(!0),u=e;n.server_.put(u.toString(),l,c=>{Xi(n,"transaction put response",{path:u.toString(),status:c});let d=[];if(c==="ok"){let m=[];for(let p=0;p<t.length;p++)t[p].status=2,d=d.concat(Kn(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&m.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();ac(n,tc(n.transactionQueueTree_,e)),oc(n,n.transactionQueueTree_),_t(n.eventQueue_,e,d);for(let p=0;p<m.length;p++)$i(m[p])}else{if(c==="datastale")for(let m=0;m<t.length;m++)t[m].status===3?t[m].status=4:t[m].status=0;else{et("transaction at "+u.toString()+" failed: "+c);for(let m=0;m<t.length;m++)t[m].status=4,t[m].abortReason=c}Wi(n,e)}},o)}function Wi(n,e){let t=pT(n,e),r=zo(t),i=gT(n,t);return yR(n,i,r),r}function yR(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){let u=e[l],c=at(t,u.path),d=!1,m;if(M(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)d=!0,m=u.abortReason,i=i.concat(Kn(n.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=sR)d=!0,m="maxretry",i=i.concat(Kn(n.serverSyncTree_,u.currentWriteId,!0));else{let p=zp(n,u.path,o);u.currentInputSnapshot=p;let y=e[l].update(p.val());if(y!==void 0){Ko("transaction failed: Data returned ",y,u.path);let A=Ae(y);typeof y=="object"&&y!=null&&wt(y,".priority")||(A=A.updatePriority(p.getPriority()));let D=u.currentWriteId,B=Qo(n),j=Lp(A,p,B);u.currentOutputSnapshotRaw=A,u.currentOutputSnapshotResolved=j,u.currentWriteId=sc(n),o.splice(o.indexOf(D),1),i=i.concat(Vp(n.serverSyncTree_,u.path,j,u.currentWriteId,u.applyLocally)),i=i.concat(Kn(n.serverSyncTree_,D,!0))}else d=!0,m="nodata",i=i.concat(Kn(n.serverSyncTree_,u.currentWriteId,!0))}_t(n.eventQueue_,t,i),i=[],d&&(e[l].status=2,function(p){setTimeout(p,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(m==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(m),!1,null))))}ac(n,n.transactionQueueTree_);for(let l=0;l<r.length;l++)$i(r[l]);oc(n,n.transactionQueueTree_)}function pT(n,e){let t,r=n.transactionQueueTree_;for(t=Z(e);t!==null&&Fr(r)===void 0;)r=tc(r,t),e=ge(e),t=Z(e);return r}function gT(n,e){let t=[];return _T(n,e,t),t.sort((r,i)=>r.order-i.order),t}function _T(n,e,t){let r=Fr(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);nc(e,i=>{_T(n,i,t)})}function ac(n,e){let t=Fr(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,qp(e,t.length>0?t:void 0)}nc(e,r=>{ac(n,r)})}function Kp(n,e){let t=zo(pT(n,e)),r=tc(n.transactionQueueTree_,e);return Jb(r,i=>{mm(n,i)}),mm(n,r),oT(r,i=>{mm(n,i)}),t}function mm(n,e){let t=Fr(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(M(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(M(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Kn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?qp(e,void 0):t.length=s+1,_t(n.eventQueue_,zo(e),i);for(let o=0;o<r.length;o++)$i(r[o])}}function vR(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function wR(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):et(`Invalid query segment '${t}' in query '${n}'`)}return e}var op=function(n,e){let t=ER(n),r=t.namespace;t.domain==="firebase.com"&&Jt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Jt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||JA();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Tu(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new he(t.pathString)}},ER=function(n){let e="",t="",r="",i="",s="",o=!0,l="https",u=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(l=n.substring(0,c-1),n=n.substring(c+2));let d=n.indexOf("/");d===-1&&(d=n.length);let m=n.indexOf("?");m===-1&&(m=n.length),e=n.substring(0,Math.min(d,m)),d<m&&(i=vR(n.substring(d,m)));let p=wR(n.substring(Math.min(n.length,m)));c=e.indexOf(":"),c>=0?(o=l==="https"||l==="wss",u=parseInt(e.substring(c+1),10)):c=e.length;let y=e.slice(0,c);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let A=e.indexOf(".");r=e.substring(0,A).toLowerCase(),t=e.substring(A+1),s=r}"ns"in p&&(s=p.ns)}return{host:e,port:u,domain:t,subdomain:r,secure:o,scheme:l,pathString:i,namespace:s}};var hI="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",IR=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=hI.charAt(t%64),t=Math.floor(t/64);M(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=hI.charAt(e[i]);return M(o.length===20,"nextPushId: Length should be 20."),o}}();var Gu=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+De(this.snapshot.exportVal())}},ju=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Lo=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return M(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var zu=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new rt;return hR(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){gt("OnDisconnect.remove",this._path);let e=new rt;return cI(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){gt("OnDisconnect.set",this._path),Zt("OnDisconnect.set",e,this._path,!1);let t=new rt;return cI(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){gt("OnDisconnect.setWithPriority",this._path),Zt("OnDisconnect.setWithPriority",e,this._path,!1),Bp("OnDisconnect.setWithPriority",t,!1);let r=new rt;return dR(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){gt("OnDisconnect.update",this._path),lT("OnDisconnect.update",e,this._path,!1);let t=new rt;return fR(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var ut=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ee(this._path)?null:Tp(this._path)}get ref(){return new yt(this._repo,this._path)}get _queryIdentifier(){let e=JE(this._queryParams),t=Ep(e);return t==="{}"?"default":t}get _queryObject(){return JE(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=Sp(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+PC(this._path)}};function lc(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Zn(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Yt){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==$n)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==mn)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===ye){if(e!=null&&!Fo(e)||t!=null&&!Fo(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(M(n.getIndex()instanceof Ro||n.getIndex()===bp,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function uc(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var yt=class n extends ut{constructor(e,t){super(e,t,new Do,!1)}get parent(){let e=VI(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Qi=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new he(e),r=Xn(this.ref,e);return new n(this._node.getChild(t),r,ye)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,Xn(this.ref,r),ye)))}hasChild(e){let t=new he(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Wp(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?Xn(n._root,e):n._root}function Qp(n,e){n=ne(n),n._checkNotDeleted("refFromURL");let t=op(e,n._repo.repoInfo_.nodeAdmin);uT("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Jt("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Wp(n,t.path.toString())}function Xn(n,e){return n=ne(n),Z(n._path)===null?rR("child","path",e,!1):Ji("child","path",e,!1),new yt(n._repo,Te(n._path,e))}function yT(n,e){n=ne(n),gt("push",n._path),Zt("push",e,n._path,!0);let t=fT(n._repo),r=IR(t),i=Xn(n,r),s=Xn(n,r),o;return e!=null?o=cc(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function vT(n){return gt("remove",n._path),cc(n,null)}function cc(n,e){n=ne(n),gt("set",n._path),Zt("set",e,n._path,!1);let t=new rt;return jp(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function wT(n,e){n=ne(n),gt("setPriority",n._path),Bp("setPriority",e,!1);let t=new rt;return jp(n._repo,Te(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function ET(n,e,t){if(gt("setWithPriority",n._path),Zt("setWithPriority",e,n._path,!1),Bp("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new rt;return jp(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function IT(n,e){lT("update",e,n._path,!1);let t=new rt;return uR(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function TT(n){n=ne(n);let e=new Lo(()=>{}),t=new Uo(e);return lR(n._repo,n,t).then(r=>new Qi(r,new yt(n._repo,n._path),n._queryParams.getIndex()))}var Uo=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new Gu("value",this,new Qi(e.snapshotNode,new yt(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ju(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Ku=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ju(this,e,t):null}createEvent(e,t){M(e.childName!=null,"Child events should have a childName.");let r=Xn(new yt(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Gu(e.type,this,new Qi(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function $o(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let u=t,c=(d,m)=>{sp(n._repo,n,l),u(d,m)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new Lo(t,s||void 0),l=e==="value"?new Uo(o):new Ku(e,o);return mR(n._repo,n,l),()=>sp(n._repo,n,l)}function hc(n,e,t,r){return $o(n,"value",e,t,r)}function $p(n,e,t,r){return $o(n,"child_added",e,t,r)}function Hp(n,e,t,r){return $o(n,"child_changed",e,t,r)}function Yp(n,e,t,r){return $o(n,"child_moved",e,t,r)}function Jp(n,e,t,r){return $o(n,"child_removed",e,t,r)}function Xp(n,e,t){let r=null,i=t?new Lo(t):null;e==="value"?r=new Uo(i):e&&(r=new Ku(e,i)),sp(n._repo,n,r)}var vt=class{},Wu=class extends vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Zt("endAt",this._value,e._path,!0);let t=Om(e._queryParams,this._value,this._key);if(uc(t),Zn(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function ST(n,e){return Wo("endAt","key",e,!0),new Wu(n,e)}var ap=class extends vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Zt("endBefore",this._value,e._path,!1);let t=$C(e._queryParams,this._value,this._key);if(uc(t),Zn(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function AT(n,e){return Wo("endBefore","key",e,!0),new ap(n,e)}var Qu=class extends vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Zt("startAt",this._value,e._path,!0);let t=Mm(e._queryParams,this._value,this._key);if(uc(t),Zn(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function CT(n=null,e){return Wo("startAt","key",e,!0),new Qu(n,e)}var lp=class extends vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Zt("startAfter",this._value,e._path,!1);let t=QC(e._queryParams,this._value,this._key);if(uc(t),Zn(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function bT(n,e){return Wo("startAfter","key",e,!0),new lp(n,e)}var up=class extends vt{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new ut(e._repo,e._path,KC(e._queryParams,this._limit),e._orderByCalled)}};function RT(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new up(n)}var cp=class extends vt{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new ut(e._repo,e._path,WC(e._queryParams,this._limit),e._orderByCalled)}};function PT(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new cp(n)}var hp=class extends vt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){lc(e,"orderByChild");let t=new he(this._path);if(ee(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Ro(t),i=Hu(e._queryParams,r);return Zn(i),new ut(e._repo,e._path,i,!0)}};function xT(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ji("orderByChild","path",n,!1),new hp(n)}var dp=class extends vt{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){lc(e,"orderByKey");let t=Hu(e._queryParams,Yt);return Zn(t),new ut(e._repo,e._path,t,!0)}};function NT(){return new dp}var fp=class extends vt{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){lc(e,"orderByPriority");let t=Hu(e._queryParams,ye);return Zn(t),new ut(e._repo,e._path,t,!0)}};function DT(){return new fp}var mp=class extends vt{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){lc(e,"orderByValue");let t=Hu(e._queryParams,bp);return Zn(t),new ut(e._repo,e._path,t,!0)}};function kT(){return new mp}var pp=class extends vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Zt("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Wu(this._value,this._key)._apply(new Qu(this._value,this._key)._apply(e))}};function VT(n,e){return Wo("equalTo","key",e,!0),new pp(n,e)}function Rt(n,...e){let t=ne(n);for(let r of e)t=r._apply(t);return t}Pb(yt);Vb(yt);var TR="FIREBASE_DATABASE_EMULATOR_HOST",gp={},SR=!1;function AR(n,e,t,r){n.repoInfo_=new Tu(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function Zp(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||Jt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),je("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=op(s,i),l=o.repoInfo,u,c;typeof process<"u"&&process.env&&(c=process.env[TR]),c?(u=!0,s=`http://${c}?ns=${l.namespace}`,o=op(s,i),l=o.repoInfo):u=!o.repoInfo.secure;let d=i&&u?new Io(Io.OWNER):new wm(n.name,n.options,e);uT("Invalid Firebase Database URL",o),ee(o.path)||Jt("Database URL must point to the root of a Firebase Database (not including a child path).");let m=bR(l,n,d,new vm(n.name,t));return new _p(m,n)}function CR(n,e){let t=gp[e];(!t||t[n.key]!==n)&&Jt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),mT(n),delete t[n.key]}function bR(n,e,t,r){let i=gp[e.name];i||(i={},gp[e.name]=i);let s=i[n.toURLString()];return s&&Jt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new ip(n,SR,t,r),i[n.toURLString()]=s,s}var _p=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(oR(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new yt(this._repo,ce())),this._rootInternal}_delete(){return this._rootInternal!==null&&(CR(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Jt("Cannot call "+e+" on a deleted database.")}};function MT(){kI.IS_TRANSPORT_INITIALIZED&&et("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function OT(){MT(),Co.forceDisallow()}function FT(){MT(),Fi.forceDisallow(),Co.forceAllow()}function LT(n,e,t,r={}){n=ne(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Jt("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Jt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Io(Io.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:ba(r.mockUserToken,n.app.options.projectId);s=new Io(o)}AR(i,e,t,s)}function UT(n){n=ne(n),n._checkNotDeleted("goOffline"),mT(n._repo)}function qT(n){n=ne(n),n._checkNotDeleted("goOnline"),pR(n._repo)}function BT(n,e){pI(n,e)}function RR(n){wp(Da),Na(new Lt("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Zp(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),$r(VE,ME,n),$r(VE,ME,"esm2017")}var PR={".sv":"timestamp"};function GT(){return PR}function jT(n){return{".sv":{increment:n}}}var yp=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function zT(n,e,t){var r;if(n=ne(n),gt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new rt,o=(u,c,d)=>{let m=null;u?s.reject(u):(m=new Qi(d,new yt(n._repo,n._path),ye),s.resolve(new yp(c,m)))},l=hc(n,()=>{});return gR(n._repo,n._path,e,o,l,i),s.promise}Ap.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ap.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};RR();var xR="@firebase/database-compat",NR="1.0.7";var DR=new Qr("@firebase/database-compat"),KT=function(n){let e="FIREBASE WARNING: "+n;DR.warn(e)};var kR=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(ct(n,e)+"must be a boolean.")},VR=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ct(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var eg=class{constructor(e){this._delegate=e}cancel(e){K("OnDisconnect.cancel",0,1,arguments.length),Le("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){K("OnDisconnect.remove",0,1,arguments.length),Le("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){K("OnDisconnect.set",1,2,arguments.length),Le("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){K("OnDisconnect.setWithPriority",2,3,arguments.length),Le("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(K("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,KT("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Le("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var tg=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return K("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Lr=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return K("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return K("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return K("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return K("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return K("DataSnapshot.child",0,1,arguments.length),e=String(e),Ji("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return K("DataSnapshot.hasChild",1,1,arguments.length),Ji("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return K("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return K("DataSnapshot.forEach",1,1,arguments.length),Le("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return K("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return K("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return K("DataSnapshot.ref",0,0,arguments.length),new pn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},dc=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;K("Query.on",2,4,arguments.length),Le("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),l=(c,d)=>{t.call(o.context,new Lr(this.database,c),d)};l.userCallback=t,l.context=o.context;let u=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return hc(this._delegate,l,u),t;case"child_added":return $p(this._delegate,l,u),t;case"child_removed":return Jp(this._delegate,l,u),t;case"child_changed":return Hp(this._delegate,l,u),t;case"child_moved":return Yp(this._delegate,l,u),t;default:throw new Error(ct("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(K("Query.off",0,3,arguments.length),VR("Query.off",e,!0),Le("Query.off","callback",t,!0),Jc("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,Xp(this._delegate,e,i)}else Xp(this._delegate,e)}get(){return TT(this._delegate).then(e=>new Lr(this.database,e))}once(e,t,r,i){K("Query.once",1,4,arguments.length),Le("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new rt,l=(c,d)=>{let m=new Lr(this.database,c);t&&t.call(s.context,m,d),o.resolve(m)};l.userCallback=t,l.context=s.context;let u=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":hc(this._delegate,l,u,{onlyOnce:!0});break;case"child_added":$p(this._delegate,l,u,{onlyOnce:!0});break;case"child_removed":Jp(this._delegate,l,u,{onlyOnce:!0});break;case"child_changed":Hp(this._delegate,l,u,{onlyOnce:!0});break;case"child_moved":Yp(this._delegate,l,u,{onlyOnce:!0});break;default:throw new Error(ct("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return K("Query.limitToFirst",1,1,arguments.length),new n(this.database,Rt(this._delegate,RT(e)))}limitToLast(e){return K("Query.limitToLast",1,1,arguments.length),new n(this.database,Rt(this._delegate,PT(e)))}orderByChild(e){return K("Query.orderByChild",1,1,arguments.length),new n(this.database,Rt(this._delegate,xT(e)))}orderByKey(){return K("Query.orderByKey",0,0,arguments.length),new n(this.database,Rt(this._delegate,NT()))}orderByPriority(){return K("Query.orderByPriority",0,0,arguments.length),new n(this.database,Rt(this._delegate,DT()))}orderByValue(){return K("Query.orderByValue",0,0,arguments.length),new n(this.database,Rt(this._delegate,kT()))}startAt(e=null,t){return K("Query.startAt",0,2,arguments.length),new n(this.database,Rt(this._delegate,CT(e,t)))}startAfter(e=null,t){return K("Query.startAfter",0,2,arguments.length),new n(this.database,Rt(this._delegate,bT(e,t)))}endAt(e=null,t){return K("Query.endAt",0,2,arguments.length),new n(this.database,Rt(this._delegate,ST(e,t)))}endBefore(e=null,t){return K("Query.endBefore",0,2,arguments.length),new n(this.database,Rt(this._delegate,AT(e,t)))}equalTo(e,t){return K("Query.equalTo",1,2,arguments.length),new n(this.database,Rt(this._delegate,VT(e,t)))}toString(){return K("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return K("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(K("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,Le(e,"cancel",i.cancel,!0),i.context=r,Jc(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(ct(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new pn(this.database,new yt(this._delegate._repo,this._delegate._path))}},pn=class n extends dc{constructor(e,t){super(e,new ut(t._repo,t._path,new Do,!1)),this.database=e,this._delegate=t}getKey(){return K("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return K("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Xn(this._delegate,e))}getParent(){K("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return K("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){K("Reference.set",1,2,arguments.length),Le("Reference.set","onComplete",t,!0);let r=cc(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(K("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,KT("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}gt("Reference.update",this._delegate._path),Le("Reference.update","onComplete",t,!0);let r=IT(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){K("Reference.setWithPriority",2,3,arguments.length),Le("Reference.setWithPriority","onComplete",r,!0);let i=ET(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){K("Reference.remove",0,1,arguments.length),Le("Reference.remove","onComplete",e,!0);let t=vT(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){K("Reference.transaction",1,3,arguments.length),Le("Reference.transaction","transactionUpdate",e,!1),Le("Reference.transaction","onComplete",t,!0),kR("Reference.transaction","applyLocally",r,!0);let i=zT(this._delegate,e,{applyLocally:r}).then(s=>new tg(s.committed,new Lr(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){K("Reference.setPriority",1,2,arguments.length),Le("Reference.setPriority","onComplete",t,!0);let r=wT(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){K("Reference.push",0,2,arguments.length),Le("Reference.push","onComplete",t,!0);let r=yT(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return gt("Reference.onDisconnect",this._delegate._path),new eg(new zu(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Ur=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:OT,forceLongPolling:FT}}useEmulator(e,t,r={}){LT(this._delegate,e,t,r)}ref(e){if(K("database.ref",0,1,arguments.length),e instanceof pn){let t=Qp(this._delegate,e.toString());return new pn(this,t)}else{let t=Wp(this._delegate,e);return new pn(this,t)}}refFromURL(e){K("database.refFromURL",1,1,arguments.length);let r=Qp(this._delegate,e);return new pn(this,r)}goOffline(){return K("database.goOffline",0,0,arguments.length),UT(this._delegate)}goOnline(){return K("database.goOnline",0,0,arguments.length),qT(this._delegate)}};Ur.ServerValue={TIMESTAMP:GT(),increment:n=>jT(n)};function MR({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){wp(t);let l=new Xc("database-standalone"),u=new xa("auth-internal",l);u.setComponent(new Lt("auth-internal",()=>r,"PRIVATE"));let c;return i&&(c=new xa("app-check-internal",l),c.setComponent(new Lt("app-check-internal",()=>i,"PRIVATE"))),{instance:new Ur(Zp(n,u,c,e,o),n),namespace:s}}var OR=Object.freeze({__proto__:null,initStandalone:MR});var FR=Ur.ServerValue;function LR(n){n.INTERNAL.registerComponent(new Lt("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Ur(i,r)},"PUBLIC").setServiceProps({Reference:pn,Query:dc,Database:Ur,DataSnapshot:Lr,enableLogging:BT,INTERNAL:OR,ServerValue:FR}).setMultipleInstances(!0)),n.registerVersion(xR,NR)}LR(Sn);function Ho(n,e,t="on",r=ma){return new fa(i=>{let s=null;return s=n[t](e,(o,l)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:l})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Ge(i=>{let{snapshot:s,prevKey:o}=i,l=null;return s.exists()&&(l=s.key),{type:e,payload:s,prevKey:o,key:l}}),r_())}function UR(n){return typeof n=="string"}function qR(n){return typeof n.exportVal=="function"}function YT(n){return n==null}function JT(n){return typeof n.set=="function"}function WT(n,e){return JT(e)?e:n.ref(e)}function XT(n,e){if(UR(n))return e.stringCase();if(JT(n))return e.firebaseCase();if(qR(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function ZT(n){return(YT(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function e0(n,e,t){e=ZT(e);let r=e.map(i=>Ho(n,i,"on",t));return Bc(...r)}function BR(n,e,t){let r=e0(n,e).pipe(ir((i,s)=>[...i,s],[]));return jR(n,r,t)}function GR(n,e){return Ho(n,"value","on",e).pipe(Ge(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function jR(n,e,t){return GR(n,t).pipe(o_(e),Ge(([i,s])=>{let o=i.lastKeyToLoad,l=s.map(u=>u.key);return{actions:s,lastKeyToLoad:o,loadedKeys:l}}),i_(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Ge(i=>i.actions))}function QT(n,e){return function(r,i){return XT(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function zR(n){return function(t){return t?XT(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function KR(n,e,t){return Ho(n,"value","once",t).pipe(s_(r=>{let i=[ws(r)];return e.forEach(s=>i.push(Ho(n,s,"on",t))),Bc(...i).pipe(ir(QR,[]))}),pa())}function t0(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function WR(n,e){if(YT(e))return 0;{let t=t0(n,e);return t===-1?n.length:t+1}}function QR(n,e){let{payload:t,prevKey:r,key:i}=e,s=t0(n,i),o=WR(n,r);switch(e.type){case"value":if(e.payload?.exists()){let l=null;e.payload.forEach(u=>{let c={payload:u,type:"value",prevKey:l,key:u.key};return l=u.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(u=>u.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(l=>l.payload.key!==t.key);case"child_changed":return n.map(l=>l.payload.key===i?e:l);case"child_moved":if(s>-1){let l=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,l),n}return n;default:return n}}function $T(n,e,t){return e=ZT(e),KR(n,e,t)}function $R(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:QT(r,"update"),set:QT(r,"set"),push:i=>r.push(i),remove:zR(r),snapshotChanges(i){return $T(n,i,t).pipe(Ue)},stateChanges(i){return e0(n,i,t).pipe(Ue)},auditTrail(i){return BR(n,i,t).pipe(Ue)},valueChanges(i,s){return $T(n,i,t).pipe(Ge(l=>l.map(u=>s&&s.idField?ys(zr({},u.payload.val()),{[s.idField]:u.key}):u.payload.val())),Ue)}}}function HT(n,e){return function(){return Ho(n,"value","on",e)}}function HR(n,e){return{query:n,snapshotChanges(){return HT(n,e.schedulers.outsideAngular)().pipe(Ue)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return HT(n,e.schedulers.outsideAngular)().pipe(Ue,Ge(r=>r.payload.exists()?r.payload.val():null))}}}var YR=new wn("angularfire2.realtimeDatabaseURL"),JR=new wn("angularfire2.database.use-emulator"),XR=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,l,u,c,d,m,p,y,A,x,D){this.schedulers=l;let B=u,j=La(t,o,r);c&&Qa(j,o,d,p,y,A,m,x),this.database=qa(`${j.name}.database.${i}`,"AngularFireDatabase",j.name,()=>{let q=o.runOutsideAngular(()=>j.database(i||void 0));return B&&q.useEmulator(...B),q},[B])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>WT(this.database,t)),s=i;return r&&(s=r(i)),$R(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>WT(this.database,t));return HR(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(se(Oa),se(Fa,8),se(YR,8),se(wa),se(Ea),se(Ma),se(JR,8),se($a,8),se(Ba,8),se(Ga,8),se(ja,8),se(za,8),se(Ka,8),se(Wa,8),se(Va,8))};static \u0275prov=Kr({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),fc=(()=>{class n{constructor(){Sn.registerVersion("angularfire",ka.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=va({type:n});static \u0275inj=ya({providers:[XR]})}return n})();var mc=(()=>{let e=class e{constructor(){Ua.initializeApp(x_.firebase)}getFirestore(){return wu}getDatabase(){return fc}getAuth(){return Ha}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Kr({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function eP(n,e){if(n&1&&(W(0,"p",20),me(1),X()),n&2){let t=In(2);ft(),Qc(" ",t.errorMessage,"")}}function tP(n,e){if(n&1&&(W(0,"p",20),me(1),X()),n&2){let t=In(2);ft(),Qc(" ",t._error.message," ")}}function nP(n,e){if(n&1&&(W(0,"form",19),Ia(1,eP,2,1,"p",20)(2,tP,2,1,"p",20),W(3,"div",21)(4,"h4",22),me(5,"Sign In"),X(),W(6,"p"),me(7,"Sign in to your account to continue."),X()(),W(8,"div",23)(9,"div",24)(10,"div",25)(11,"label",26),me(12,"Email"),W(13,"span",27),me(14,"*"),X()(),We(15,"input",28),X()(),W(16,"div",24)(17,"div",25)(18,"label",26),me(19,"Password"),W(20,"span",27),me(21,"*"),X()(),W(22,"div"),We(23,"input",29),X()()(),W(24,"div",30)(25,"div",31)(26,"div",32),We(27,"input",33),W(28,"label",34),me(29," Remember me "),X()(),W(30,"div",35)(31,"a",36),me(32,"Forgot Password?"),X()()(),W(33,"div",37)(34,"button",38),me(35," Login"),X()(),W(36,"div",39)(37,"p",40),me(38,"Don't have an account yet? "),W(39,"a",41),me(40,"Sign Up"),X()()()()(),W(41,"p",42),me(42,"Signin with"),X(),W(43,"div",43)(44,"div",44)(45,"button",45)(46,"span",46),We(47,"i",47),X()(),W(48,"button",45)(49,"span",46),We(50,"i",48),X()(),W(51,"button",45)(52,"span",46),We(53,"i",49),X()(),W(54,"button",45)(55,"span",46),We(56,"i",50),X()()()()()),n&2){let t=In();En("formGroup",t.loginForm),ft(),Kc(1,t.errorMessage.length>0?1:-1),ft(),Kc(2,t._error.message.length>0?2:-1),ft(13),En("ngModel",t.email),ft(8),En("ngModel",t.password),ft(11),zc("btn btn-primary",t.disabled,""),jc("loader--text",t.authservice.showLoader),En("disabled",!t.loginForm.valid||t.authservice.showLoader)}}function rP(n,e){if(n&1){let t=Wc();W(0,"form",51),c_("ngSubmit",function(){Es(t);let i=In();return Is(i.Submit())}),W(1,"div",21)(2,"h4",22),me(3," Sign In"),X(),W(4,"p"),me(5,"Sign in to your account to continue."),X()(),W(6,"div",23)(7,"div",24)(8,"div",25)(9,"label",26),me(10,"Email"),W(11,"span",27),me(12,"*"),X()(),W(13,"input",52),Aa("ngModelChange",function(i){Es(t);let s=In();return Sa(s.email,i)||(s.email=i),Is(i)}),X()()(),W(14,"div",24)(15,"div",25)(16,"label",26),me(17,"Password"),W(18,"span",27),me(19,"*"),X()(),W(20,"div")(21,"input",53),Aa("ngModelChange",function(i){Es(t);let s=In();return Sa(s.password,i)||(s.password=i),Is(i)}),X()()()(),W(22,"div",30)(23,"div",31)(24,"div",32),We(25,"input",33),W(26,"label",34),me(27," Remember me "),X()(),W(28,"div",35)(29,"a",36),me(30,"Forgot Password?"),X()()(),W(31,"div",37)(32,"button",38),me(33," Login"),X()(),W(34,"div",39)(35,"p",40),me(36,"Don't have an account yet? "),W(37,"a",41),me(38,"Sign Up"),X()()()()(),W(39,"p",42),me(40,"Signin with"),X(),W(41,"div",43)(42,"div",44)(43,"button",45)(44,"span",46),We(45,"i",47),X()(),W(46,"button",45)(47,"span",46),We(48,"i",48),X()(),W(49,"button",45)(50,"span",46),We(51,"i",49),X()(),W(52,"button",45)(53,"span",46),We(54,"i",50),X()()()()()}if(n&2){let t=In();En("formGroup",t.loginForm),ft(13),Ta("ngModel",t.email),ft(8),Ta("ngModel",t.password),ft(11),zc("btn btn-primary",t.disabled,""),jc("loader--text",t.authservice.showLoader),En("disabled",!t.loginForm.valid||t.authservice.showLoader)}}var Ux=(()=>{let e=class e{constructor(r,i,s,o,l,u,c,d,m){this.document=r,this.elementRef=i,this.sanitizer=s,this.authservice=o,this.router=l,this.formBuilder=u,this.renderer=c,this.firebaseService=d,this.toastr=m,this.disabled="",this.active="Angular",this.firestoreModule=this.firebaseService.getFirestore(),this.databaseModule=this.firebaseService.getDatabase(),this.authModule=this.firebaseService.getAuth(),this.email="spruko@admin.com",this.password="sprukoadmin",this.errorMessage="",this._error={name:"",message:""},this.error="",this.showPassword=!1,this.toggleClass="off-line";let p=this.renderer.selectRootElement("body",!0)}ngOnInit(){this.renderer.addClass(this.document.body,"login-img"),this.renderer.addClass(this.document.body,"ltr"),this.loginForm=this.formBuilder.group({username:["spruko@admin.com",[Ca.required,Ca.email]],password:["sprukoadmin",Ca.required]})}clearErrorMessage(){this.errorMessage="",this._error={name:"",message:""}}validateForm(r,i){return r.length===0?(this.errorMessage="please enter email id",!1):i.length===0?(this.errorMessage="please enter password",!1):i.length<6?(this.errorMessage="password should be at least 6 char",!1):(this.errorMessage="",!0)}get form(){return this.loginForm.controls}Submit(){console.log(this.loginForm)}ngOnDestroy(){let r=this.renderer.selectRootElement("body",!0);this.renderer.removeAttribute(r,"class")}toggleVisibility(){this.showPassword=!this.showPassword,this.toggleClass==="off-line"?this.toggleClass="line":this.toggleClass="off-line"}};e.\u0275fac=function(i){return new(i||e)(Ot(m_),Ot(l_),Ot(g_),Ot(G_),Ot(__),Ot(b_),Ot(u_),Ot(mc),Ot(Cs))},e.\u0275cmp=a_({type:e,selectors:[["app-login"]],standalone:!0,features:[d_([mc,{provide:Cs,useClass:Cs}]),f_],decls:21,vars:2,consts:[["nav","ngbNav"],[1,"page"],[1,"container-lg","my-auto"],[1,""],[1,"text-center","my-3"],["routerLink",""],["src","./assets/images/brand/insightappstext.png","alt","",1,"header-brand-img"],["ngbNav","",1,"nav-tabs","rounded-2","justify-content-center",3,"activeIdChange","activeId"],["ngbNavItem","Firebase"],["ngbNavLink","",1,"firebase-img"],["src","./assets/images/firebase.svg","alt","",1,"firebase"],["ngbNavContent",""],["ngbNavItem","Angular"],["src","./assets/images/favicon.svg","alt","",1,"firebase"],[1,"row","justify-content-center","mt-4","mx-0"],[1,"col-xl-4","col-lg-6"],[1,"card","shadow-none"],[1,"card-body","p-sm-6"],[1,"ml-4",3,"ngbNavOutlet"],[3,"formGroup"],[1,"text-danger"],[1,"text-center","mb-4"],[1,"mb-1"],[1,"row"],[1,"col-sm-12"],[1,"mb-3"],[1,"mb-2","fw-500"],[1,"text-danger","ms-1"],["type","email","placeholder","Enter your Email","autocomplete","","formControlName","username","required","",1,"form-control","ms-0",3,"ngModel"],["type","password","id","input-password","autocomplete","","placeholder","Password","formControlName","password","required","",1,"form-control",3,"ngModel"],[1,"col-xl-12"],[1,"d-flex","mb-3"],[1,"form-check","d-flex","align-items-center"],["type","checkbox","value","","id","flexCheckDefault",1,"form-check-input"],["for","flexCheckDefault",1,"form-check-label","tx-15"],[1,"ms-auto"],["routerLink","/authentication/forgot-password",1,"tx-primary","ms-1","tx-13"],[1,"d-grid","mb-3"],["type","submit","autofocus","",3,"disabled"],[1,"text-center"],[1,"mb-0","tx-14"],["routerLink","/authentication/register",1,"tx-primary","ms-1","text-decoration-underline"],[1,"text-center","mt-3","mb-2"],[1,"d-flex","justify-content-center"],[1,"btn-list"],["type","button",1,"btn","btn-icon","bg-primary-transparent","rounded-pill","border-0"],[1,"btn-inner--icon"],[1,"fa","fa-facebook-f"],[1,"fa","fa-google"],[1,"fa","fa-twitter"],[1,"fa","fa-linkedin"],[3,"ngSubmit","formGroup"],["type","email","autocomplete","","placeholder","Enter your Email","formControlName","username","required","",1,"form-control","ms-0",3,"ngModelChange","ngModel"],["type","password","autocomplete","","id","input-password","placeholder","Password","formControlName","password","required","",1,"form-control",3,"ngModelChange","ngModel"]],template:function(i,s){if(i&1){let o=Wc();W(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"a",5),We(5,"img",6),X()()(),W(6,"ul",7,0),Aa("activeIdChange",function(u){return Es(o),Sa(s.active,u)||(s.active=u),Is(u)}),W(8,"li",8)(9,"a",9),We(10,"img",10),X(),Ia(11,nP,57,11,"ng-template",11),X(),W(12,"li",12)(13,"a",9),We(14,"img",13),X(),Ia(15,rP,55,9,"ng-template",11),X()(),W(16,"div",14)(17,"div",15)(18,"div",16)(19,"div",17),We(20,"div",18),X()()()()()()}if(i&2){let o=h_(7);ft(6),Ta("activeId",s.active),ft(14),En("ngbNavOutlet",o)}},dependencies:[v_,y_,Y_,j_,W_,K_,z_,$_,Q_,H_,Ha,R_,T_,w_,E_,I_,C_,P_,S_,A_,Ua,fc,wu,J_],styles:[".firebase{width:30px;height:30px}  .nav-tabs{border-color:none!important}"]});let n=e;return n})();export{Ux as LoginComponent};
